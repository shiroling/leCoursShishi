Type.registerNamespace("Common.App.SafeLinks");Common.App.SafeLinks.b=function(n,t,i,r,u,f){this.IsSafeLinksEnabled=null;this.WebAffinitizedUrl=null;this.PolicyCookie=null;this.PolicyCookieTTL=0;this.WasServiceDown=!1;this.AffinitizedUrl=null;this.IsSafeLinksEnabled=n;this.WebAffinitizedUrl=t;this.PolicyCookie=i;this.PolicyCookieTTL=r;this.WasServiceDown=u;this.AffinitizedUrl=f};Common.App.SafeLinks.f=function(){this.url=null;this.verdict=0;this.navigateUrl=null;this.urlRepTTL=0;this.lookupStatusCode=0};Common.App.SafeLinks.e=function(){};Common.App.SafeLinks.SafeLinksManager=function(n,t,i,r,u,f){var s,e,a,h;if(this.x=Function.createDelegate(this,this.K),this.y=Function.createDelegate(this,this.L),Diag.a.a(26019598,378,100,"Initializing SafeLinksManager."),this.c=n,this.r=t,this.o=i,Common.App.SafeLinks.SafeLinksManager.b=f,this.l=r?this.c.b("SafeLinksHandlerWebServiceBase"):this.c.b("WebServiceBase"),this.s=this.c.b("SafeLinksHashedUserId"),this.w=this.c.b("SafeLinksWorkloadIdHeaderValue"),this.j=this.c.c("SafeLinksMaxGetPolicyBootRetries",2),this.k=this.c.c("SafeLinksMaxGetPolicyOnLinkClickRetries",1),this.h=this.P(),this.g=this.O(),Diag.a.a(26019599,378,50,"SafeLinksManager _isEnabledForUser={0}, _isEnabledForBrowser={1}",this.h,this.g),this.h&&this.g){var o=this.m(),c=o?o.IsSafeLinksEnabled.toLowerCase():"",l=this.v();Diag.a.a(36231312,378,50,"Cached values for IsSafeLinksEnabled: {0}, IsPolicyCookieExpired: {1}.",c,l);s=!o||c==="unknown"||o.WasServiceDown||l;e=this.t();e&&(e.set("shouldGetSafeLinksDataFromServer",s.toString()),e.set("isSafeLinksEnabledCacheValue",c.toString()));Common.i.a().recordKpiUsage("SafeLinksGetPolicy1",0,"jpittsdirects",e);a=this.c.f("LicensingForSafeLinksIsEnabled")?this.c.a("LicensingForSafeLinksIsEnabled"):!1;a&&u?(this.i=!1,h=this,u.a(function(n){n.a("MsoUrlreputation",!0).then(function(n){return h.i=n,h.i&&s&&h.u(!0),null})})):s&&this.u(!0)}};Common.App.SafeLinks.SafeLinksManager.d=function(n){return n.toLowerCase()!=="false"?!0:!1};Common.App.SafeLinks.SafeLinksManager.prototype={c:null,r:null,w:null,l:null,s:null,o:null,j:0,k:0,e:0,f:0,p:!1,n:!1,d:null,i:!0,h:!1,g:!1,q:null,F:function(){var t=this.l?this.l+"/":"",n=new Common.bF("SafeLinksHandler.ashx");return n.a("app",this.o),this.c.a("SafeLinksUseDebugHeader")&&n.a("action","debug"),String.format("{0}{1}&{2}",t,n.toString(),Common.a.i)},G:function(){var t=this.l?this.l+"/":"",n=new Common.bF("SafeLinksHandler.ashx");return n.a("app",this.o),this.c.a("SafeLinksUseDebugHeader")&&n.a("action","debug"),n.a("slrt","GetUrlReputation"),String.format("{0}{1}&{2}",t,n.toString(),Common.a.i)},H:function(){return Common.App.SafeLinks.SafeLinksManager.c||(Common.App.SafeLinks.SafeLinksManager.c=new Common.App.SafeLinks.SafeLinksNavigationHelper(this.c,this.r,this.G(),Common.App.SafeLinks.SafeLinksManager.b)),Common.App.SafeLinks.SafeLinksManager.c},a:function(n){var r,t,u,f,e,i;return n?(r=this.N(n),Diag.a.a(594830615,378,50,"SafeLinksManager.TryNavigate: isSupportedHyperLinkType={0},_isEnabledForUser={1},_isEnabledForBrowser={2},_isUserLicensedForSafeLinks={3}",r,this.h,this.g,this.i),!r||!this.h||!this.g||!this.i)?!1:(t=0,e=(f=this.Q(u={val:t}),t=u.val,f),Diag.a.a(595079385,378,50,"ShouldTryUsingSafeLinksService returned NavigationState={0}",Common.App.SafeLinks.SafeLinksManager.a.toString(t)),i=this.t(),i&&i.set("SafeLinksNavigationState",Common.App.SafeLinks.SafeLinksManager.a.toString(t)),Common.i.a().recordKpiUsage("SafeLinksNavigations",0,"jpittsdirects",i),!e)?((t===2||t===3)&&Common.i.a().recordKpiFailure("SafeLinksNavigations",Common.App.SafeLinks.SafeLinksManager.a.toString(t),!1,!0,null),!1):(Diag.a.a(26019601,378,50,"Using safelinks to navigate hyperlink"),this.R())?this.v()?!1:this.H().i(this.I(),n,this.z()):this.v()?(this.d=n,Diag.a.a(24462627,378,50,"Refreshing the cache as policy cookie expired."),this.n=!1,this.u(!1),!0):(this.D(n),!0):(Diag.a.a(593367827,378,10,"SafeLinksManager.TryNavigate: Null/Empty targetUrl"),!1)},N:function(n){var t,i;if(n=n.toLowerCase(),t=this.c.h("SafeLinksUnsupportedProtocols"),t)for(i=0;i<t.length;i++)if(n.startsWith(t[i]))return!1;return!0},u:function(n){var t=this.t(),i;t&&t.set("isOnBootRequest",n.toString());Common.i.a().recordKpiUsage("SafeLinksGetPolicySuccessfulRequest",1,"jpittsdirects",t);Common.i.a().recordKpiUsage("SafeLinksGetPolicyFailedRequest",0,"jpittsdirects",t);i=this.E("SafeLinksGetPolicy");this.r.a(this.F(),1,null,null,!0,2,this.y,this.x,i,null,!1,null,null,"23",null,!1,null,!1,null);this.n=n;this.p=!0;n?this.e++:this.f++},L:function(n){var u=406,i="",t,r,l,a,v;try{this.n=!1;this.p=!1;var o=n.b.f,s,h,c=(h=this.C(s={val:o}),o=s.val,h),f,y=(f=new Common.U,f.durationMs=c,f);if(Common.i.a().recordKpiSuccess("SafeLinksGetPolicySuccessfulRequest",y),Diag.a.a(594830614,378,50,"GetSafeLinksDataFromServer_OnSuccessCallback: HttpStatus {0}, data length {1}, Duration {2}",n.b.a,n.b.b.length,c),n.b.a!==200){i="Unexpected httpStatus: "+n.b.a.toString();return}t=null;try{t=JSON.parse(n.b.b)}catch(p){i="Exception:"+p.toString()+" deserializing response";return}if(!t){i="Error when serializing response into SafeLinksData. SafeLinksData is null.";return}if(r=t.IsSafeLinksEnabled,isNullOrUndefined(r)||r.length<=0){i="Invalid isSafeLinksEnabledString";return}if(Diag.a.a(594830613,378,50,"Retrieved isSafeLinksEnabledString {0}",r),l=Common.App.SafeLinks.SafeLinksManager.d(r),isNullOrUndefined(t.WebAffinitizedUrl)||t.WebAffinitizedUrl.length<=0){i="Invalid WebAffinitizedUrl";return}if(isNullOrUndefined(t.PolicyCookie)||t.PolicyCookie.length<=0){i="Invalid PolicyCookie";return}if(isNullOrUndefined(t.PolicyCookieTTL)){i="Invalid PolicyCookieTTL";return}var w=t.WebAffinitizedUrl,b=t.PolicyCookie,k=t.AffinitizedUrl,e=new Date,d=t.PolicyCookieTTL>5?t.PolicyCookieTTL-5:0;e.setMinutes(e.getMinutes()+d);a=e.getTime();v=new Common.App.SafeLinks.b(r,w,b,a,!1,k);this.B(v);u=n.b.a;this.d&&(l?(this.D(this.d),this.e=0,this.f=0):(Diag.a.a(26019602,378,50,"SafeLinks is disabled by admin; Navigating without SafeLinks"),Common.i.a().recordKpiFailure("SafeLinksNavigations",Common.App.SafeLinks.SafeLinksManager.a.toString(1),!0,!0,null),Common.g.e(this.d)),this.d=null)}catch(g){i="GetSafeLinksDataFromServer_OnSuccessCallback: Exception:  "+g.toString()}finally{u!==200&&this.A(u,i)}},K:function(n){var t,i;this.p=!1;t=500;i="";try{var u=n.b.f,f,e,o=(e=this.C(f={val:u}),u=f.val,e),r,s=(r=new Common.U,r.durationMs=o,r);t=n.b.a;Common.i.a().recordKpiFailure("SafeLinksGetPolicyFailedRequest","HttpStatusCode_"+t.toString(),!1,!0,s);i="Request Failed, Status="+Common.bT.toString(n.b.c)+" Duration: "+o}catch(h){i="GetSafeLinksDataFromServer_OnFailureCallback Exception: "+h.toString()}finally{this.A(t,i)}},A:function(n,t){var r,i,u,f;try{Diag.a.a(594830612,378,10,"HandleGetPolicyRequestError: HttpStatus {0}, Error {1}",n,t);this.e<this.j&&this.f<this.k?this.u(this.n):(this.n=!1,Diag.a.a(24462656,378,10,"Exhausted all retries for SafeLinks GetPolicy call. OnBootRetries: {0}, OnClickRetries: {1}, HttpStatus: {2}, Error: {3}",this.e,this.f,n,t),r=null,i=this.t(),i&&(i.set("HttpStatus",n.toString()),r=(u=new Common.U,u.extendedProperties=i,u)),Common.i.a().recordKpiFailure("SafeLinksGetPolicy1","GetPolicyRequestError",!1,!0,r),f=new Common.App.SafeLinks.b("false","","",0,!0,""),this.B(f),this.d&&(Diag.a.a(26019603,378,50,"Error occurred during at-click GetPolicy call, NavigationState = {0}",Common.App.SafeLinks.SafeLinksManager.a.toString(2)),Common.i.a().recordKpiFailure("SafeLinksNavigations",Common.App.SafeLinks.SafeLinksManager.a.toString(2),!1,!0,null),Common.g.e(this.d),this.d=null))}catch(e){Diag.a.a(594830611,378,10,"HandleGetPolicyRequestError: Exception {0}",e.toString())}},D:function(n){var i=this.z(),r=this.M(),t={};t.Url=n;t.SafeLinksCookie=i;t.CorrelationId=Common.u.a().a;t.WorkloadId=this.w;t.UserAgentInfo=Common.c.x()+"|"+this.o;Diag.a.a(23900187,378,50,"Validating hyperlink with request correlation: {0}",t.CorrelationId);Common.g.s(Common.g.g(4),r,t)},P:function(){var n=this.c.b("IsSafeLinksEnabledForUser");return n?Common.App.SafeLinks.SafeLinksManager.d(n):!1},O:function(){var n=this.c.h("SafeLinksDisabledBrowsers"),t;if(Common.c.i()){if(this.c.f("SafeLinksForTeamsIsEnabled")&&this.c.a("SafeLinksForTeamsIsEnabled"))return!0;if(Array.contains(n,"Electron"))return!1}else if(Array.contains(n,Common.c.x()))return!1;return(t=(this.c.b("UiHost")||"").toLowerCase(),t==="officecomhwa")?!1:!0},R:function(){var n=window.location.href.indexOf("&wd_slnh=1")!==-1;return n?!0:Common.c.i()},Q:function(n){var t,i,r;return(n.val=0,t=this.m(),i=t?t.IsSafeLinksEnabled:"",i!=="")?t.WasServiceDown?(Diag.a.a(51663971,378,50,"Failed to retrieve policy data"),n.val=2,!1):i.toLowerCase()==="false"?(Diag.a.a(51664e3,378,50,"SafeLinks disabled for the user"),n.val=1,!1):Common.App.SafeLinks.SafeLinksManager.d(i):this.p?(n.val=3,Diag.a.a(595079384,378,50,"Currently getting SafeLinks policy"),!1):this.e>=this.j||this.f>=this.k?(n.val=2,Diag.a.a(51664001,378,50,"Exhausted all retries- Failure in GetPolicy for SafeLinks ({0}/{1} boot, {2}/{3} onClick)",this.e,this.j,this.f,this.k),!1):(r=this.e+this.f,Diag.a.a(23900182,378,10,"Inconsistent SafeLinks state: SafeLinks cache data is null with no on boot request pending, and {0} retries left over. Perhaps LocalStorage is inaccessable.",this.j+this.k-r),!0)},z:function(){var n=this.m();return n?n.PolicyCookie:""},M:function(){var n=this.m();return n?n.WebAffinitizedUrl:""},I:function(){var n=this.m();return n?n.AffinitizedUrl:""},J:function(){var t=new Date,n,i;try{n=this.m();i=n?n.PolicyCookieTTL:0;t.setTime(i)}catch(r){Diag.a.a(24462658,378,10,"Exception occured while fetching expiration time from cache: {0}",r)}return t},v:function(){var n=this.J();return!!n&&n.getTime()<Date.now()},m:function(){if(!this.q){var n=Common.Utils.c.a().b(this.s);if(!n||n==="")return null;this.q=JSON.parse(n)}return this.q},B:function(n){if(isNullOrUndefined(n))throw Error.argumentNull("safeLinksData");else if(isNullOrUndefined(n.IsSafeLinksEnabled)||n.IsSafeLinksEnabled.length<=0)throw Error.argumentNull("safeLinksData.IsSafeLinksEnabled");this.q=n;n.WasServiceDown||this.S(n)},S:function(n){var t=JSON.stringify(n);Common.Utils.c.a().c(this.s,t)},E:function(n){return isNullOrUndefined(Common.App.SafeLinks.SafeLinksManager.b)?null:Common.App.SafeLinks.SafeLinksManager.b.a("WebServiceCall",n)},C:function(n){if(!isNullOrUndefined(n.val)){var t=n.val.b();return n.val.a(),n.val=null,t}return null},t:function(){try{return new Map}catch(n){return null}}};Common.App.SafeLinks.SafeLinksManager.a=function(){};Common.App.SafeLinks.SafeLinksManager.a.prototype={enabledByPolicy:0,disabledByPolicy:1,disabled_GetPolicyFailure:2,disabled_PendingGetPolicyRequest:3};Common.App.SafeLinks.SafeLinksManager.a.registerEnum("Common.App.SafeLinks.SafeLinksManager.a",!1);Common.App.SafeLinks.SafeLinksNavigationHelper=function(n,t,i,r){this.c=Function.createDelegate(this,this.g);this.d=Function.createDelegate(this,this.h);this.e=n;this.a=t;this.b=i;Common.App.SafeLinks.SafeLinksNavigationHelper.a=r};Common.App.SafeLinks.SafeLinksNavigationHelper.prototype={e:null,a:null,b:null,i:function(n,t,i){var u,f,r,e;try{return u=null,Common.App.SafeLinks.SafeLinksNavigationHelper.a&&(u=Common.App.SafeLinks.SafeLinksNavigationHelper.a.a("WebServiceCall","SafeLinksGetUrlReputation")),f=new Common.App.SafeLinks.d(t,u),r={},r.AffinitizedUrl=n,r.TargetUrl=t,r.PolicyCookie=i,e=JSON.stringify(r),this.a.a(this.b,2,e,null,!1,2,this.d,this.c,f,null,!1,3e3,3e3,"36",null,!1,null,!1,null),!0}catch(o){Diag.a.a(588788033,378,10,o.message)}return!1},h:function(n){var r="OnGetUrlReputationSuccessCallback: ",u=10,i=n.b.f;try{var f=JSON.parse(n.b.b),t=f.reputationResults[0],e=t.navigateUrl.length,o=i.a.length,s=t.navigateUrl===i.a;t.navigateUrl&&t.navigateUrl.length>0&&(i.a=t.navigateUrl);r+=String.format("HttpStatus {0}, verdict {1}, clickedUrlLength = {2} navigateUrlLength {3}, navigateUrlSameAsClickedUrl {4}",n.b.a,t.verdict,o.toString(),e.toString(),s.toString());u=50}catch(h){r+=String.format("Exception {0}",h.message)}this.f(i,r,u)},g:function(n){var t="OnGetUrlReputationFailureCallback: ",i=n.b.f;try{t+=String.format("HttpStatus {0}",n.b.a)}catch(r){t+=String.format("Exception {0}",r.message)}this.f(i,t,10)},f:function(n,t,i){n.b&&(n.b.a(),n.b=null);Diag.a.a(588788034,378,i,t);Common.g.b(n.a,null,"noopener,noreferrer","SafeLinksNav")}};Common.App.SafeLinks.d=function(n,t){this.a=n;this.b=t};Common.App.SafeLinks.d.prototype={a:null,b:null};Common.App.SafeLinks.c=function(){};Common.App.SafeLinks.c.b=function(n){switch(n){case 3:return"Word";case 2:return"PowerPoint";case 1:return"Excel";default:return"Unknown"}};Common.App.SafeLinks.c.a=function(n){switch(n){case 1:return"Edit";case 2:return"View";case 3:return"InstantView";default:return"Unknown"}};Common.App.SafeLinks.b.registerClass("Common.App.SafeLinks.b");Common.App.SafeLinks.SafeLinksManager.registerClass("Common.App.SafeLinks.SafeLinksManager",null,Common.App.SafeLinks.a);Common.App.SafeLinks.SafeLinksNavigationHelper.registerClass("Common.App.SafeLinks.SafeLinksNavigationHelper");Common.App.SafeLinks.d.registerClass("Common.App.SafeLinks.d");Common.App.SafeLinks.SafeLinksManager.b=null;Common.App.SafeLinks.SafeLinksManager.c=null;Common.App.SafeLinks.SafeLinksNavigationHelper.a=null;Type.registerNamespace("_Ewa");_Ewa.BG=function(n){_Ewa.BG.initializeBase(this);this.h=n;this.l()};_Ewa.BG.a=function(n){n.a().b(_Ewa.bkq.$$(Common.App.SafeLinks.a),270,new _Ewa.BG(n))};_Ewa.BG.prototype={h:null,a:function(){this.k(this.h.a().a(Common.App.SafeLinks.a,269,!1,null)||new Common.App.SafeLinks.SafeLinksManager(Common.a.a,Common.a.e,String.format("{0}-{1}",Common.App.SafeLinks.c.b(Common.a.b().a().a()),Common.App.SafeLinks.c.a(Common.a.b().a().o())),!1,null,null))}};_Ewa.BG.registerClass("_Ewa.BG",_Ewa.sX.$$(Common.App.SafeLinks.a));Type.registerNamespace("_Ewa");_Ewa.bnz=function(){};_Ewa.bnz.a=function(){_Ewa.m.a(function(n){_Ewa.BG.a(n)})};_Ewa.bnz.a();