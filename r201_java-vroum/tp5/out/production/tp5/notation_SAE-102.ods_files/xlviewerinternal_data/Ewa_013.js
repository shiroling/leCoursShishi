Type.registerNamespace("_Ewa");_Ewa.InstantaneousSupportInformationManager=function(n,t){this.Z=Function.createDelegate(this,this.bt);this.ba=Function.createDelegate(this,this.bu);this.bb=Function.createDelegate(this,this.bv);this.bd=Function.createDelegate(this,this.bA);this.M=Function.createDelegate(this,this.bw);this.Y=Function.createDelegate(this,this.br);this.R=Function.createDelegate(this,this.bs);this.bc=Function.createDelegate(this,this.bh);this.T=Function.createDelegate(this,this.by);this.Q=Function.createDelegate(this,this.bq);this.U=Function.createDelegate(this,this.bz);this.S=Function.createDelegate(this,this.bx);_Ewa.InstantaneousSupportInformationManager.initializeBase(this,[!1]);Diag.a.a(35985034,0,50,"InstantaneousSupportInformationManager ctor start");this.z=n;this.y=t;this.E=null;this.J=null;this.B=null;this.x=null;this.I=new($$sc.s.$$(_Ewa.DM));this.C=new($$sc.s.$$($$sc.a));this.A=new Array(0);this.V=new($$sc.s.$$(String));this.N={};this.z.g(this.S);this.y.B(this.U);_Ewa.c.a(this.y).a().w(this.Q);_Ewa.a.b(311)&&this.z.q(this.T);this.F(100);Diag.a.a(35985035,0,50,"InstantaneousSupportInformationManager ctor end")};_Ewa.InstantaneousSupportInformationManager.c=function(n,t){var u,i,f,o,s,r,c,v,y;if(!n||!n.length)return new Array(0);if(!t||!t.length){for(u=new Array(n.length),i=0;i<n.length;++i)u[i]=n[i].IfmtIndex;return u}f=new($$sc.s.$$(_Ewa.InstantaneousSupportInformationManager.b));for(var l=n,p=l.length,e=0;e<p;++e)o=l[e],f.b(o.IfmtIndex,new _Ewa.InstantaneousSupportInformationManager.b(o));s=new($$sc.v.$$(Number));for(var a=t,w=a.length,h=0;h<w;++h)r=a[h],(y=f.e(r.IfmtIndex,v={val:c},null),c=v.val,y)&&c.a.FormatString===r.FormatString||s.b(r.IfmtIndex);return s.g()};_Ewa.InstantaneousSupportInformationManager.d=function(n,t){if(!t||t===n.length-1)return!1;var i=n.charAt(t-1),r=n.charAt(t+1);return!(i==="#"||i==="0"||i==="?")||!(r==="#"||r==="0"||r==="?")?!1:!0};_Ewa.InstantaneousSupportInformationManager.a=function(n,t,i){_Ewa.f.b(t,i,!1)||(n[t]=i)};_Ewa.InstantaneousSupportInformationManager.prototype={z:null,y:null,E:null,J:null,B:null,x:null,O:-1,H:null,L:null,I:null,C:null,K:!1,G:!1,A:null,V:null,N:null,W:null,X:null,i:function(n){this.es("isim0",n)},g:function(n){this.eu("isim0",n)},m:function(n){this.es("isim1",n)},w:function(n){this.eu("isim1",n)},h:function(n){this.es("isim2",n)},f:function(n){this.eu("isim2",n)},n:function(n){this.es("isim3",n)},a:function(){return this.x?this.x.LocaleInformation:null},b:function(){return this.x?this.x.NumberFormats:new Array(0)},c:function(){return this.A&&this.A.length||this.bg(),this.A},d:function(){return this.L},p:function(){return this.x&&!isNullOrUndefined(this.x.InstantaneousCalcWebWorkerPrecisionSamplingRate)?this.x.InstantaneousCalcWebWorkerPrecisionSamplingRate:.001},s:function(){return this.x&&!isNullOrUndefined(this.x.InstantaneousCalcWebWorkerSampleWorkbookStatisticsRate)?this.x.InstantaneousCalcWebWorkerSampleWorkbookStatisticsRate:.1},r:function(){return this.x&&!isNullOrUndefined(this.x.InstantaneousCalcWebWorkerSampleRecalcStatisticsRate)?this.x.InstantaneousCalcWebWorkerSampleRecalcStatisticsRate:.2},q:function(){return this.x&&!isNullOrUndefined(this.x.InstantaneousCalcWebWorkerSamplePrecisionPrintFormulaRate)?this.x.InstantaneousCalcWebWorkerSamplePrecisionPrintFormulaRate:.001},k:function(){return this.x?this.x.InstantaneousCalcWebWorkerRenderingTimeLimitInMs:50},e:function(){return isNull(this.H)?this.x?this.x.InstantaneousCalcManualMode:!1:this.H},l:function(n,t,i){var r=this.I.e(n,t,0);return!r&&n>0&&this.y&&(Diag.a.a(40468576,0,50,"InstantaneousSupportInformationManager.TryGetNumberFormatCategory: failed to get category from numberFormatIndexToCategoryCache {0}",n),this.bo(n),i&&(t.val=this.bn(n),r=!0),_Ewa.rr.a(n,this.y.R())&&(t.val=6)),r},u:function(n){var t=0,i,r;return(r=this.l(n,i={val:t},!0),t=i.val,r)?t===6:(Diag.a.a(23156486,0,50,"InstantaneousSupportInformationManager.IsFormatInPercentageCategory: failed to get category from format index {0}",n),!1)},o:function(n){Diag.a.a(37855392,0,50,"InstantaneousSupportInformationManager.ForceRefreshFunctionInfo: Forcing refresh of functions");var t={};t.FilterType=0;this.B=_Ewa.k.d(this.y.c().a(),t,_Ewa.n.a(this.bc,n),this.R,null,null,null)},j:function(){this.F(100)},bq:function(){var i=_Ewa.c.a(this.y),n,t,r,u;i&&(n=i.h(null),n&&(t=0,u=this.l(n.a().b(),r={val:t},!0),t=r.val,u))},v:function(n){this.H=n},bo:function(n){var t,r,u,i;if(!this.C||!this.y){Diag.a.a(25747617,0,15,"GetCategoryFromServerAsync called on disposed InstantaneousSupportInformationManager instance, skipping");return}((u=this.C.e(n,r={val:t},null),t=r.val,!u)||t.b>3)&&(Diag.a.a(24417758,0,50,"Getting number format category for format index: {0}",n),i=_Ewa.UG.a(this.y.c().a(),n,this.Y,null,null,null,null),i&&this.C.b(n,i))},bn:function(n){return n>=1&&n<=8?1:n>=9&&n<=12?2:n===13||n===14?6:n===15?8:!(n===17|n===18)?n===19?4:n===16||n>=20&&n<=29||n===31?11:n===30?9:n>=32&&n<=35?3:0:7},D:function(){var n=isNullOrUndefined(this.z),t=!n&&this.z.a();return Diag.a.a(36227294,0,50,"InstantaneousSupportInformationManager.IsActive: instantaneous support information manager active:{0} - sessionStateManager IsNullOrUndefined: {1}",t,n),t},br:function(n){if(this.D()){if(_Ewa.i.e(n.Errors)||!n.Result){Diag.a.a(24417759,0,50,"GetCategoryFromServer failed, ignoring - server errors: {0}",n.Errors?n.Errors.join(","):"None");return}var t=n.Result;Diag.a.a(24417760,0,50,"Updating number format category cache, format index = {0}, category = {1}",t.Index,t.Category);this.bB(t.Index,t.Category);this.er("isim1",new _Ewa.mH(t.Index,t.Category),this)}},bB:function(n,t){this.I.b(n,t)},dispose:function(){var t,i,n;for(System.a.a(this.E),this.E=null,this.be(),t=this.C.$$ge();t.$$mn();)(i=t.$$cu(),n=i.a,!n||n.b>3)||Common.a.e.b(n.d);this.C=null;this.z&&(this.z.h(this.S),this.G&&this.z.w(this.M),this.G=!1,this.z.s(this.T));this.z=null;this.y&&_Ewa.c.a(this.y)&&_Ewa.c.a(this.y).a()&&(_Ewa.c.a(this.y).a().x(this.Q),this.y.C(this.U));this.y=null;_Ewa.bW.prototype.dispose.call(this)},t:function(n){try{switch(n){case"LocaleLongDateFormat":return _Ewa.a.b(200);case"GetLocaleDayNames":return _Ewa.a.b(201);case"CalculateTextWidthIgnoreLetterSpacing":return _Ewa.a.b(291);case"OfficeVSO:3657744_CalcFixForDateFormat":return _Ewa.a.a("OfficeVSO:3657744_CalcFixForDateFormat");case"OfficeVSO:3858161_ClientSideEstimationForDateWithTheYearZero":return _Ewa.a.a("OfficeVSO:3858161_ClientSideEstimationForDateWithTheYearZero");case"CalcAutocompleteExperiment":return _Ewa.a.c("Microsoft.Office.Excel.CalcTSAutocompleteExperimentIsEnabled",!1);case"CalcNewFunctions":return _Ewa.a.b(252);case"CalcContractChecks":return _Ewa.a.b(253);case"CalcSupportDynamicArrays":return _Ewa.a.b(254);case"CalcFormatCalculations":return _Ewa.a.b(255);case"CalcFormulaCacheAPIChanges":return _Ewa.a.b(256);case"CalcStrictFormulaChecking":return _Ewa.a.b(257);case"CalcSupportRowReference":return _Ewa.a.b(268);case"CalcParserUsesPledges":return _Ewa.a.b(316);case"CalcWebWorker":return!0;case"CalcWebWorkerTest":return _Ewa.a.b(315);case"CalcLookupFunctions":return _Ewa.a.b(317);case"CalcLogStopWatch":return _Ewa.a.b(393);case"CalcPreventSpillingHack":return _Ewa.a.b(258);case"CalcDynamicArrayOperators":return _Ewa.a.b(104);case"CalcDotOperator":return _Ewa.a.b(632);case"CalcLetFunction":return _Ewa.a.b(768);default:return n.startsWith("OfficeVSO:")?_Ewa.a.a(n):!1}}catch(t){return Diag.a.a(22374148,0,15,"InstantaneousSupportInformation.IsFeatureEnabled({0}): feature parsing failed, returning false. Exception: {1}.",n,t.toString()),!1}},F:function(n){if(!this.D()||!this.z.c().g()){var t=!isNullOrUndefined(this.z)&&!isNullOrUndefined(this.z.c())?this.z.c().g():!1,i=isNullOrUndefined(this.z)?!1:this.y.b().F();Diag.a.a(36227295,0,50,"InstantaneousSupportInformationManager.ScheduleRefresh: won't schedule refresh. Edit permission: AllowEdits {0}, IsEditMode {1}",t,i);return}System.a.a(this.E);this.E=null;this.E=_Ewa.B.a().a(this.bd,n,_Ewa.o.bz,!0,!1)},bA:function(){if(Diag.a.a(36227296,0,50,"InstantaneousSupportInformationManager.Refresh: start refresh"),this.be(),this.D()&&this.z.c().g()){var n=!this.G&&(!this.x||this.z.bj()>this.O);n?(Diag.a.a(34719488,0,50,"InstantaneousSupportInformationManager.Refresh: getting instantaneous support information."),this.J=_Ewa.NX.a(this.y.c().a(),this.x?this.x.Digest:"",this.bb,this.ba,null,null,null)):this.P();Diag.a.a(34719489,0,50,"InstantaneousSupportInformationManager.Refresh: getting functions info.");this.bg()}},bg:function(){if(Diag.a.a(34719490,0,50,"InstantaneousSupportInformationManager.GetFunctionsInfoAsync called."),this.B){Diag.a.a(34719491,0,50,"InstantaneousSupportInformationManager.GetFunctionsInfoAsync already running, skipping.");return}if(!this.D()){Diag.a.a(37089857,0,50,"InstantaneousSupportInformationManager.GetFunctionsInfoAsync session is not yet active, skipping.");return}if(!this.A||!this.A.length){var n={};n.FilterType=0;this.B=_Ewa.k.d(this.y.c().a(),n,this.Z,this.R,null,null,null)}},bs:function(n){Diag.a.a(34719492,0,50,"InstantaneousSupportInformationManager.OnGetFunctionListFailed failed, status = {0}, HTTP status = {1}.",n.b.c,n.b.a);this.B=null},bw:function(){this.G=!1;this.z.w(this.M);this.F(this.K?1e3:3e5)},bx:function(n,t){Diag.a.a(37492506,0,50,"InstantaneousSupportInformationManager.OnSessionIdChanged called");_Ewa.nJ.a(t)&&this.F(1e3)},by:function(){Diag.a.a(40703904,0,50,"InstantaneousSupportInformationManager.OnWorkbookMetadataChanged called");this.y.k().CalcMode!==3&&(this.H=!this.y.k().CalcMode)},bz:function(){Diag.a.a(37492507,0,50,"InstantaneousSupportInformationManager.OnWorkbookOpened called");this.F(1e3);_Ewa.a.b(311)&&this.y.k().CalcMode!==3&&(this.H=!this.y.k().CalcMode)},bt:function(n,t,i){if(Diag.a.a(34719493,0,50,"InstantaneousSupportInformationManager.OnGetFunctionListSuccess called."),this.B=null,!this.D()){Diag.a.a(34719494,0,50,"InstantaneousSupportInformationManager.OnGetFunctionListSuccess: manager is inactive, skipping.");return}if(n.StateId===-1){Diag.a.a(34719495,0,50,"InstantaneousSupportInformationManager.OnGetFunctionListSuccess: no session, waiting for session.");this.P();return}!n.Result||this.A&&this.A.length?this.F(3e5):this.bh(n,t,i)},bh:function(n){var i,t;if(this.A=n.Result,Diag.a.a(34719496,0,50,"InstantaneousSupportInformationManager.OnGetFunctionListSuccess refreshing functions info list, returned {0} functions.",this.A?this.A.length:-1),i=!1,this.A){for(var u=this.A,f=u.length,r=0;r<f;++r)(t=u[r],t)&&(this.N[t.NameUI.toLocaleUpperCase()]=t.FunctionIndex.toString(),t.NameUI!==t.NameDataStrings&&(this.N[t.NameDataStrings.toLocaleUpperCase()]=t.FunctionIndex.toString(),i=!0),this.V.b(t.FunctionIndex,t.NameUI));this.er("isim2",Sys.EventArgs.Empty,this)}i&&Diag.a.a(36569610,0,50,"InstantaneousSupportInformationManager.OnGetFunctionListSuccess NameDataStrings functions names were used.")},bv:function(n){var e,o,r,t,i,f;if(this.D()){if(e=this.y,Diag.a.b(21311552,0,!!e,"null ewaControl"),this.K=!1,this.O=n.StateId,this.O===-1){this.K=!0;this.P();return}if(n.Result){if(o=n.Result,r=this.x,this.x=o,Diag.a.a(21311553,0,50,"InstantaneousSupportInformation updated, new result digest: {0}.",this.x.Digest),t=[],r)t=_Ewa.InstantaneousSupportInformationManager.c(r.NumberFormats,this.x.NumberFormats);else for(i=0;i<this.x.NumberFormats.length;i++)this.I.b(i,this.x.NumberFormats[i].NumberFormatCategory);for(var s=t,h=s.length,u=0;u<h;++u)f=s[u],this.I.b(f,this.x.NumberFormats[f].NumberFormatCategory);this.bC(t);this.er("isim0",new _Ewa.UH(t),this);_Ewa.a.c("Microsoft.Office.Excel.StructuredReferencesInRangePicker",!1)&&this.er("isim3",null,null)}this.F(3e5)}},P:function(){this.G||(this.G=!0,this.z.v(this.M))},bu:function(n){if(this.D()){if(n.b.c===10){Diag.a.a(21311554,0,50,"Instantaneous support information request cancelled.");return}Diag.a.a(21311555,0,10,"Failed to update instantaneous support information, status = {0}, HTTP status = {1}.",n.b.c,n.b.a);this.K=!0;this.P()}},be:function(){this.bi(this.J);this.bi(this.B);this.J=null;this.B=null},bi:function(n){!n||n.b>3||this.y.c().a().h(n.d)},bC:function(n){var t,i,r,u,e;if(this.L)n.length>0&&(Diag.a.a(22374147,0,50,"InstantaneousSupportInformation: Updating number formatting calculator formats. IFMTs to update: {0}",n.toString()),e=this.bf(n),this.L.updateFormats(e,!0));else{Diag.a.a(22374146,0,50,"InstantaneousSupportInformation: Creating number formatting calculator");t=this.bk();i=this.bf(null);try{r=new _Ewa.tx;u=this;this.L=numFmtCalc.initializeNumberFormatingCalculator(r,t,i,function(n){return u.t(n)},this.y)}catch(f){Diag.a.a(24379932,0,10,"NumberFormattingCalculator creation failed, exception = {0}. Stack error = {1}",f,f.stack)}}},bf:function(n){var h=this.x.NumberFormats.length,r=null,f,e,o,t,i;if(n){h=n.length;r=new($$sc.s.$$(Number));for(var c=n,a=c.length,u=0;u<a;++u)f=c[u],r.b(f,f)}e=new Array(h);this.W=this.bl();this.X=this.bm();o=0;for(var l=this.x.NumberFormats,v=l.length,s=0;s<v;++s)(t=l[s],!r||r.c(t.IfmtIndex))&&(i={},i.index=t.IfmtIndex,i.formatString=" "+this.bj(t.FormatString),i.isPredefined=t.Builtin,e[o]=i,++o);return e},bj:function(n){var o=this.bp(n),u=o?this.W:this.X,f,r,t,e,i,s;if(Common.D.a(u))return n;for(f=new Sys.StringBuilder,r=!1,t=0;t<n.length;t++)e=!1,i=n.charAt(t).toString(),_Ewa.f.b(i,'"',!1)?r=!r:e=i in u,s=o||_Ewa.InstantaneousSupportInformationManager.d(n,t),f.append(e&&!r&&s?u[i]:i);return f.toString()},bm:function(){var n={};return _Ewa.InstantaneousSupportInformationManager.a(n,this.x.LocaleInformation.ThousandSeparator.toString(),","),_Ewa.InstantaneousSupportInformationManager.a(n,this.x.LocaleInformation.DecimalSeparator.toString(),"."),n},bl:function(){var n={};return isNullOrUndefined(this.x.LocaleInformation.DayIndicator)||isNullOrUndefined(this.x.LocaleInformation.MonthIndicator)||isNullOrUndefined(this.x.LocaleInformation.YearIndicator)||(_Ewa.InstantaneousSupportInformationManager.a(n,this.x.LocaleInformation.DayIndicator.toString(),"d"),_Ewa.InstantaneousSupportInformationManager.a(n,this.x.LocaleInformation.MonthIndicator.toString(),"m"),_Ewa.InstantaneousSupportInformationManager.a(n,this.x.LocaleInformation.YearIndicator.toString(),"y")),_Ewa.InstantaneousSupportInformationManager.a(n,this.x.LocaleInformation.DateAlternativeSeparator.toString(),"-"),_Ewa.InstantaneousSupportInformationManager.a(n,this.x.LocaleInformation.DateSeparator.toString(),"/"),n},bp:function(n){return n.indexOf(this.x.LocaleInformation.DayIndicator)>-1||n.indexOf(this.x.LocaleInformation.MonthIndicator)>-1||n.indexOf(this.x.LocaleInformation.YearIndicator)>-1},bk:function(){var n={};n.lcid=this.x.LocaleInformation.Lcid;n.amAlternativeString=this.x.LocaleInformation.AmAltString;n.amPmSeparatedBySpace=this.x.LocaleInformation.AmPmSeparatedBySpace;n.amString=this.x.LocaleInformation.AmString;n.currencyAlternativeString="";n.currencyFormat=this.x.LocaleInformation.CurrencyFormat;n.currencySeparatedBySpace=this.x.LocaleInformation.CurrencySeparatedBySpace;n.currencyString="";n.dateAlternativeSeparator=this.x.LocaleInformation.DateAlternativeSeparator.toString();n.dateOrder=this.x.LocaleInformation.DateOrder;n.dateSeparator=this.x.LocaleInformation.DateSeparator.toString();n.decimalSeparator=this.x.LocaleInformation.DecimalSeparator.toString();n.digitsCurrency=this.x.LocaleInformation.DigitsCurrency;n.digitsNumber=this.x.LocaleInformation.DigitsNumber;n.expSeparatedBySpace=this.x.LocaleInformation.ExpSeparatedBySpace;n.fractionSeparator=this.x.LocaleInformation.FractionSeparator.toString();n.hour2Digits=this.x.LocaleInformation.Hour2Digits;n.longDateFormat=this.x.LocaleInformation.LongDateFormat;n.month2Digits=this.x.LocaleInformation.Month2Digits;n.percentSeparatedBySpace=this.x.LocaleInformation.PercentSeparatedBySpace;n.pmString=this.x.LocaleInformation.PmString;n.pmAlternativeString=this.x.LocaleInformation.PmAltString;n.thousandSeparator=this.x.LocaleInformation.ThousandSeparator.toString();n.timeSeparator=this.x.LocaleInformation.TimeSeparator.toString();n.use24HourClock=this.x.LocaleInformation.Use24HourClock;n.year4Digits=this.x.LocaleInformation.Year4Digits;n.listSeparator=this.x.LocaleInformation.ListSeparator.toString();n.columnSeparator=this.x.LocaleInformation.ColumnSeparator.toString();n.rowSeparator=this.x.LocaleInformation.RowSeparator.toString();n.trueValueString=this.x.LocaleInformation.TrueValueString;n.falseValueString=this.x.LocaleInformation.FalseValueString;n.allStructRefString=this.x.LocaleInformation.AllStructRefString;n.headersStructRefString=this.x.LocaleInformation.HeadersStructRefString;n.dataStructRefString=this.x.LocaleInformation.DataStructRefString;n.totalsStructRefString=this.x.LocaleInformation.TotalsStructRefString;n.thisRowStructRefString=this.x.LocaleInformation.ThisRowStructRefString;var t=!isNullOrUndefined(this.x.LocaleInformation.DayIndicator),i=!isNullOrUndefined(this.x.LocaleInformation.MonthIndicator),r=!isNullOrUndefined(this.x.LocaleInformation.YearIndicator);return t&&i&&r?(n.dayIndicator=this.x.LocaleInformation.DayIndicator.toString(),n.monthIndicator=this.x.LocaleInformation.MonthIndicator.toString(),n.yearIndicator=this.x.LocaleInformation.YearIndicator.toString()):Diag.a.a(34349726,0,15,"Date indicators not initialized: DayIndicator is {0}, MonthIndicator is {1}, YearIndicator is {2}",t?"not null":"null",i?"not null":"null",r?"not null":"null"),n}};_Ewa.InstantaneousSupportInformationManager.b=function(n){this.a=n};_Ewa.InstantaneousSupportInformationManager.b.prototype={a:null};_Ewa.bjQ=function(){};_Ewa.bjQ.a=function(){_Ewa.m.a(_Ewa.zb.a)};_Ewa.zb=function(n){_Ewa.zb.initializeBase(this);this.h=n;this.l()};_Ewa.zb.a=function(n){if(!n)throw Error.argumentNull("ewaControl");n.a().b(_Ewa.bkq.$$(_Ewa.dp),246,new _Ewa.zb(n))};_Ewa.zb.prototype={h:null,a:function(){if(this.h){Diag.a.a(35985040,0,50,"InstantaneousSupportInformationManagerFactory.Create: Start loading script");var n=this;_Ewa.g.a(_Ewa.x.c(47,4,this.j,!1,!1,246),function(){n.k(n.h.a().a(_Ewa.dp,268,!1,null)||new _Ewa.InstantaneousSupportInformationManager(n.h.b(),n.h))},this.i(),3,null,null)}}};_Ewa.InstantaneousSupportInformationManager.registerClass("_Ewa.InstantaneousSupportInformationManager",_Ewa.bW,_Ewa.dp,Sys.IDisposable);_Ewa.InstantaneousSupportInformationManager.b.registerClass("_Ewa.InstantaneousSupportInformationManager.b");_Ewa.zb.registerClass("_Ewa.zb",_Ewa.sX.$$(_Ewa.dp));_Ewa.bjQ.a();Type.registerNamespace("_Ewa");_Ewa.dc=function(n){this.L=Function.createDelegate(this,this.bz);this.O=Function.createDelegate(this,this.bD);this.K=Function.createDelegate(this,this.by);this.J=Function.createDelegate(this,this.bx);this.H=Function.createDelegate(this,this.bv);this.N=Function.createDelegate(this,this.bB);this.M=Function.createDelegate(this,this.bA);this.G=Function.createDelegate(this,this.bu);this.I=Function.createDelegate(this,this.bw);this.z=Function.createDelegate(this,this.X);this.y=Function.createDelegate(this,this.bI);this.q=-1;this.s=-1;this.r=-1;this.p=-1;this.a=-1;this.e=-1;this.c=n;this.w=this.c?n.e().CalcWebWorkerSmokeTestPingIntervalMS:this.w;this.b=new($$sc.s.$$(_Ewa.dc.d));this.i=null;this.j=excelOnlineCalc.location.documentLoc("",this.c.k().FullDocumentInfo.BreadcrumbDocName);this.ba()};_Ewa.dc.k=function(n){var r=[],t,i,u;if(n&&n.a)for(t=n.a.$$ge();t.$$mn();)i=t.$$cu(),u=excelOnlineCalc.calc.columnData(i.b,i.a),Array.add(r,u);return r};_Ewa.dc.l=function(n,t){var u,i,r,f,e;if(n.d!==t.d||n.c!==t.c||!_Ewa.f.b(n.f,t.f,!1)||!n.b.g(t.b))return!1;if(!n.a&&!t.a)return!0;if(!n.a||!t.a||n.a.a.f!==t.a.a.f)return!1;for(u=n.a.a.$$ge();u.$$mn();)if(i=u.$$cu(),!i.a||!(e=t.a.a.e(i.b,f={val:r},null),r=f.val,e)||!r||!_Ewa.f.b(i.a,r,!1))return!1;return!0};_Ewa.dc.c=function(n,t,i){var u=_Ewa.dc.a("NamedObject",t.e,t.b.a-1,t.b.b-1,t.b.c-1,t.b.d-1),r,f;if(t.d===2){var e=!!(t.c&16),o=!!(t.c&8),s=_Ewa.dc.k(t.a),h=excelOnlineCalc.calc.namedTableData(u,e,o,s);r=excelOnlineCalc.calc.namedObject(n,h)}else f=excelOnlineCalc.calc.namedRangeData(u),r=excelOnlineCalc.calc.namedObject(n,f);Array.add(i,r)};_Ewa.dc.g=function(n){var t=Sys.Serialization.JavaScriptSerializer.serialize(n.getRowNumbers()),i=Sys.Serialization.JavaScriptSerializer.serialize(n.getColumnNumbers());return t+i};_Ewa.dc.b=function(n){var i=null,t,r;if(n.length>1)for(t=1;t<n.length;t++)for(r=0;n[t-1]+1+r<n[t];)i=i||[],Array.add(i,n[t-1]+r),r++;return i};_Ewa.dc.f=function(n,t){if(!t)return null;for(var i=0,r=t.length;i<r;++i)if(_Ewa.f.b(n,t[i].Name,!1))return t[i];return null};_Ewa.dc.a=function(n,t,i,r,u,f){var e=function(n,t,i,r){(i<0||i>=r)&&Diag.a.a(591204771,0,15,"CalcAsyncEngine::CreateSheetRangeLocation() callerId:{0} invalid {1}:{2}",n,t,i)};return isNullOrUndefined(t)&&Diag.a.a(591189920,0,15,"CalcAsyncEngine::CreateSheetRangeLocation() callerId:{0} sheetId is null",n),e(n,"top",i,1048576),e(n,"left",r,16384),e(n,"bottom",u,1048576),e(n,"right",f,16384),excelOnlineCalc.calc.sheetRangeLocation(t,i,r,u,f)};_Ewa.dc.prototype={j:null,c:null,w:500,v:null,k:!1,u:!1,o:!1,t:0,Z:"TRUE",V:"FALSE",U:null,d:null,f:null,h:"",i:null,g:null,b:null,dispose:function(){this.f&&this.f.g(this.y);this.c&&this.c.C(this.z);this.bn()},x:function(n){if(!this.d)return!1;if(!this.f&&(this.f=this.c.a().a(_Ewa.dp,268,!1,null),!this.f))return Diag.a.a(42812304,0,50,"CalcAsyncEngine.UpdateData Failed to get instantaneousSupportInformationManager"),!1;if(n!==2&&(this.a=this.c.b().bj(),this.a===-1&&(this.a=this.c.b().d())),n===1&&this.a<this.e)return Diag.a.a(591680646,0,50,"CalcAsyncEngine::UpdateData() currentStateId:{0} < lastUpdatedStateId:{1} - ignoring update",this.a,this.e),!1;this.bM();n&&this.u||(this.bT(),this.bN(),this.bP(),this.Y(),this.f.i(this.y),this.c.B(this.z),this.u=!0);this.bK();var t=!1;return n||(t=this.bE()),(n||t)&&(this.bQ()?(this.bS(n),this.bR(),this.e=this.a,this.bl()):Diag.a.a(595072545,0,15,"CalcAsyncEngine::UpdateData() for StateId:{0} failed - no Sheets information",this.a)),n!==2&&this.l(),!0},bs:function(n){if(!this.d)return Diag.a.a(590956100,0,15,"CalcAsyncEngine.EvalFormula: recalc engine is null"),Promise.resolve({});var t=this.d.evalFormula(this.c.b().d(),n,_Ewa.D.a(this.c.d().a()));return this.l(),t},bk:function(n,t,i,r){var f,h,w,b,c;if(!this.d||!n){Diag.a.a(51513233,0,15,"CalcAsyncEngine::CalculateFormula() recalc engine is null:{0}, modifiedCell is null:{1}",!this.d,!n);return}var s=_Ewa.D.a(this.c.d().a()),e=n.a().g()-1,o=n.a().e()-1,l=e,a=o,v=null;if(r&&(v=excelOnlineCalc.calc.cellLocation(e,o),e=r.a-1,o=r.b-1,l=r.c-1,a=r.d-1),f=-1,n.a().c()){if(f=n.a().c().q(),f===-1){Diag.a.a(593503619,0,15,"CalcAsyncEngine::CalculateFormula() BlockRevision unknown for block:{0}",n.a().c().d());return}}else{Diag.a.a(593503618,0,15,"CalcAsyncEngine::CalculateFormula() GridBlockModelProxy is null cell:({0},{1})",n.a().g(),n.a().e());return}if(f<this.e){Diag.a.a(593503617,0,50,"CalcAsyncEngine::CalculateFormula() Can't calc edit in cell:({0},{1}) - blockRevision:{2} < lastUpdatedStateId:{3}",e,o,f,this.e);return}if(f<this.a){Diag.a.a(591680645,0,50,"CalcAsyncEngine::CalculateFormula() Can't calc edit in cell:({0},{1}) - blockRevision:{2} < currentStateId:{3}",e,o,f,this.a);return}if(this.k||(this.d.setOnRecalcResults(i),this.k=!0),this.bb()&&!this.x(2)){Diag.a.a(593503616,0,15,"CalcAsyncEngine.CalculateFormula: UpdateData failed");return}var k=_Ewa.dc.a("CalculateFormula.cell",s,e,o,l,a),y=[],p=_Ewa.c.a(this.c),u=p.s();_Ewa.c.a(this.c).g().c()&&(u=p.n(1).s(),u.K(1,1),u.K(3,1));h=null;u?h=_Ewa.dc.a("CalculateFormula.viewport",s,u.a-1,u.b-1,u.c-1,u.d-1):Diag.a.a(554718349,0,50,"CalcAsyncEngine::CalculateFormula() viewportRange is null, calc will use entire sheet...");w=excelOnlineCalc.calc.inferredRangeFormulaEdit(k,t,v,h);Array.add(y,w);c="CalcAsyncEngine::CalculateFormula() for sheet:{0} pos:({1},{2}) text:{3} stateId:{4} viewport:(({5},{6})-({7},{8}))";b=u?String.format(c,s,e,o,_Ewa.f.p(n.a().f()),f,u.a-1,u.b-1,u.c-1,u.d-1):String.format(c,s,e,o,_Ewa.f.p(n.a().f()),f,"","","","");Diag.a.a(51513232,0,50,b);this.d.editRangeFormulas(f,y);this.l()},bi:function(n,t,i,r){var s=_Ewa.D.a(this.c.d().a()),u=n.a().g()-1,f=n.a().e()-1,c=u,l=f,a=null,o,y,h,e;if(r&&(a=excelOnlineCalc.calc.cellLocation(u,f),u=r.a-1,f=r.b-1,c=r.c-1,l=r.d-1),o=this.F(n,i,"SetCell"),!(o<0)){var p=_Ewa.dc.a("CalculateFormula.cell",s,u,f,c,l),v=[],w=this.E(s),b=excelOnlineCalc.calc.inferredRangeFormulaEdit(p,t,a,w);Array.add(v,b);h="CalcAsyncEngine::CalculateFormula() for sheet:{0} pos:({1},{2}) text:{3} stateId:{4} viewport:(({5},{6})-({7},{8}))";e=this.W();y=e?String.format(h,s,u,f,_Ewa.f.p(n.a().f()),o,e.a-1,e.b-1,e.c-1,e.d-1):String.format(h,s,u,f,_Ewa.f.p(n.a().f()),o,"","","","");Diag.a.a(542922397,0,50,y);this.d.editRangeFormulas(o,v);this.l()}},bt:function(n,t,i,r){var o,s,u,a,c;if(!this.d)return Diag.a.a(538814167,0,15,"CalcAsyncEngine::EvalFormulaRangeOnClone recalc engine is null"),Promise.reject("RecalcService is null");Diag.a.b(538814166,0,i.o(),"CalcAsyncEngine::EvalFormulaRangeOnClone originCell must be a single cell.");var f=_Ewa.D.a(this.c.d().a()),v=this.E(f),e=null;if(n){e=[];for(var l=n,y=l.length,h=0;h<y;++h)(u=l[h],u.a().e()!==i.b)&&(o=u.a().g()-1,s=u.a().e()-1,a=_Ewa.dc.a("EvalFormulaRangeOnClone.cell",f,o,s,o,s),c=u.c(),Array.add(e,excelOnlineCalc.calc.rangeWrite(a,excelOnlineCalc.calc.valueCellData(c,c,u.a().b(),null),null,null)))}var p=excelOnlineCalc.calc.cellLocation(i.a-1,i.b-1),w=_Ewa.dc.a("EvalFormulaRangeOnClone.outputColumnRange",f,t.a-1,t.b-1,t.c-1,t.d-1),b=[excelOnlineCalc.calc.cellFormulaRangeFormulaEdit(w,r,p,v)],k=this.d.evalOnClonedModel(e,b);return this.l(),k},T:function(n){var i=null,f,e,o,s,r,t,u;try{if(!n){Diag.a.b(50671750,0,!1,"CalcAsyncEngine::CreateUpdatedRangesFromBlockModel() blockCacheItem is null");return}if(this.h=_Ewa.c.a(this.c).b().Q(n),this.a=n.U,this.a<this.e||this.a===-1){Diag.a.a(594884824,0,50,"CalcAsyncEngine::CreateUpdatedRangesFromBlockModel() hash:{0} blockRevision:{1} < lastUpdatedStateId:{2}",this.h,this.a,this.e);return}if(this.bG(),this.bh(n))return;if(f=String.format("CalcAsyncEngine::CreateUpdatedRangesFromBlockModel() Block Hash:{0} StateId:{1}",this.h,this.a),i=this.c.o().a("ModelUpdate",f),this.i=this.B(n.u.b()),!this.i){e=!!(this.c.s()&32);Diag.a.a(50671751,0,15,"CalcAsyncEngine::CreateUpdatedRangesFromBlockModel SheetName not found. Number of existing sheets {0}, scratchPad:{1}, sheetNameLength:{2} Hash:{3}",!this.b.c(this.a)||!this.b.a(this.a).a?0:this.b.a(this.a).a.length,e,n.u.b()?n.u.b().length:-1,n.u.r());return}if(o=_Ewa.c.a(this.c).b().F(),s=n.s.b,!o.c(s))return;if(r=n.b(),!r){Diag.a.a(50671752,0,15,"CalcAsyncEngine::CreateUpdatedRangesFromBlockModel no model accessor for block:{0}",this.h);return}if(t=r.getCalcBlockModel(),!t){Diag.a.a(50671753,0,15,"CalcAsyncEngine::CreateUpdatedRangesFromBlockModel no model for block");return}if(!this.bg(t))return;if(this.b.a(this.a).b[this.h]=new _Ewa.dc.j(t,n.u.b()),u=n.r,!u){Diag.a.a(574682057,0,15,"CalcAsyncEngine::CreateUpdatedRangesFromBlockModel GetGridBlockContentResponse is null");return}this.bc(u.NamedObjects)}finally{i&&i.a()}},bC:function(n){var t,i,r,u,f;if(!this.b.a(this.a).a||!this.b.a(this.a).a[0]||(t=this.b.a(this.a).a[0].a,!t||!t.c(n.N))||(i=t.a(n.N),!i||!i.a))return null;for(r=new($$sc.v.$$(String)),u=i.a.a.$$ge();u.$$mn();)f=u.$$cu(),r.b(f.a);return r},bw:function(n,t){var i,r,u;return this.n()?(r=this.b.a(this.a).a[0].a,r.c(t))?(u=excelOnlineCalc.location.nameLoc(n,t),excelOnlineCalc.util.success(u)):excelOnlineCalc.util.success(null):(i=excelOnlineCalc.util.unavailable([2]),excelOnlineCalc.util.failure(i))},bu:function(n){var u,s,t,i,h;if(!this.n())return u=excelOnlineCalc.util.unavailable([2]),excelOnlineCalc.util.failure(u);for(var f=n.range.col,e=n.range.row,c=this.b.a(this.a).a[0].a,r=null,o=c.$$ge();o.$$mn();)s=o.$$cu(),t=s.a,t.d===2&&_Ewa.f.b(n.sheet.index.toString(),t.e,!0)&&(i=t.b,f>=i.b-1&&f<=i.d-1&&e<=i.c-1&&e>=i.a-1&&(h=excelOnlineCalc.location.nameScope(this.j,t.e),r=excelOnlineCalc.location.nameLoc(h,t.f)));return r?excelOnlineCalc.util.success(r):excelOnlineCalc.util.success(null)},bA:function(n,t){var h,u,e,i,r,c,f,o,s,l,a,v;if(!this.n())return h=excelOnlineCalc.util.unavailable([2]),excelOnlineCalc.util.failure(h);if(u=n.name,e=this.b.a(this.a).a[0].a,e.c(u)){if(i=e.a(u),r=i.b,i.d!==2)return c=this.A(5),excelOnlineCalc.util.failure(c);if(f=i.a?i.a.a:null,!f)return excelOnlineCalc.util.success(null);for(o=f.$$ge();o.$$mn();)if(s=o.$$cu(),_Ewa.f.b(s.a,t,!0)){var y=excelOnlineCalc.location.documentLoc(n.scope.document.path,n.scope.document.name),p=excelOnlineCalc.location.sheetIndex(y,i.e),w=excelOnlineCalc.location.gridRange(r.a-1,s.b,r.c-r.a+1,1),b=excelOnlineCalc.location.sheetGridRange(p,w),k=!!(i.c&16),d=!!(i.c&8),g=excelOnlineCalc.location.structRefColumnLoc(u,b,k,d);return excelOnlineCalc.util.success(g)}return(l=r.d-r.b+1===f.f,!l)?(a=excelOnlineCalc.util.unavailable([17,n,t]),excelOnlineCalc.util.failure(a)):(v=this.A(0),excelOnlineCalc.util.failure(v))}return excelOnlineCalc.util.success(null)},bB:function(n,t){var e,f,r,o,l;if(!this.n())return e=excelOnlineCalc.util.unavailable([2]),excelOnlineCalc.util.failure(e);if(f=this.b.a(this.a).a[0].a,f.c(n.name)){if(r=f.a(n.name),r.d!==2)return o=this.A(5),excelOnlineCalc.util.failure(o);var s=!!(r.c&16),h=!!(r.c&8),c=s?1:0,a=h?1:0,v=excelOnlineCalc.location.documentLoc(n.scope.document.path,n.scope.document.name),y=excelOnlineCalc.location.sheetIndex(v,r.e),i=r.b,u={};if(t===1)u=excelOnlineCalc.location.gridRange(i.a-c-1,i.b-1,i.c+a-i.a+c+1,i.d-i.b+1);else if(t===2)u=excelOnlineCalc.location.gridRange(i.a-1,i.b-1,i.c-i.a+1,i.d-i.b+1);else if(t===3)if(s)u=excelOnlineCalc.location.gridRange(i.a-2,i.b-1,1,i.d-i.b+1);else return excelOnlineCalc.util.success(null);else if(t===4)if(h)u=excelOnlineCalc.location.gridRange(i.c,i.b-1,1,i.d-i.b+1);else return excelOnlineCalc.util.success(null);return l=excelOnlineCalc.location.sheetGridRange(y,u),excelOnlineCalc.util.success(l)}return excelOnlineCalc.util.success(null)},bv:function(n,t){if((_Ewa.f.b(n,this.j.path,!0)||!n)&&_Ewa.f.b(t,this.j.name,!0))return excelOnlineCalc.util.success(this.j);var i=excelOnlineCalc.util.unavailable([0,excelOnlineCalc.location.documentLoc(n,t)]);return excelOnlineCalc.util.failure(i)},bx:function(n,t){var u,r,i;if(!this.b.c(this.a)||!this.b.a(this.a).a)return u=excelOnlineCalc.util.unavailable([2]),excelOnlineCalc.util.failure(u);for(r=this.b.a(this.a).a,i=1;i<r.length;i++)if(_Ewa.f.b(r[i].b.sheetName,t,!0))return excelOnlineCalc.util.success(r[i].b.sheetId);return excelOnlineCalc.util.success(null)},by:function(n,t){var u,r,i;if(!this.b.c(this.a)||!this.b.a(this.a).a)return u=excelOnlineCalc.util.unavailable([2]),excelOnlineCalc.util.failure(u);for(r=this.b.a(this.a).a,i=1;i<r.length;i++)if(_Ewa.f.b(r[i].b.sheetId,t,!0))return excelOnlineCalc.util.success(r[i].b.sheetName);return excelOnlineCalc.util.success(null)},bD:function(){return excelOnlineCalc.util.notImplemented(["ParseGlobals.GetUserDefinedFuncLoc not implemented in main thread"])},bz:function(){return excelOnlineCalc.util.notImplemented(["ParseGlobals.GetSheetRangeIndexes not implemented in main thread"])},bj:function(n,t,i){var c=_Ewa.c.a(this.c),a=c.h(t),f=this.F(a,null,"CopyPaste"),e=this.F(c.h(n),i,"CopyPaste"),s,h;if(f<0||e<0||f!==e){Diag.a.a(542922396,0,15,"CalcAsyncEngine::CalculateFormulaForCopyPaste(). Revision not valid. sourceRevision:{0}, targetRevision:{1}.",e,f);return}var o=f,l=[],u=_Ewa.D.a(this.c.d().a()),r=this.E(u),v=_Ewa.dc.a("CalculateFormulaForCopyPaste.srcRange",u,n.a-1,n.b-1,n.c-1,n.d-1),y=_Ewa.dc.a("CalculateFormulaForCopyPaste.targetRange",u,t.a-1,t.b-1,t.c-1,t.d-1),p=excelOnlineCalc.calc.copyPasteRangePasteEdit(y,v,r);Array.add(l,p);s="";h="CalcAsyncEngine::CalculateFormulaForCopyPaste() for sheet:{0}, stateId:{1} viewport:(({2},{3})-({4},{5}))";s=r?String.format(h,u,o,r.row,r.column,r.lastRow,r.lastColumn):String.format(h,u,o,"","","","");Diag.a.a(542922395,0,50,s);this.d.editRangePaste(o,l);this.l()},E:function(n){var t=this.W(),i=null;return t?i=_Ewa.dc.a("GetViewport.viewport",n,t.a-1,t.b-1,t.c-1,t.d-1):Diag.a.a(542922394,0,50,"CalcAsyncEngine::GetViewport() viewportRange is null, calc will use entire sheet..."),i},W:function(){var t=_Ewa.c.a(this.c),n=t.s();if(_Ewa.c.a(this.c).g().c()){if(n=t.n(1).s(),_Ewa.a.a("OfficeVSO:5497152_JSCrash_At_CalcAsyncEngine_GetViewportRange")&&!n)return Diag.a.a(540615327,0,15,"CalcAsyncEngine::GetViewportRange viewportRange is null."),null;n.K(1,1);n.K(3,1)}return n},F:function(n,t,i){var r=-1,u,f;if(!this.d||!n)return Diag.a.a(542922393,0,15,"CalcAsyncEngine::ValidateCalculateFormulaInit() recalc engine is null:{0}, modifiedCell is null:{1}, operation:{2}",!this.d,!n,i),-1;if(u=n.a().g()-1,f=n.a().e()-1,n.a().c()){if(r=n.a().c().q(),r===-1)return Diag.a.a(542922392,0,15,"CalcAsyncEngine::ValidateCalculateFormulaInit() BlockRevision unknown for block:{0}, operation:{1}",n.a().c().d(),i),-1}else return Diag.a.a(542922391,0,15,"CalcAsyncEngine::ValidateCalculateFormulaInit() GridBlockModelProxy is null cell:({0},{1}), operation:{2}",n.a().g(),n.a().e(),i),-1;return r<this.e?(Diag.a.a(542922390,0,50,"CalcAsyncEngine::ValidateCalculateFormulaInit() Can't calc edit in cell:({0},{1}) - blockRevision:{2} < lastUpdatedStateId:{3}, operation:{4}",u,f,r,this.e,i),-1):r<this.a?(Diag.a.a(542922389,0,50,"CalcAsyncEngine::ValidateCalculateFormulaInit() Can't calc edit in cell:({0},{1}) - blockRevision:{2} < currentStateId:{3}, operation:{4}",u,f,r,this.a,i),-1):(t&&!this.k&&(this.d.setOnRecalcResults(t),this.k=!0),this.bb()&&!this.x(2))?(Diag.a.a(542922388,0,15,"CalcAsyncEngine.ValidateCalculateFormulaInit: UpdateData failed. operation:{0}",i),-1):r},br:function(n,t,i){var r=null,u,e,f,o;this.Q()&&this.b.a(this.e).b&&(u=this.b.a(this.e).b[n],u&&u.a&&(r=u.b));!r;e=this.bH(n,r,t,i);this.bp(r,t,e,o={val:f});f=o.val;Diag.a.a(50671754,0,50,"CalcAsyncEngine::CreateRangeUpdateCommands() completed for Block Hash:{0} StateId:{1} number of formulas {2}",n,this.a,f)},bH:function(n,t,i,r){var u=!1,e=_Ewa.dc.g(i),f;return t&&(f=_Ewa.dc.g(t),_Ewa.f.b(f,e,!1)&&(u=!0)),u?this.bd(t,this.e,r):this.bf(i,r),u},Q:function(){var n=!1;return this.d&&this.e!==-1&&(n=this.d.stateIdAvailable(this.e)),n&&this.b.c(this.e)&&this.e<this.a},bp:function(n,t,i,r){r.val=0;var u=null,f=null;for(t.reset();u=t.getNextCell();)_Ewa.cD.a(u.formula)&&r.val++,f=i?n.getCell(u.row,u.col):null,f?this.bo(t,u,f):this.be(t,u);if(i)for(n.reset();f=n.getNextCell();)u=t.getCell(f.row,f.col),u||this.P(n,f)},bP:function(){var n=this;this.d.setOnUpdateRequest(function(){})},bO:function(){var n=this;this.d.setOnUnresponsive(function(t,i,r,u){n.bJ(t,i,r,u)})},bJ:function(n,t,i,r){Diag.a.a(571245912,0,15,"CalcAsyncEngine.onUnresponsive: worker thread was unresponsive. timeout:{0}, waitTime:{1}, timeoutCount:{2}, hasBeenClosed:{3}.",n,t,i,r);r&&(this.bL(),this.ba())},bL:function(){this.X(null,null);this.k=!1;this.o=!1;this.t=0;this.q=-1;this.s=-1;this.r=-1;this.p=-1},bn:function(){this.d.close()},bm:function(){this.d.clearCache()},l:function(){this.d.resumeRecalc()},bN:function(){this.d.setA1ReferenceStyle(!0)},bK:function(){var t,e,o,s,h;if(this.f){var i=this.f.p(),r=this.f.s(),u=this.f.r(),f=this.f.q(),n=!1;i!==this.q&&(n=!0,this.q=i);r!==this.s&&(n=!0,this.s=r);u!==this.r&&(n=!0,this.r=u);f!==this.p&&(n=!0,this.p=f);t=[];_Ewa.a.c("Microsoft.Office.Excel.CalcTSExceLintExperimentIsEnabled",!1)&&(e=excelOnlineCalc.calc.runExperiment("ExceLintExperiment",null),t.push(e),n=!0);_Ewa.a.c("Microsoft.Office.Excel.UnitExperiment",!1)&&(o=excelOnlineCalc.calc.runExperiment("UnitExperiment",null),t.push(o),n=!0);_Ewa.a.c("Microsoft.Office.Excel.CalcTSAutocompleteExperimentIsEnabled",!1)&&(s=excelOnlineCalc.calc.runExperiment("AutocompleteExperiment",null),t.push(s),n=!0);n&&(h=excelOnlineCalc.calc.recalcServiceConfig(null,i,null,r,null,null,null,u,t,f),this.d.reconfigure(h))}},bS:function(n){var t=null,i,r;if(!this.b.c(this.a)){Diag.a.a(595072542,0,15,"CalcAsyncEngine::SetUpdatedRanges StateId:{0} does not exist in GridCache",this.a);return}try{this.g=[];i=String.format("CalcAsyncEngine::SetUpdatedRanges() StateId:{0} UpdateTriggerData:{1}",this.a,_Ewa.dc.i.toString(n));t=this.c.o().a("ModelUpdate",i);r=this;Common.D.f(this.b.a(this.a).b,function(n,t){t.a||(r.br(n,t.b,t.c),t.a=!0)},null);this.d.updateRanges(this.a,this.g)}finally{t&&t.a()}},bR:function(){var i=[],u=this.Q(),r=u&&this.b.a(this.e).a&&this.b.a(this.e).a[0]&&this.b.a(this.e).a[0].c?this.b.a(this.e).a[0].a:null,n,t;for(this.R(r,this.b.a(this.a).a[0].a,null,this.e,i),this.b.a(this.a).a[0].c=!0,n=1;n<this.b.a(this.a).a.length;n++)t=-1,u&&this.b.a(this.e).a&&(t=this.C(this.b.a(this.a).a[n].b.sheetName,this.e)),r=t!==-1&&this.b.a(this.e).a[t].c?this.b.a(this.e).a[t].a:null,this.R(r,this.b.a(this.a).a[n].a,this.b.a(this.a).a[n].b.sheetId,this.e,i),this.b.a(this.a).a[n].c=!0;this.d.updateNamedObjects(this.a,i)},R:function(n,t,i,r,u){var p,e,l,a,w,v,f,h,k,d,y,c,rt,g,nt,tt,it;if(isNullOrUndefined(i)||(p=excelOnlineCalc.calc.undefinedNamesWrite(i),Array.add(u,p)),!n){if(t){for(e=[],l=t.$$ge();l.$$mn();)a=l.$$cu(),_Ewa.dc.c(a.b,a.a,e);e.length>0&&(w=excelOnlineCalc.calc.namedObjectsWrite(i,e),Array.add(u,w))}return}var b=!1,o=[],s=[];if(t)for(v=t.$$ge();v.$$mn();)f=v.$$cu(),h=f.a,n.c(f.b)?(k=n.a(f.b),_Ewa.dc.l(k,h)?b=!0:(d=excelOnlineCalc.calc.namedObject(f.b,null),Array.add(o,d),_Ewa.dc.c(f.b,h,s))):_Ewa.dc.c(f.b,h,s);for(y=n.$$ge();y.$$mn();)c=y.$$cu(),rt=c.a,t&&t.c(c.b)||(g=excelOnlineCalc.calc.namedObject(c.b,null),Array.add(o,g));b&&(nt=excelOnlineCalc.calc.namedObjectsPromote(i,r),Array.add(u,nt));o.length>0&&(tt=excelOnlineCalc.calc.namedObjectsWrite(i,o),Array.add(u,tt));s.length>0&&(it=excelOnlineCalc.calc.namedObjectsWrite(i,s),Array.add(u,it))},bh:function(){return this.b.a(this.a).b[this.h]?(Diag.a.a(50671763,0,50,"CalcAsyncEngine::BlockPreviouslyHandled Block Hash:{0} StateId:{1} previously handled",this.h,this.a),!0):!1},bg:function(n){return n.getColumnNumbers().length===1&&n.getColumnNumbers()[0]===16385?!1:!0},bE:function(){var n=!1,t=this;return _Ewa.c.a(this.c).b().N(function(i){i.t&1&&t.c.b().d()===i.r.Information.Revision&&(t.T(i),n=!0)}),n},S:function(n,t){var i=n.getRowNumbers(),r=n.getColumnNumbers(),f=i[0]-1,e=i[i.length-1]-1,o=r[0]-1,s=r[r.length-1]-1,u=this.B(t);return u||Diag.a.a(594581026,0,15,"CalcAsyncEngine::CreateBlockRangeLocation SheetName not found. Number of existing sheets {0}",!this.b.c(this.a)||!this.b.a(this.a).a?0:this.b.a(this.a).a.length),_Ewa.dc.a("CreateBlockRangeLocation",u,f,o,e,s)},bd:function(n,t,i){var r=this.S(n,i);if(r){var u=_Ewa.dc.b(n.getRowNumbers()),f=_Ewa.dc.b(n.getColumnNumbers()),e=excelOnlineCalc.calc.rangePromote(r,t,u,f);this.g[this.g.length]=e}},bf:function(n,t){var i=this.S(n,t);if(i){var r=_Ewa.dc.b(n.getRowNumbers()),u=_Ewa.dc.b(n.getColumnNumbers()),f=excelOnlineCalc.calc.rangeWrite(i,null,r,u);this.g[this.g.length]=f}},bo:function(n,t,i){var u=null,f=0,e=0,r=!1,o=null,s,h;switch(t.valueType){case 2:u=this.D(t);o=this.D(i);r=_Ewa.f.b(o,u,!1);break;case 1:isNull(t.value)&&isNull(i.value)?r=!0:(f=parseFloat(t.value),s=parseFloat(i.value),r=s===f);break;default:isNull(t.value)&&isNull(i.value)?r=!0:(e=parseFloat(t.value),h=parseFloat(i.value),r=e===h)}r&&t.valueType===i.valueType&&t.ifmt===i.ifmt&&t.formulaType===i.formulaType&&_Ewa.f.b(i.formula,t.formula,!1)||(isNullOrUndefined(t.formula)&&isNullOrUndefined(t.value)&&isNullOrUndefined(t.text)?this.P(n,t):this.m(n,t,u,f,e))},bc:function(n){var e,t,u,l,a,f,y;if(this.c.m()&&this.c.m().i())for(e=0;e<this.c.m().e();e++)if(t=this.c.m().i()[e],t.R===2||t.R===3){var o=0,r=t.N,s=r.lastIndexOf("!");if(s>0){if(u=r.substr(0,s),u.charAt(0)==="'"&&(u=u.substr(1,u.length-2)),o=this.C(u,this.a),o===-1){Diag.a.a(595096334,0,15,"CalcAsyncEngine::AddNamedObjectsInBlock SheetName not found. Number of existing sheets {0}",!this.b.c(this.a)||!this.b.a(this.a).a?0:this.b.a(this.a).a.length);continue}r=r.substr(s+1)}var h=this.b.a(this.a).a[o].a,i=null,c=t.O;if(t.R===2&&(c=_Ewa.bw.a(t,!1)),h.c(r)){if(i=h.a(r),_Ewa.a.a("OfficeVSO:5502630_AddNamedObjectsInBlock_updateRange")&&(i.b=c,i.c=t.S),i.d===2&&(f=_Ewa.dc.f(t.N,n),f))if(i.a){if(f.ColHeadersList)for(var p=f.ColHeadersList.HeadersList,w=p.length,v=0;v<w;++v)y=p[v],i.a.a.b(y.Index,y.Name)}else i.a=new _Ewa.vG(f.ColHeadersList)}else{if(l=this.B(t.P),!l){Diag.a.a(574682056,0,50,"CalcAsyncEngine::AddNamedObjectsInBlock SheetName not found. Number of existing sheets {0}",!this.b.c(this.a)||!this.b.a(this.a).a?0:this.b.a(this.a).a.length);continue}i=new _Ewa.dc.e(t.R,t.N,c,l,t.S);i.d===2&&(a=_Ewa.dc.f(t.N,n),a&&(i.a=new _Ewa.vG(a.ColHeadersList)));h.b(r,i)}}},m:function(n,t,i,r,u){var l=n.getRowNumbers()[t.row]-1,a=n.getColumnNumbers()[t.col]-1,y=_Ewa.dc.a("AddRangeUpdateCommand",this.i,l,a,l,a),f=null,e=t.formula||t.text,o=excelOnlineCalc.calc.blankValue,s=null,h,c,v;isNullOrUndefined(t.text)&&isNullOrUndefined(t.value)&&(i="",s="This cell contains blanks only",t.formulaType||(e=""));switch(t.valueType){case 2:isNull(i)||(t.formulaType||(f=excelOnlineCalc.calc.valueCellData(e,i,t.ifmt,s)),t.formulaType===1&&(f=excelOnlineCalc.calc.cellFormulaCellData(e,i,t.ifmt,s)),t.formulaType===2&&(f=excelOnlineCalc.calc.valueCellData("",o,0,"This cell is a part of an array")));break;case 1:isNaN(r)?Diag.a.a(50857250,0,50,"CalcAsyncEngine::AddRangeUpdateCommand Cell({0},{1}) invalid numeric value",t.row,t.col):(t.formulaType||(f=excelOnlineCalc.calc.valueCellData(e,r,t.ifmt,null)),t.formulaType===1&&(f=excelOnlineCalc.calc.cellFormulaCellData(e,r,t.ifmt,null)),t.formulaType===2&&(f=excelOnlineCalc.calc.valueCellData("",o,0,"This cell is a part of an array")));break;case 3:isNaN(u)?Diag.a.a(50857251,0,15,"CalcAsyncEngine::AddRangeUpdateCommand Cell({0},{1}) invalid boolean value",t.row,t.col):(h=u===1?!0:!1,t.formulaType||(f=excelOnlineCalc.calc.valueCellData(e,h,t.ifmt,null)),t.formulaType===1&&(f=excelOnlineCalc.calc.cellFormulaCellData(e,h,t.ifmt,null)),t.formulaType===2&&(f=excelOnlineCalc.calc.valueCellData("",o,0,"This cell is a part of an array")));break;case 4:isNaN(u)?Diag.a.a(50857280,0,15,"CalcAsyncEngine::AddRangeUpdateCommand Cell({0},{1}) invalid error value",t.row,t.col):(c=excelOnlineCalc.calc.errorValue(u),t.formulaType||(f=excelOnlineCalc.calc.valueCellData(e,c,t.ifmt,null)),t.formulaType===1&&(f=excelOnlineCalc.calc.cellFormulaCellData(e,c,t.ifmt,null)),t.formulaType===2&&(f=excelOnlineCalc.calc.valueCellData("",o,0,"This cell is a part of an array")));break;default:f=excelOnlineCalc.calc.valueCellData("",o,t.ifmt,null)}f&&(v=excelOnlineCalc.calc.rangeWrite(y,f,null,null),this.g[this.g.length]=v)},be:function(n,t){switch(t.valueType){case 2:var i=this.D(t);this.m(n,t,i,null,0);break;case 1:this.m(n,t,null,parseFloat(t.value),0);break;default:this.m(n,t,null,null,parseFloat(t.value))}},P:function(n,t){var i=n.getRowNumbers()[t.row]-1,r=n.getColumnNumbers()[t.col]-1,u=_Ewa.dc.a("AddRangeUpdateCommandEmptyCell",this.i,i,r,i,r),f=excelOnlineCalc.calc.blankValue,e=excelOnlineCalc.calc.valueCellData("",f,t.ifmt,null),o=excelOnlineCalc.calc.rangeWrite(u,e,null,null);this.g[this.g.length]=o},B:function(n){var t=this.C(n,this.a);return t>0?this.b.a(this.a).a[t].b.sheetId:null},C:function(n,t){var r,i;if(!this.b.c(t))return Diag.a.a(595072538,0,15,"CalcAsyncEngine.GetSheetInternalIndex StateId:{0} does not exist in GridCache",t),-1;if(!this.b.a(t).a)return Diag.a.a(595072537,0,15,"CalcAsyncEngine.GetSheetInternalIndex sheetsInformation == null for StateId:{0}",t),-1;for(r=this.b.a(t).a,i=1;i<r.length;i++)if(_Ewa.f.b(r[i].b.sheetName,n,!1))return i;return-1},bQ:function(){var t,n,i;if(!this.b.c(this.a)||!this.b.a(this.a).a.length)return Diag.a.a(595072536,0,15,"CalcAsyncEngine::SetSheetNamesAndUsedRanges() No sheets information for StateId:{0} or StateId does not exist in GridCache",this.a),!1;for(t=[],n=1;n<this.b.a(this.a).a.length;n++)i=this.b.a(this.a).a[n],i&&Array.add(t,i.b);return this.d.updateSheetNames(this.a,t),this.d.updateUnusedCells(this.a,this.b.a(this.a).c),!0},Y:function(){var t,n,u;if(this.f){t=[];for(var r=this.f.b(),f=r.length,i=0;i<f;++i)n=r[i],u=excelOnlineCalc.calc.numberFormat(n.IfmtIndex,n.FormatString,n.Builtin),Array.add(t,u);this.d.setNumberFormats(t,!0)}},bM:function(){var n,t;this.f&&this.f.a()&&(n=this.bF(),!this.o||n)&&(this.bq(),this.f.a().TrueValueString&&(this.Z=this.f.a().TrueValueString),this.f.a().FalseValueString&&(this.V=this.f.a().FalseValueString),t=_Ewa.gA.d(this.f,n),this.d.setLocale(t),this.o=!0)},bT:function(){var i=3,r=null,n,t,u;isNullOrUndefined(this.c.k().TimeZoneInformation)?Diag.a.a(589088772,0,15,"CalcAsyncEngine.SetWorkbookProperties: TimeZoneInformation is null"):(n=null,this.c.k().TimeZoneInformation.StandardDate.Month&&(n=excelOnlineCalc.date.dateTime(this.c.k().TimeZoneInformation.StandardDate.Year,this.c.k().TimeZoneInformation.StandardDate.Month,this.c.k().TimeZoneInformation.StandardDate.Day,this.c.k().TimeZoneInformation.StandardDate.Hour,this.c.k().TimeZoneInformation.StandardDate.Minute,this.c.k().TimeZoneInformation.StandardDate.Second,this.c.k().TimeZoneInformation.StandardDate.DayOfWeek+1,this.c.k().TimeZoneInformation.StandardDate.Milliseconds,i)),t=null,this.c.k().TimeZoneInformation.DaylightDate.Month&&(t=excelOnlineCalc.date.dateTime(this.c.k().TimeZoneInformation.DaylightDate.Year,this.c.k().TimeZoneInformation.DaylightDate.Month,this.c.k().TimeZoneInformation.DaylightDate.Day,this.c.k().TimeZoneInformation.DaylightDate.Hour,this.c.k().TimeZoneInformation.DaylightDate.Minute,this.c.k().TimeZoneInformation.DaylightDate.Second,this.c.k().TimeZoneInformation.DaylightDate.DayOfWeek+1,this.c.k().TimeZoneInformation.DaylightDate.Milliseconds,i)),r=excelOnlineCalc.date.tzData(this.c.k().TimeZoneInformation.Bias,n,this.c.k().TimeZoneInformation.StandardBias,t,this.c.k().TimeZoneInformation.DaylightBias));u=excelOnlineCalc.calc.workbookProps(this.c.k().F1904,this.c.k().FDateCompatibility,r);this.d.setWorkbookProps(u)},bI:function(){this.Y()},X:function(){Diag.a.a(595072535,0,50,"CalcAsyncEngine.OnWorkbookOpened() called");this.b=new($$sc.s.$$(_Ewa.dc.d));this.e=-1;this.a=-1;this.h="";this.i=null;this.u=!1;this.d&&this.bm()},ba:function(){var t,r,i,n;_Ewa.a.b(315)&&(t=0,r=this,$$sc.h.a(Boolean,excelOnlineCalc.worker.runSmokeTest(1/t,this.w,!0)).CW(function(n){n.c?Diag.a.a(40768413,0,15,"CalcAsyncEngine.TryInitialize: calc smoke test failed: {0}",n.c.toString()):Diag.a.a(40768412,0,50,"CalcAsyncEngine.TryInitialize: calc smoke test ended - a new one should start")}));i=_Ewa.a.b(719)?"Local":"Thread";this.v=$$sc.h.a(Object,excelOnlineCalc.calc.createRecalcService(i,_Ewa.s.g(this.c)));n=this;this.v.CW(function(t){if(t.c)Diag.a.a(42321621,0,50,"CalcAsyncEngine.TryInitialize: Calc web worker failed: {0}",t.c.toString());else if(Diag.a.a(42321620,0,50,"CalcAsyncEngine.TryInitialize: Calc web worker is working as expected"),n.d=n.v.a(),n.d){if(!n.x(0)){Diag.a.a(594884823,0,15,"CalcAsyncEngine.TryInitialize: UpdateData failed to initialize");return}n.bO()}else Diag.a.a(42812306,0,50,"CalcAsyncEngine.TryInitialize: Calc web worker result is null")})},bF:function(){var n=this.f.c();return!n||this.t===n.length?null:(this.t=n.length,_Ewa.gA.c(n))},bq:function(){this.U=_Ewa.gA.b()},bG:function(){var i,t,n,u,r,f,e;if(!this.b.c(this.a)||!(this.b.a(this.a).a.length>0))for(this.b.b(this.a,new _Ewa.dc.d),this.b.a(this.a).a[0]=new _Ewa.dc.h(null),i=this.c.d(),t=0;t<i.e();t++)n=$$as(_Ewa.J,i.g(t)),n?((isNullOrUndefined(n.Q)||isNullOrUndefined(n.N)||!n.Q.length||!n.N.length)&&Diag.a.a(591189921,0,15,"CalcAsyncEngine::InitializeGridForStateId() invalid sheet - index:{0} Id:{1} Hash:{2} NameLength:{3}",t,n.Q,n.bs,n.N?n.N.length:-1),u=excelOnlineCalc.calc.sheetName(n.Q,n.N),this.b.a(this.a).a[t+1]=new _Ewa.dc.h(u),r=n.O.z(),f=excelOnlineCalc.calc.rangeLocation(0,0,r.LastRow,r.LastColumn),e=excelOnlineCalc.calc.unusedCellsUpdate(n.Q,f),Array.add(this.b.a(this.a).c,e)):Diag.a.a(595072534,0,15,"CalcAsyncEngine.InitializeGridForStateId(): not sheet item for StateId:{0} sheet-index:{1}",this.a,t)},bl:function(){for(var t=this.b.$$ge(),n;t.$$mn();)n=t.$$cu(),n.b<this.e&&this.b.i(n.b)},D:function(n){var t=n.value||n.text;return isNullOrUndefined(t)&&(t=""),t},bb:function(){if(!this.b.c(this.a))return!1;var n=!1,t=this;return Common.D.f(this.b.a(this.a).b,function(t,i){i.a||(n=!0)},null),n},A:function(n){var t={};return t.reason=n,t.kind=1,t},n:function(){return this.b.c(this.a)?this.b.a(this.a).a?this.b.a(this.a).a[0]?this.b.a(this.a).a[0].a?!0:!1:!1:!1:!1}};_Ewa.dc.i=function(){};_Ewa.dc.i.prototype={initialization:0,contentReady:1,cellEdit:2};_Ewa.dc.i.registerEnum("_Ewa.dc.i",!1);_Ewa.dc.m=function(){};_Ewa.dc.m.registerInterface("_Ewa.dc.m");_Ewa.dc.d=function(){this.a=[];this.c=[];this.b={}};_Ewa.dc.d.prototype={a:null,c:null,b:null};_Ewa.dc.j=function(n,t){this.b=n;this.c=t;this.a=!1};_Ewa.dc.j.prototype={b:null,c:null,a:!1};_Ewa.dc.h=function(n){this.b=n;this.a=new($$sc.q.$$(String,_Ewa.dc.e))($$sc.d.a());this.c=!1};_Ewa.dc.h.prototype={b:null,a:null,c:!1};_Ewa.dc.e=function(n,t,i,r,u){this.d=n;this.f=t;this.b=i;this.e=r;this.c=u;this.a=null};_Ewa.dc.e.prototype={d:0,f:null,e:null,b:null,c:0,a:null};_Ewa.gA=function(n){var t;this.c=n;this.d=this.c.a().a(_Ewa.dp,268,!1,null);this.d||Diag.a.b(34719498,0,!1,"CalcHelper constructor - IInstantaneousSupportInformationManager is not available");t=_Ewa.a.a("OfficeVSO:5543503_loadCalcCurrentVersion")?_Ewa.x.b.a(55):_Ewa.x.b.a(58);this.g=new _Ewa.tx;this.f=excelOnlineCalc.location.documentLoc("",this.c.k().FullDocumentInfo.BreadcrumbDocName);this.b=new _Ewa.Gj(n,this.d);var i=this,u=this,r=this.d?function(n){return i.d.t(n)}:function(){return!1};excelOnlineCalc.config.initCalc(this.g,r,t);this.a=excelOnlineCalc.config.calcConfig(this.b.a)};_Ewa.gA.d=function(n,t){var i=_Ewa.gA.b(),r=n.a().TrueValueString,u=n.a().FalseValueString,f=n.a().DecimalSeparator.toString(),e=n.a().ListSeparator.toString(),o=n.a().ColumnSeparator.toString(),s=n.a().RowSeparator.toString(),h=n.a().ThousandsDataArray,c=n.a().ThousandSeparator.toString(),l=n.a().Lcid,a=n.a().Country,v=n.a().DigitsNumber,y=n.a().ExpSeparatedBySpace,p=n.a().FractionSeparator.toString(),w=n.a().PercentSeparatedBySpace,b=_Ewa.f.M(Enum.toString(_Ewa.DH,n.a().CurrencyFormat)),k=n.a().CurrencySymbolLead,d=n.a().CurrencySeparatedBySpace,g=n.a().CurrencySymbolString,nt=n.a().DigitsCurrency,tt=n.a().DateOrder,it=tt===-1?"MDY":Enum.toString(_Ewa.DI,n.a().DateOrder).toUpperCase(),rt=n.a().DateSeparator.toString(),ut=n.a().DateAlternativeSeparator.toString(),ft=n.a().Year4Digits,et=n.a().Month2Digits,ot=n.a().Day2Digits,st=n.a().LongDateFormat,ht=n.a().TimeSeparator.toString(),ct=n.a().TimeAltSeparator==null?null:n.a().TimeAltSeparator.toString(),lt=n.a().Hour2Digits,at=n.a().Use24HourClock,vt=n.a().AmPmSeparatedBySpace,yt=[n.a().AmString,n.a().PmString],pt=n.a().DayNameShortArray,wt=n.a().DayNameLongArray,bt=n.a().MonthNameShortArray,kt=n.a().MonthNameLongArray,dt=n.a().PictureSpecialArray,gt=Common.x.d(("\x00"+n.a().PictureSingleString).split(""),function(n){return n==="\x00"?null:n}),ni=n.a().PictureColorArray,ti=n.a().PictureDbnumArray,ii=n.a().RowLetter.toString(),ri=n.a().ColumnLetter.toString(),ui=n.a().LeftBrace.toString(),fi=n.a().RightBrace.toString(),ei=n.a().LeftBracket.toString(),oi=n.a().RightBracket.toString(),si=_Ewa.gA.e(n.a()),hi=n.a().SysDateFormatString,ci=n.a().SysTimeFormatString;return excelOnlineCalc.calc.localeData(t,i,r,u,ii,ri,ui,fi,ei,oi,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,it,rt,ut,ft,et,ot,st,ht,ct,lt,at,vt,yt,pt,wt,bt,kt,dt,gt,ni,ti,si,hi,ci)};_Ewa.gA.c=function(n){var r=[],t,i;if(!n)return r;for(var f=n,e=f.length,u=0;u<e;++u)t=f[u],i=null,t.IsDynamicUdf||(i=excelOnlineCalc.calc.worksheetFunctionName(t.FunctionIndexInServer,t.NameUI)),i&&Array.add(r,i);return r};_Ewa.gA.b=function(){for(var t,i=[],r=Object.keys(_Ewa.gx.a),n=0;n<r.length;n++)t=excelOnlineCalc.calc.errorTypeName(n+1,r[n]),t&&Array.add(i,t);return i};_Ewa.gA.e=function(n){var i="#",t=new Array(6);return t[1]=i+n.AllStructRefString,t[3]=i+n.HeadersStructRefString,t[2]=i+n.DataStructRefString,t[4]=i+n.TotalsStructRefString,t[5]=i+n.ThisRowStructRefString,t};_Ewa.gA.prototype={c:null,f:null,g:null,d:null,b:null,a:null,l:function(){var t,n,i;return _Ewa.a.a("OfficeVSO:4986015_LetAutocompleteTelemetry")?(t=this.c.d(),!t)?(Diag.a.b(562394562,0,!1,"CalcHelper.CurrentSheetIndex() - this.ewaControl.Sheets is null"),0):(n=this.c.d().a(),!n)?(Diag.a.b(562394561,0,!1,"CalcHelper.CurrentSheetIndex() - sheet is null"),0):n.W:(i=this.c.d().a(),i.W)},i:function(){var n={};return n.config=this.a,excelOnlineCalc.parse.createParser(n)},h:function(){var i=this,n=function(){return excelOnlineCalc.util.failure(excelOnlineCalc.util.notImplemented(["getTime"]))},t=excelOnlineCalc.numfmt.createFormatGlobals(this.a,n);return excelOnlineCalc.numfmt.createNumberFormatter(t)},j:function(n,t,i){var r=excelOnlineCalc.location.gridCell(t,i),u=excelOnlineCalc.location.sheetIndex(this.f,n);return excelOnlineCalc.location.sheetGridCell(u,r)},m:function(n,t,i,r){r.val=excelOnlineCalc.calc.getEvalResultKind(n);switch(r.val){case 4:return n?this.b.a.trueName:this.b.a.falseName;case 1:return _Ewa.a.a("OfficeVSO:3594728_SupportEvaluatingArrayOpersToString")?this.e(this.b.c(n),t,i):this.b.c(n);case 2:return _Ewa.a.a("OfficeVSO:3594728_SupportEvaluatingArrayOpersToString")?this.e(n.toString(),t,i):n.toString();case 128:return"";case 8:var u=n;switch(u.type){case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:return this.b.a.errorNames[u.type];default:return _Ewa.gA.a}case 32:return _Ewa.a.a("OfficeVSO:3594728_SupportEvaluatingArrayOpersToString")?this.e(this.k(n,t,i),t,i):"##UNSUPPORTED: ARRAY";case 16:case 256:default:return _Ewa.ClientStringManager.a().a(2090)}},e:function(n,t,i){return!t||n.length<=i?n:n.substring(0,i-3)+"..."},k:function(n,t,i){for(var r,u=this.b.a.leftBrace,f=0;f<n.rows;++f){for(r=0;r<n.cols;++r)u+=n.opers[f][r],r<n.cols-1&&(u+=this.b.a.columnSeparator);f<n.rows-1&&(u+=this.b.a.rowSeparator)}return this.e(u,t,i-1)+this.b.a.rightBrace}};_Ewa.Gj=function(n,t){t&&(t.a()||Diag.a.b(34445250,0,!1,"LocaleHolder constructor - locale information is not available"));this.b=_Ewa.gA.d(t,_Ewa.gA.c(t.c()));this.a=excelOnlineCalc.calc.localeInfoFromData(this.b)};_Ewa.Gj.prototype={a:null,b:null,c:function(n){return this.a.formatNumber(n)}};_Ewa.CalcManager=function(n){this.J=Function.createDelegate(this,this.T);this.K=Function.createDelegate(this,this.U);this.O=Function.createDelegate(this,this.bf);this.P=Function.createDelegate(this,this.bg);this.Q={};this.R={};Diag.a.a(34936847,0,50,"Creating CalcManager");this.L=!1;this.E=n;this.D=_Ewa.c.a(n);this.B=null;this.D.C(this.P);this.D.b().B(this.O);var t=this;this.E.a().c(_Ewa.dp,268,function(n){n.a()?(Diag.a.a(576071815,0,50,"CalcManager.ctor: LocaleInformation already available..."),t.U(n,Sys.EventArgs.Empty)):(Diag.a.a(576071814,0,50,"CalcManager.ctor: waiting for LocaleInformation..."),n.i(t.K))},null)};_Ewa.CalcManager.c=function(n,t){return t.length>n.span.end&&t.charAt(n.span.end)==="#"};_Ewa.CalcManager.b=function(n){return _Ewa.p.a(n.range.row+1,n.range.col+1,!1)};_Ewa.CalcManager.prototype={C:null,I:!1,H:null,F:null,N:null,L:!1,r:function(){return this.L},B:null,D:null,E:null,G:null,a:function(){return this.G},g:function(){return this.B?this.B.a.localeInfo:null},q:function(){return this.B.a},dispose:function(){Diag.a.a(34445255,0,50,"CalcManager.Dispose called");var n=this;this.E.a().c(_Ewa.dp,268,function(t){t.g(n.K);t.f(n.J)},null);this.D&&(this.D.I(this.P),this.D.b()&&this.D.b().R(this.O),this.D=null);this.B=null;this.Q=null;this.R=null},l:function(n,t,i,r){this.C&&(_Ewa.a.a("OfficeVSO:5470583_Calculate_Formula_Refactoring")?this.C.bi(n,t,i,r):this.C.bk(n,t,i,r))},m:function(n){return this.C?this.C.bs(n):Promise.reject("calc engine not initialized")},n:function(n,t,i,r){return this.C?this.C.bt(n,t,i,r):Promise.reject("CalcEngine is null")},f:function(n){return this.C?(Diag.a.b(574682055,0,n.k()===2,"CalcManager.GetTableHeaders() - ActiveItem is not a table"),this.C.bC(n)):null},i:function(n,t){if(!t||n.k()!==2)return!1;var i=_Ewa.bw.a(n,!1);return i.d-i.b+1===t.f.length},p:function(n){var r,t,i;if(!this.H)return this.I||Diag.a.a(37826832,0,15,"CalcManager.ExtractReferenceWrappers - parser not initialized"),null;if(r=this.d(_Ewa.p.a(1,1,!1)),t=this.H.parseFormula(2,r,1,n),!excelOnlineCalc.parse.parseResultHelper.isSuccess(t))return Diag.a.a(37826833,0,10,"CalcManager.ExtractReferenceWrappers - ParseFormula failed"),null;try{if(_Ewa.a.c("Microsoft.Office.Excel.StructuredReferencesHighlighting",!1)){var u=this.D.a().a().a(),f=excelOnlineCalc.location.gridCell(u.a-1,u.b-1),e=excelOnlineCalc.location.documentLoc("",this.E.k().FullDocumentInfo.BreadcrumbDocName),o=excelOnlineCalc.location.sheetIndex(e,this.E.d().a().Q),s=this.X(!0,!0,f,o);this.N||(this.N=excelOnlineCalc.util.createResolver(this.W()));i=excelOnlineCalc.parse.parseResultHelper.extractReferences(t,this.B.a.localeInfo,_Ewa.a.b(644),s,this.N)}else i=excelOnlineCalc.parse.parseResultHelper.extractReferences(t,this.B.a.localeInfo,_Ewa.a.b(644),null,null);return _Ewa.a.b(104)&&this.bi(i,n),i}catch(h){return Diag.a.a(39396449,0,10,"CalcManager.ExtractReferenceWrappers - exception: {0}",h.message),null}},o:function(n,t){var r,i;if(!this.H)return this.I||Diag.a.a(588891980,0,15,"CalcManager.ExtractLetVariables - parser not initialized"),null;if(r=this.d(_Ewa.p.a(1,1,!1)),i=this.H.parseFormula(2,r,1,n),!excelOnlineCalc.parse.parseResultHelper.isSuccess(i))return Diag.a.a(588891979,0,10,"CalcManager.ExtractLetVariables - ParseFormula failed"),null;try{return excelOnlineCalc.parse.parseResultHelper.extractLetVariables(i,t,this.B.a.localeInfo)}catch(u){return Diag.a.a(588891978,0,10,"CalcManager.ExtractLetVariables - exception: {0}",u.message),null}},b:function(n,t,i){var r;if(!t)return Diag.a.a(38576192,0,10,"CalcManager.ExtractReferences - sheetName is null"),null;if(!i)return Diag.a.a(38576193,0,10,"CalcManager.ExtractReferences - documentName is null"),null;if(r=this.p(n),!r)return Diag.a.a(39396450,0,15,"CalcManager.ExtractReferences - ExtractReferenceWrappers returned null"),null;try{return this.V(r,t,i,n)}catch(u){return Diag.a.a(37826834,0,10,"CalcManager.ExtractReferences - exception: {0}",u.message),null}},u:function(n,t,i,r){var u,f,s,h,e,o;return n?!t||t.length<=0?(Diag.a.a(42473291,0,10,"CalcManager.GetSubExpressionSpanForContextualFormulaPreview - formula is null/empty"),null):(u=this.d(n),!this.B||!u)?null:(f=!1,e=(h=this.Z(u,s={val:f}),f=s.val,h),!e||e.W())?null:(o=excelOnline.utils.getCharIndexInTextFromPoint(i,r,_Ewa.a.b(644)),o<0)?null:excelOnlineCalc.runtime.getSubExpressionFromFormulaCharacterIndex(this.B.a,o,t,u):(Diag.a.a(42473290,0,10,"CalcManager.GetSubExpressionSpanForContextualFormulaPreview - range is null"),null)},j:function(n,t,i,r){if(!n)return Diag.a.a(41756244,0,10,"CalcManager.CalcPartialResultsForFormula - range is null"),null;var u=null,f=this,e=function(n){var o,s,h,t=(h=f.B.m(n,!0,i,s={val:o}),o=s.val,h),e,c;return o!==8||t.length&&t!==_Ewa.gA.a?e=0:(Diag.a.a(41756250,0,50,"EvalSession.GetPartialResultValueForFormula - EvalResultToString error"),c=excelOnlineCalc.calc.getEvalFailureReason(n),isNullOrUndefined(c)&&Diag.a.b(587559249,0,!1,"CalcHelper.GetEvalFailureReason() - result is not a failure, function should not be called"),e=1),u=r?new _Ewa.mD(t,r.start,r.end,e):new _Ewa.mD(t,-1,-1,e)},o=this;return this.m(t).then(e,function(n){return Diag.a.a(41756251,0,10,"EvalSession.GetPartialResultValueForFormula - exception: {0}",n),Promise.resolve(u)})},v:function(n){return!this.B||!n?null:excelOnlineCalc.runtime.getSubExpressionSpan(n)},s:function(n,t,i){return!this.B||!n||!t||!i?null:excelOnlineCalc.runtime.getFormulaSubExpressionObject(this.B.a,t,i,this.d(n))},x:function(n,t,i){return!this.B||!n||!t?null:excelOnlineCalc.runtime.getSubstitutedSubExpressionString(this.B.a,t,i,this.d(n))},w:function(n,t,i){return!this.B||!n||!t?null:excelOnlineCalc.runtime.getSubExpressionSubspans(this.B.a.localeInfo,t,i)},t:function(){return this.B?this.B.a.localeInfo.listSeparator:null},A:function(n){return this.B?excelOnlineCalc.runtime.isFormulaSubExpressionVolatile(this.B.a.localeInfo,n):!1},d:function(n){if(!n||!this.B)return null;return this.B.j(this.B.l(),n.a-1,n.b-1)},z:function(n,t){var i=this.h(n),r,u;return isNullOrUndefined(i)?null:(r=this.G.createFormat(i.FormatString,i.Builtin),!excelOnlineCalc.util.isSuccess(r))?null:(u=this.G.parseEdit(t,r.value),!excelOnlineCalc.util.isSuccess(u))?null:u.value.kind==="Formula"},e:function(n){var i,t,r,u;if(!n.b())return Diag.a.a(555032866,0,50,"CalcManager.GetNumberFormat: invalid format was given! ifmt: {0}, format string: {1}, format obj: {2}",n.a()!=null?n.a().toString():"null",n.c()?_Ewa.f.e(n.c()):"null",n.d()?"!null":"null"),null;if(i=n.e(),Object.getType(i).getName()==="String")t=this.R;else if(Object.getType(i).getName()==="Number")t=this.Q;else return Diag.a.a(555848470,0,10,"CalcManager.GetNumberFormat: key is of unknown type!"),null;return(r=i.toString(),r in t)?(u=t[r],u.d()):(t[r]=n,n.d())},y:function(n){return this.g().getWorksheetFuncId(n)},V:function(n,t,i,r){var b=_Ewa.a.b(757),h={},a,u,s,k,v,f,l,p,w,e,o,g;for(h.Items=new Array(0),a=0;a<n.length;a++)if(u=n[a],s={},s.Start=u.span.start,s.End=u.span.end,b&&u.kind==="function")k=u.ref,s.End=u.span.start+k.name.length,v={},v.Span=s,v.IsFunction=!0,Array.add(h.Items,v);else if(b&&u.kind==="literal"){var d=u.ref,y=d.value.oper.kind,c={};c.Span=s;c.IsString=y===2;c.IsBoolean=y===4;c.IsNumber=y===1;Array.add(h.Items,c)}else{if(!this.Y(u,t,i))continue;f=new _Ewa.CalcManager.a;l=this.bc(u,t,f,r);_Ewa.a.b(644)?(p=this.bb(u),w=this.ba(u),(l||w&&p>=0)&&(e={},e.Span=s,e.LetNumber=p,e.LetName=w,e.Range=l,e.IsRangeRef=f.e,e.IsAbsoluteFirstRow=f.b,e.IsAbsoluteFirstColumn=f.a,e.IsAbsoluteSecondRow=f.d,e.IsAbsoluteSecondColumn=f.c,e.IsStructRef=u.kind==="structRefRange",Array.add(h.Items,e))):l&&(o={},o.Span=s,o.Range=l,o.IsRangeRef=f.e,o.IsAbsoluteFirstRow=f.b,o.IsAbsoluteFirstColumn=f.a,o.IsAbsoluteSecondRow=f.d,o.IsAbsoluteSecondColumn=f.c,o.IsStructRef=u.kind==="structRefRange",Array.add(h.Items,o))}return g=this,h.Items.sort(function(n,t){return n.Span.Start-t.Span.Start}),h},bb:function(n){if(n.kind==="letName"){var t=n.ref;return t.number}return-1},ba:function(n){if(n.kind==="letName"){var t=n.ref;return t.name}return null},bc:function(n,t,i,r){var o,u,s,e,f;return n.kind==="range"?(i.e=!0,this.S(n,t,i,r)):n.kind==="namedRange"?(o=n.ref,u=this.E.m().b(o.name),u||(u=this.E.m().b(t+"!"+o.name)),!u||!u.b()||!u.f())?null:_Ewa.f.b(u.b(),t,!0)?(s=u.k()===2?_Ewa.bw.a(u,!1):u.f(),_Ewa.h.s(s,u)):null:n.kind==="structRefRange"?(e=n.ref,f={},e.name?(f=this.E.m().b(e.name),f||(f=this.E.m().b(t+"!"+e.name))):f=this.D.e().a(this.D.a().a().a(),!1),!f||!f.b()||!f.f())?null:_Ewa.f.b(f.b(),t,!0)?(i.e=!1,this.S(n,t,i,r)):null:null},S:function(n,t,i,r){var u=n.ref,k,c;if(u.type){if(u.type==="col"){var p=u,w=p.startIndex,b=p.endIndex;return i.a=w.kind==="Abs",i.c=b.kind==="Abs",this.M(0,w.index,1048576,b.index,t)}if(u.type==="row"){var f=u,d=f.startIndex,g=f.endIndex;return i.b=d.kind==="Abs",i.d=g.kind==="Abs",this.M(f.startIndex.index,0,f.endIndex.index,16384,t)}if(u.type==="cell"){var h=u,e=h.row,o=h.col;return(i.b=i.d=e.kind==="Abs",i.a=i.c=o.kind==="Abs",this.c(h.span.end,r)&&(k=_Ewa.p.a(e.index+1,o.index+1,!1),c=this.D.e().t(k),c))?_Ewa.h.G(c,t):this.M(e.index,o.index,e.index,o.index,t)}if(u.type==="range"){var s=u,l=s.top,a=s.left,v=s.bottom,y=s.right,nt=Math.min(l.index,v.index),tt=Math.min(a.index,y.index),it=Math.max(l.index,v.index),rt=Math.max(a.index,y.index);return i.b=l.kind==="Abs",i.d=v.kind==="Abs",i.a=a.kind==="Abs",i.c=y.kind==="Abs",this.M(nt,tt,it,rt,t)}return Diag.a.a(37826835,0,10,"CalcManager.CovertFormulaRefToRange: Unsupported formula ref type '{0}'",u.type),null}return Diag.a.a(38082381,0,15,"CalcManager.CovertFormulaRefToRange: traverseFormulaRef.Type is null"),null},c:function(n,t){return t.length>=n&&n>0&&t.charAt(n-1)==="#"},k:function(n,t,i){this.C&&this.C.bj(n,t,i)},h:function(n){return!this.F||!this.F.b()||!this.F.b()[n]||!this.G?null:this.F.b()[n]},bi:function(n,t){var i,u;if(n)for(var f=n,e=f.length,r=0;r<e;++r)(i=f[r],i.ref.type&&i.ref.type==="cell")&&(u=i.ref,_Ewa.CalcManager.c(u,t)&&(u.span.end+=1,i.span.end+=1))},M:function(n,t,i,r,u){var f={};return f.FirstRow=n,f.FirstColumn=t,f.LastRow=i,f.LastColumn=r,f.SheetName=u,f},Y:function(n,t,i){var r=n.ref.qualifier,f,e,l,a,h;if(!r)return!0;switch(n.ref.qualifier.type){case"Sheet":return f=r,e=f.document,_Ewa.f.b(f.sheet,t,!0)&&(!e||_Ewa.f.b(e.document,i,!0));case"SheetRange":var c=r,u=this.E.d().b(t),o=this.E.d().b(c.sheet1),s=this.E.d().b(c.sheet2);return!!u&&!!o&&!!s&&(o.c()<=u.c()&&u.c()<=s.c()||s.c()<=u.c()&&u.c()<=o.c());case"Document":return l=r,_Ewa.f.b(l.document,i,!0);case"Ident":return a=r,h=a.name,_Ewa.f.b(h,t,!0)||_Ewa.f.b(h,i,!0);default:return Diag.a.a(38113474,0,10,"CalcManager.GetQualifierData: Unsupported formula qualifier type '{0}'",r.type),!1}},be:function(){var n=!0;try{n=excelOnlineCalc!==undefined}catch(t){return!1}try{n=excelOnlineCalc.location!==undefined}catch(i){return!1}return!0},bh:function(n){return(this.F=n,!n.b().length||!n.c().length)?(Diag.a.a(34936850,0,15,"CalcManager.TryInitializeInternal: IInstantaneousSupportInformationManager locale information missing, cannot initialize calc. number formats count = {0}, functions info count = {1}",n.b().length,n.c().length.toString()),!1):this.be()?(this.B=new _Ewa.gA(this.D.c()),this.H=this.B.i(),this.G=this.B.h(),this.L=!0,Diag.a.a(34936851,0,50,"CalcManager.TryInitializeInternal: calc initialized"),this.C||(Diag.a.a(40768414,0,50,"CalcManager creating calc engine"),this.C=new _Ewa.dc(this.E)),!0):(Diag.a.b(40939861,0,this.I,"CalcManager.TryInitializeInternal: ExcelOnlineCalc is not loaded, any usage of it causes JS crash. Aborting calc initialization."),this.I=!0,!1)},U:function(n){Diag.a.a(34936852,0,50,"CalcManager.OnLocaleInformationAvailable() called");var t=n;if(t.g(this.K),!t.c().length){Diag.a.a(34936853,0,50,"CalcManager.OnLocaleInformationAvailable() - waiting for functions information");t.h(this.J);return}this.T(n,Sys.EventArgs.Empty)},T:function(n){Diag.a.a(34936854,0,50,"CalcManager.OnFunctionsInfoReady called");var t=n;t.f(this.J);this.bh(t)},bg:function(){if(this.C&&(!this.F||!this.F.e())){var n=this;$$sc.a.b(0).CWCT(function(){n.C.x(1)},null,0,$$sc.c.a)}},bf:function(n,t){this.C&&(this.F&&this.F.e()||this.C.T(t.a.a))},Z:function(n,t){var r,u,i;return(t.val=!1,!n)?null:(r=this.bd(n.sheet.index),!r)?(Diag.a.a(37789893,0,50,"CalcManager.GetCellFromBlockCache: No sheet index {0}",n.sheet.index),null):(u=_Ewa.CalcManager.b(n),i=this.D.cg(r,u.a,u.b),!i)?(Diag.a.a(37789894,0,50,"CalcManager.GetCellFromBlockCache: cellProxy is null for cell {0} {1}",n.range.row,n.range.col),null):i.bT()?i:(Diag.a.a(37789895,0,50,"CalcManager.GetCellFromBlockCache: cell {0} {1} is empty",n.range.row,n.range.col),t.val=!0,null)},bd:function(n){var t=this.D.c().d().g(n);return t?t.b():(Diag.a.a(37789896,0,50,"CalcManager.GetSheetName - no sheet in index {0}",n),null)},X:function(n,t,i,r){var u={};return u.allowUnqualifiedCell=n,u.wrapCellReferences=t,u.config=this.B.a,u.originGridCell=excelOnlineCalc.util.success(i),u.originSheet=excelOnlineCalc.util.success(r),u},W:function(){var n={};return n.config=this.B.a,n.getNameLoc=this.C.I,n.getContainingTable=this.C.G,n.getStructRefColumn=this.C.M,n.getStructRefSpecialRef=this.C.N,n.getDocumentLoc=this.C.H,n.getSheetIndex=this.C.J,n.getSheetName=this.C.K,n.getUserDefinedFuncLoc=this.C.O,n.getSheetRangeIndexes=this.C.L,n}};_Ewa.CalcManager.a=function(){};_Ewa.CalcManager.a.prototype={e:!1,b:!1,a:!1,d:!1,c:!1};_Ewa.va=function(n){_Ewa.va.initializeBase(this);this.h=n;this.l()};_Ewa.va.a=function(n){n&&n.a()&&n.a().b(_Ewa.bkq.$$(_Ewa.dg),265,new _Ewa.va(n))};_Ewa.va.prototype={h:null,a:function(){var t,i,n;if(!this.h){Diag.a.a(38082339,0,50,"CalcManagerFactory.Create: ewaControl is null, cann't create the service");return}Diag.a.a(38082369,0,50,"CalcManagerFactory.Create: Start loading script");_Ewa.a.a("OfficeVSO:5543503_loadCalcCurrentVersion")?(t=55,i="Current"):(t=58,i="Stable");Diag.a.a(592221332,0,50,"CalcManagerFactory.Create: Calc {0} JS was loaded",i);n=this;_Ewa.g.a(_Ewa.x.c(t,4,this.j,!1,!1,265),function(){Diag.a.a(38082370,0,50,"CalcManagerFactory.Create: Raised create service event");var t=n.h.a().a(_Ewa.dg,266,!1,null);t||(Diag.a.a(39982036,0,50,"CalcManagerFactory.Create: CalcManager is not registered, creating new CalcManager"),t=new _Ewa.CalcManager(n.h));n.k(t)},this.i(),3,null,null)}};_Ewa.ColoredReferencesManager=function(n,t){this.n=Function.createDelegate(this,this.y);this.h=["rgba(95, 140, 237, {0})","rgba(235, 94, 96, {0})","rgba(141, 97, 194, {0})","rgba(45, 150, 57, {0})","rgba(191, 76, 145, {0})","rgba(227, 130, 34, {0})","rgba(55, 127, 158, {0})"];this.g=n;this.f=_Ewa.c.a(n);this.j=t;this.p=_Ewa.a.a("OfficeVSO:5041666_ImplementLogRecorderOnEwaJS");this.q=_Ewa.a.a("OfficeVSO:5617699_FormulaSelectionFix");this.r=_Ewa.a.a("OfficeVSO:5658633_IsSelectionUndoCrashFixEnabled");this.s=_Ewa.s.b(this.g)&&_Ewa.a.a("OfficeVSO:5623187_SelectSmartSuggestionsByDefault");this.f.f().h(this.n)};_Ewa.ColoredReferencesManager.prototype={f:null,g:null,j:null,p:!1,q:!1,r:!1,s:!1,t:!1,l:!1,c:function(n,t){var r,l,i,rt,s,p,w,b,ut,k,d,ft,lt,et,ot;if(this.p&&n.a().d("ColoredReferencesManager.TryUpdateColoredReferences",null),this.t||this.s&&n.W())return!1;if(r=isNullOrUndefined(t)?n.b():t,this.j&&r.length>1&&_Ewa.cD.a(r)){var g=this.o(),st=this.w(),ht=this.u(),h=!1,c=Math.random()<.01?$$as(_Ewa.dr,this.g.o().a("LoadingUIShown","ColoredReferencesManager")):null;try{if(l=this.j.b(r,st,ht),!l)return Diag.a.a(37859356,0,50,"ColoredReferencesManager.UpdateColoredReferences: extractReferences is null (might be an invalid formula)"),!1;for(var o=new Array(0),u=new Array(0),nt=new Array(0),a=new Array(0),f=0,tt=0,e=new _Ewa.y(!1),v="",it=l.Items,ct=it.length,y=0;y<ct;++y)i=it[y],h=!!(h|i.IsStructRef),i.IsBoolean||i.IsNumber||i.IsString?(rt=i.IsBoolean?"rgba(0, 0, 255, 1)":i.IsNumber?"rgba(9, 134, 88, 1)":"rgba(163, 21, 21, 1)",this.i(u,r,f,i.Span.Start,null),this.i(u,r,i.Span.Start,i.Span.End,rt),f=i.Span.End):_Ewa.a.b(644)?(i.Range||i.LetName&&i.LetNumber>=0)&&(s=null,i.Range?(p=_Ewa.h.b(i.Range),s=this.k(p,e,1),Array.add(o,new _Ewa.bP(p,g))):i.LetName&&i.LetNumber>=0&&(v=this.x(i.LetName,i.LetNumber,e,1,v),s=v,tt!==e.a.length&&n.w().b(i.Span.Start+"-"+i.Span.End,this.h[(e.a.length-1)%this.h.length])),this.i(u,r,f,i.Span.Start,null),this.i(u,r,i.Span.Start,i.Span.End,s),f=i.Span.End,Array.add(nt,i.Span),w=u.length-1,Array.add(a,new _Ewa.jH(w,u[w].text,i,!1)),tt=e.a.length):i.Range&&(b=_Ewa.h.b(i.Range),ut=this.k(b,e,1),this.i(u,r,f,i.Span.Start,null),this.i(u,r,i.Span.Start,i.Span.End,ut),Array.add(o,new _Ewa.bP(b,g)),f=i.Span.End,Array.add(nt,i.Span),k=u.length-1,Array.add(a,new _Ewa.jH(k,u[k].text,i,!1)));return(this.i(u,r,f,r.length,null),this.z(n,u,!!t),d=n.a().e(),!_Ewa.f.b(d,r,!1))?(Diag.a.b(38114182,0,!1,"ColoredReferencesManager.UpdateColoredReferences: The text we created is different from the original text. Setting the original text back. currentTextLength [{0}], originalTextLength [{1}]",d.length,r.length),ft=n.a().b(),n.a().i(r),n.a().h(ft),!0):(this.m(o,e,a),_Ewa.a.b(644)&&o.length>0&&Diag.a.a(587559248,0,50,"ColoredReferencesManager.UpdateColoredReferences: Cell reference(s) colored"),_Ewa.a.b(644)&&n.w().a.length>0&&Diag.a.a(587559247,0,50,"ColoredReferencesManager.UpdateColoredReferences: Let name(s) colored"),this.l=!0,!0)}finally{c&&(lt=this,c.f(function(){h&&Diag.a.a(555061504,0,50,"ColoredReferencesManager.UpdateColoredReferences: Formula with structured reference is highlighted in {0} ms",c.b())},!1))}}else return(this.m(null,null,null),this.l&&(this.l=!1,this.r?(et=n.a().b(),n.a().w(r),n.a().h(Math.min(et,r.length))):this.q?(ot=n.a().b(),n.a().w(r),n.a().h(ot)):n.a().w(r),t))?!0:!1},b:function(n,t,i){var r,s,c,h,f,e;if(!n||!t||!i)return Diag.a.b(38926101,0,!!n,"ColoredReferencesManager.MoveMarqueeRange: cellContentEditor is null"),Diag.a.b(38926102,0,!!t,"ColoredReferencesManager.MoveMarqueeRange: highlightState is null"),Diag.a.b(38926103,0,!!i,"ColoredReferencesManager.MoveMarqueeRange: newRange is null"),!1;if(r=$$as(_Ewa.jH,t.h),!r)return Diag.a.b(38621456,0,!1,"ColoredReferencesManager.MoveMarqueeRange: marqueeMetadata is null"),!1;var l=r.h,o=r.c,u=this.f.e().m(i)?i.bz(r.a,r.b):i.bd(r.a,r.b,r.d,r.e);if(!u)return Diag.a.b(38926104,0,!1,"ColoredReferencesManager.MoveMarqueeRange: newText is null"),!1;if(s=o.indexOf("!"),s!==-1&&(u=o.substring(0,s+1)+u),c=n.a().bv(l,o,u),!c)return Diag.a.b(38926105,0,!1,"ColoredReferencesManager.MoveMarqueeRange: failed to change the text part"),!1;for(r.c=u,h=!0,f=1;f<=4;f++){if(e=_Ewa.c.a(this.g).j().e(3,f,t.f),!e){Diag.a.b(38926106,0,!1,"ColoredReferencesManager.MoveMarqueeRange: highlightStateInPane is null");h=!1;continue}e.b=i;e.h=r}return this.f.j().f(!1,!1),this.f.k().n()&&this.f.k().a().i(n.b()),this.f.k().B(new _Ewa.jU(!0)),h},d:function(n){if(n.c!==3)return Diag.a.b(38847496,0,!1,"ColoredReferencesManager.IsMarqueeHighlightDragable: not HighlightDivIndex.Marquee."),!1;var t=$$as(_Ewa.jH,n.h);return t?t.g&&!t.f:(Diag.a.b(38847497,0,!1,"ColoredReferencesManager.IsMarqueeHighlightDragable: marqueeMetadata is null."),!1)},e:function(n,t){return Diag.a.a(42767445,0,50,"ColoredReferencesManager.SuspendResumeColoredReferences: "+(t?"suspending":"resuming")+" colored references"),t&&(this.m(null,null,null),n.a().di()),this.t=t,!1},dispose:function(){this.f&&this.f.f()&&this.f.f().f(this.n)},a:function(n){var c=this.o(),l=this.w(),a=this.u(),u=new Array(0),f=new _Ewa.y(!1),e=new Array(0),o=this.j.b(n,l,a),t,r,h;if(o){for(var s=o.Items,v=s.length,i=0;i<v;++i)t=s[i],t.Range&&(r=_Ewa.h.b(t.Range),Array.add(u,new _Ewa.bP(r,c)),this.k(r,f,1),h=n.substring(t.Span.Start,t.Span.End),Array.add(e,new _Ewa.jH(t.Span.Start,h,t,!0)));this.m(u,f,e)}},k:function(n,t,i){var r=t.c[n.toString()]||null,u;return r||(u=t.a.length%this.h.length,r=this.h[u],t.b(n.toString(),r)),String.format(r,i)},x:function(n,t,i,r,u){var o="["+n+", "+t+"]",f=i.c[o]||null,e;return f||(e=i.a.length%this.h.length,f=this.h[e],u===String.format(f,r)&&(i.b("skip-"+o,f),e=i.a.length%this.h.length,f=this.h[e]),i.b(o,f)),String.format(f,r)},i:function(n,t,i,r,u){if(Diag.a.b(37859357,0,i<=r,"ColoredReferencesManager.AddTextPart: startIndex cannot be larger than endIndex"),i<r){var e=t.substring(i,r),f;Array.add(n,(f=new _Ewa.Db,f.text=e,f.color=u,f))}},m:function(n,t,i){var u,r;if(!n||!n.length){u=this.g.o().a("UserAction","HideRangesHighlightsStopwatch");this.f.j().a([3]);this.f.j().l(new _Ewa.bP(null,this.o()),[3],!0);u.a();return}Diag.a.a(41492675,0,50,"ColoredReferencesManager.HighlightRanges: number of ranges to highlight: "+n.length);n.reverse();i.reverse();r=this;this.f.j().c(n,[3],!0,function(n,u){if(!n||!n.b||!u){Diag.a.b(37859358,0,!!n,"ColoredReferencesManager.HighlightRanges: state is null");Diag.a.b(37859359,0,!!n.b,"ColoredReferencesManager.HighlightRanges: state.Range is null");Diag.a.b(37859360,0,!!u,"ColoredReferencesManager.HighlightRanges: div is null");return}Diag.a.b(37859361,0,t.d(n.b.toString()),"ColoredReferencesManager.HighlightRanges: The range '{0}' doesn't exist in the range to color dictionary",n.b.toString());var f=r.k(n.b,t,.1),e=r.k(n.b,t,1),o=!!r.g.r()&&!!r.g.r().Z()&&r.g.r().Z().a();o||(u.style.background=f);u.style.borderColor=e;i&&(u.setAttribute("IndexInMarqueeCollection",n.f),n.h=i[n.f])},!0)},z:function(n,t,i){var r=n.a(),u;r.n=!0;var f=r.G(),e=f.index,o=e+f.length;r.bF(t);u=r.e().length;r.l(Math.min(e,u),Math.min(o,u));i&&n.B(new _Ewa.jU(!1));r.n=!1},o:function(){return this.v().Q},w:function(){return this.v().N},u:function(){return this.g.k().WorkbookFileName},v:function(){return this.f.X()&&this.f.X().b()?this.f.X().b():this.g.h()},y:function(){this.l=!1}};_Ewa.vb=function(n){_Ewa.vb.initializeBase(this);this.h=n;this.l()};_Ewa.vb.a=function(n){n.a().b(_Ewa.bkq.$$(_Ewa.gB),282,new _Ewa.vb(n))};_Ewa.vb.prototype={h:null,a:function(){var n=this;this.h.a().c(_Ewa.dg,266,function(t){n.k(new _Ewa.ColoredReferencesManager(n.h,t))},null)}};_Ewa.jH=function(n,t,i,r){if(this.h=n,this.c=t,this.f=r,!i){Diag.a.b(39856346,0,!1,"MarqueeMetadata.Ctor: parseResultItem is null");return}this.g=i.IsRangeRef;this.b=i.IsAbsoluteFirstRow;this.a=i.IsAbsoluteFirstColumn;this.e=i.IsAbsoluteSecondRow;this.d=i.IsAbsoluteSecondColumn};_Ewa.jH.prototype={h:0,c:null,g:!1,b:!1,a:!1,e:!1,d:!1,f:!1};_Ewa.RelativeAndAbsoluteReferencesManager=function(n){this.b=n};_Ewa.RelativeAndAbsoluteReferencesManager.d=function(n,t){return n.index<=t.index?n:t};_Ewa.RelativeAndAbsoluteReferencesManager.e=function(n,t){return t||n?t&&n?2:!t&&n?3:0:1};_Ewa.RelativeAndAbsoluteReferencesManager.prototype={b:null,a:function(n,t,i,r,u){var h;if(r.val=t,u.val=i,!n||!n.length||!_Ewa.cD.a(n))return n;if(h=this.b.p(n),!h)return Diag.a.a(39396451,0,15,"RelativeAndAbsoluteReferencesManager.CycleThroughRelativeAndAbsoluteReferences: Couldn't extract references (might be invalid formula)"),null;for(var e=this.e(h,n,t,i),c=0,o=new Sys.StringBuilder,s=0,f=0;f<e.length;f++)if(this.c(e[f],t,i)){c=e[f].f();r.val=e[f].c;break}for(;f<e.length;f++){if(!this.c(e[f],t,i))break;o.append(n.substring(s,e[f].c));e[f].g(c,o);s=e[f].a}return s&&(u.val=o.toString().length),o.append(n.substring(s,n.length)),o.toString()},e:function(n,t,i,r){for(var ft,f,et,d,l,lt,u,e,y,at,g,a,vt,nt,v,yt,ot,tt,p,h,w,st,it,ht,rt,b,c,k,ct,ut,s=[],o=0;o<n.length;o++)if(ft=n[o],ft.kind==="range")if(f=ft.ref,f.type==="cell")et=f,lt=(l=new _Ewa.RelativeAndAbsoluteReferencesManager.b,l.c=f.span.start,l.a=f.span.end,l.b=[(d=new _Ewa.RelativeAndAbsoluteReferencesManager.a,d.a=et.col,d.b=et.row,d)],l.d=this.b.c(f.span.end,t),l),s.push(lt);else if(f.type==="range")u=f,this.d(u.topLeftSpan,i,r)&&this.d(u.bottomRightSpan,i,r)?(e=new _Ewa.RelativeAndAbsoluteReferencesManager.h,u.top.index<=u.bottom.index?(e.b=u.top,e.c=u.bottom):(e.c=u.top,e.b=u.bottom),u.left.index<=u.right.index?(e.a=u.left,e.d=u.right):(e.d=u.left,e.a=u.right),at=(y=new _Ewa.RelativeAndAbsoluteReferencesManager.i,y.c=u.topLeftSpan.start,y.a=u.bottomRightSpan.end,y.b=[e],y),s.push(at)):(vt=(a=new _Ewa.RelativeAndAbsoluteReferencesManager.b,a.c=u.topLeftSpan.start,a.a=u.topLeftSpan.end,a.b=[(g=new _Ewa.RelativeAndAbsoluteReferencesManager.a,g.a=u.left,g.b=u.top,g)],a.d=this.b.c(u.topLeftSpan.end,t),a),yt=(v=new _Ewa.RelativeAndAbsoluteReferencesManager.b,v.c=u.bottomRightSpan.start,v.a=u.bottomRightSpan.end,v.b=[(nt=new _Ewa.RelativeAndAbsoluteReferencesManager.a,nt.a=u.right,nt.b=u.bottom,nt)],v.d=this.b.c(u.topLeftSpan.end,t),v),s.push(vt),s.push(yt));else if(f.type==="col"){for(ot=f,h=(p=new _Ewa.RelativeAndAbsoluteReferencesManager.g,p.c=f.span.start,p.a=f.span.end,p.b=[(tt=new _Ewa.RelativeAndAbsoluteReferencesManager.c,tt.a=ot.startIndex,tt.b=ot.endIndex,tt)],p);h.a<t.length-1&&t.charAt(h.a)===":"&&o<n.length-1;)if(w=n[o+1].ref,w.type==="col"&&w.span.start===h.a+1)st=w,h.b.push((it=new _Ewa.RelativeAndAbsoluteReferencesManager.c,it.a=st.startIndex,it.b=st.endIndex,it)),h.a=w.span.end,o++;else break;s.push(h)}else if(f.type==="row"){for(ht=f,c=(b=new _Ewa.RelativeAndAbsoluteReferencesManager.j,b.c=f.span.start,b.a=f.span.end,b.b=[(rt=new _Ewa.RelativeAndAbsoluteReferencesManager.f,rt.a=ht.startIndex,rt.b=ht.endIndex,rt)],b);c.a<t.length-1&&t.charAt(c.a)===":"&&o<n.length-1;)if(k=n[o+1].ref,k.type==="row"&&k.span.start===c.a+1)ct=k,c.b.push((ut=new _Ewa.RelativeAndAbsoluteReferencesManager.f,ut.a=ct.startIndex,ut.b=ct.endIndex,ut)),c.a=k.span.end,o++;else break;s.push(c)}return s},c:function(n,t,i){return!(n.c>i||t>n.a)},d:function(n,t,i){return!(n.start>i||t>n.end)}};_Ewa.RelativeAndAbsoluteReferencesManager.k=function(){};_Ewa.RelativeAndAbsoluteReferencesManager.k.prototype={c:0,a:0,b:null,g:function(n,t){for(var r,i=0;i<this.b.length;i++)r=this.e(n,this.b[i]),t.append(r),i<this.b.length-1&&t.append(":")}};_Ewa.RelativeAndAbsoluteReferencesManager.b=function(){_Ewa.RelativeAndAbsoluteReferencesManager.b.initializeBase(this)};_Ewa.RelativeAndAbsoluteReferencesManager.b.prototype={d:!1,f:function(){var n=this.b[0],t=n.b.kind==="Abs",i=n.a.kind==="Abs";return _Ewa.RelativeAndAbsoluteReferencesManager.e(t,i)},e:function(n,t){var i=t,u=i.b.index+1,f=i.a.index+1,r=_Ewa.p.a(u,f,!1);return this.d?r.bz(n===1||n===3,n===1||n===2):r.bd(n===1||n===3,n===1||n===2,!0,!0)}};_Ewa.RelativeAndAbsoluteReferencesManager.i=function(){_Ewa.RelativeAndAbsoluteReferencesManager.i.initializeBase(this)};_Ewa.RelativeAndAbsoluteReferencesManager.i.prototype={f:function(){var n=this.b[0],t=n.b.kind==="Abs",i=n.a.kind==="Abs";return _Ewa.RelativeAndAbsoluteReferencesManager.e(t,i)},e:function(n,t){var i=t,f=i.b.index+1,e=i.c.index+1,o=i.a.index+1,s=i.d.index+1,h=new _Ewa.p(f,o,e,s,!1,!1),r=n===1||n===3,u=n===1||n===2;return h.bd(r,u,r,u)}};_Ewa.RelativeAndAbsoluteReferencesManager.g=function(){_Ewa.RelativeAndAbsoluteReferencesManager.g.initializeBase(this)};_Ewa.RelativeAndAbsoluteReferencesManager.g.prototype={f:function(){var n=this.b[0],t=_Ewa.RelativeAndAbsoluteReferencesManager.d(n.a,n.b),i=t.kind==="Abs";return i?2:3},e:function(n,t){var i=t,r=i.a.index+1,u=i.b.index+1,f=_Ewa.p.e(r,u,!1);return f.bd(n===1||n===3,!0,n===1||n===3,!0)}};_Ewa.RelativeAndAbsoluteReferencesManager.j=function(){_Ewa.RelativeAndAbsoluteReferencesManager.j.initializeBase(this)};_Ewa.RelativeAndAbsoluteReferencesManager.j.prototype={f:function(){var n=this.b[0],t=_Ewa.RelativeAndAbsoluteReferencesManager.d(n.a,n.b),i=t.kind==="Abs";return i?0:1},e:function(n,t){var i=t,r=i.a.index+1,u=i.b.index+1,f=_Ewa.p.f(r,u,!1);return f.bd(!0,n===1||n===2,!0,n===1||n===2)}};_Ewa.RelativeAndAbsoluteReferencesManager.a=function(){};_Ewa.RelativeAndAbsoluteReferencesManager.a.prototype={b:null,a:null};_Ewa.RelativeAndAbsoluteReferencesManager.h=function(){};_Ewa.RelativeAndAbsoluteReferencesManager.h.prototype={b:null,c:null,a:null,d:null};_Ewa.RelativeAndAbsoluteReferencesManager.c=function(){};_Ewa.RelativeAndAbsoluteReferencesManager.c.prototype={a:null,b:null};_Ewa.RelativeAndAbsoluteReferencesManager.f=function(){};_Ewa.RelativeAndAbsoluteReferencesManager.f.prototype={a:null,b:null};_Ewa.vc=function(n){_Ewa.vc.initializeBase(this);this.h=n;this.l()};_Ewa.vc.a=function(n){n.a().b(_Ewa.bkq.$$(_Ewa.mC),295,new _Ewa.vc(n))};_Ewa.vc.prototype={h:null,a:function(){var n=this;this.h.a().c(_Ewa.dg,266,function(t){n.k(new _Ewa.RelativeAndAbsoluteReferencesManager(t))},null)}};_Ewa.dc.registerClass("_Ewa.dc",null,Sys.IDisposable);_Ewa.dc.d.registerClass("_Ewa.dc.d");_Ewa.dc.j.registerClass("_Ewa.dc.j");_Ewa.dc.h.registerClass("_Ewa.dc.h");_Ewa.dc.e.registerClass("_Ewa.dc.e");_Ewa.CalcManager.registerClass("_Ewa.CalcManager",null,_Ewa.dg,Sys.IDisposable);_Ewa.va.registerClass("_Ewa.va",_Ewa.sX.$$(_Ewa.dg));_Ewa.ColoredReferencesManager.registerClass("_Ewa.ColoredReferencesManager",null,_Ewa.gB,Sys.IDisposable);_Ewa.vb.registerClass("_Ewa.vb",_Ewa.sX.$$(_Ewa.gB));_Ewa.jH.registerClass("_Ewa.jH");_Ewa.RelativeAndAbsoluteReferencesManager.registerClass("_Ewa.RelativeAndAbsoluteReferencesManager",null,_Ewa.mC);_Ewa.RelativeAndAbsoluteReferencesManager.k.registerClass("_Ewa.RelativeAndAbsoluteReferencesManager.k");_Ewa.RelativeAndAbsoluteReferencesManager.b.registerClass("_Ewa.RelativeAndAbsoluteReferencesManager.b",_Ewa.RelativeAndAbsoluteReferencesManager.k);_Ewa.RelativeAndAbsoluteReferencesManager.i.registerClass("_Ewa.RelativeAndAbsoluteReferencesManager.i",_Ewa.RelativeAndAbsoluteReferencesManager.k);_Ewa.RelativeAndAbsoluteReferencesManager.g.registerClass("_Ewa.RelativeAndAbsoluteReferencesManager.g",_Ewa.RelativeAndAbsoluteReferencesManager.k);_Ewa.RelativeAndAbsoluteReferencesManager.j.registerClass("_Ewa.RelativeAndAbsoluteReferencesManager.j",_Ewa.RelativeAndAbsoluteReferencesManager.k);_Ewa.RelativeAndAbsoluteReferencesManager.c.registerClass("_Ewa.RelativeAndAbsoluteReferencesManager.c");_Ewa.RelativeAndAbsoluteReferencesManager.f.registerClass("_Ewa.RelativeAndAbsoluteReferencesManager.f");_Ewa.vc.registerClass("_Ewa.vc",_Ewa.sX.$$(_Ewa.mC));_Ewa.gA.a="##ERR##";Type.registerNamespace("_Ewa");_Ewa.bea=function(){};_Ewa.bea.a=function(){_Ewa.m.a(_Ewa.va.a);_Ewa.m.a(_Ewa.vb.a);_Ewa.m.a(_Ewa.vc.a)};_Ewa.bea.a();