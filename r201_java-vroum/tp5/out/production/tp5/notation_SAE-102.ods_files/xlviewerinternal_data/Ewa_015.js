Type.registerNamespace("Common.App.AppsForOfficeCommon");Common.App.AppsForOfficeCommon.C=function(){};Common.App.AppsForOfficeCommon.k=function(){this.Ver=1};Common.App.AppsForOfficeCommon.s=function(){};Common.App.AppsForOfficeCommon.s.prototype={a:0};Common.App.AppsForOfficeCommon.g=function(n){this.d=n};Common.App.AppsForOfficeCommon.g.prototype={f:"__OSF_OMEX.appDetails.{0}",d:null,h:function(n){var t=new Date;return Math.abs(t.getTime()-n.CreatedOn)<864e5*n.RR},g:function(n,t){var r=this.d.b(n),i;if(r){i=new Common.App.AppsForOfficeCommon.k;try{i=Sys.Serialization.JavaScriptSerializer.deserialize(r,!0)}catch(u){return this.d.a(n),null}return t?this.h(i)?i.Data?i.Data:i.data:(this.d.a(n),null):i.Data?i.Data:i.data}return null},c:function(n,t,i){var r=new Common.App.AppsForOfficeCommon.k;r.Data=t;r.data=t;r.RR=i;r.CreatedOn=(new Date).getTime();this.d.c(n,Sys.Serialization.JavaScriptSerializer.serialize(r))},b:function(n){var t=String.format("__OSF_PRIVATECATALOG_ADDINDETAILS_{0}",n);return this.e(t)},a:function(n){var t=String.format(this.f,n);return this.e(t)},e:function(n){var i=this.g(n,!1),r=i,t=r;return t&&t.a===1?!0:!1}};Common.App.AppsForOfficeCommon.k.registerClass("Common.App.AppsForOfficeCommon.k");Common.App.AppsForOfficeCommon.s.registerClass("Common.App.AppsForOfficeCommon.s");Type.registerNamespace("Common.App.OAuth");Common.App.OAuth.d=function(){};Common.App.OAuth.d.registerInterface("Common.App.OAuth.d");Common.App.OAuth.b=function(){};Common.App.OAuth.b.prototype={unknown:0,supported:1,userUnsupported:2,browserUnsupported:3,hostUnsupported:4};Common.App.OAuth.b.registerEnum("Common.App.OAuth.b",!1);Common.App.OAuth.j=function(){};Common.App.OAuth.j.prototype={succeeded:0,failed:1,timedOut:2};Common.App.OAuth.j.registerEnum("Common.App.OAuth.j",!1);Common.App.OAuth.r=function(){};Common.App.OAuth.r.registerInterface("Common.App.OAuth.r");Common.App.OAuth.s=function(){};Common.App.OAuth.s.registerInterface("Common.App.OAuth.s");Common.App.OAuth.f=function(){};Common.App.OAuth.f.prototype={external:0,msa:1,aad:2};Common.App.OAuth.f.registerEnum("Common.App.OAuth.f",!0);Common.App.OAuth.k=function(){};Common.App.OAuth.l=function(n){this.g=n};Common.App.OAuth.l.prototype={g:null,b:function(){return Promise.resolve(0)},c:function(){return Promise.resolve(0)},e:function(){Diag.a.a(574239257,3e3,50,"Automation flag set.  Returning Mock Token.");var n;return Promise.resolve((n=new Common.bE,n.IsSuccess=!0,n.Token=this.g,n))},f:function(){var n;return Promise.resolve((n=new Common.bE,n.IsSuccess=!1,n.ErrorCode="authTokenStrategy_loginNotSupported",n.ErrorMessage="This Token Strategy does not support login flow, TryLogin could not be completed",n))},d:function(){return!1},a:function(){return"MockAuthTokenStrategy"}};Common.App.OAuth.c=function(){};Common.App.OAuth.c.b=function(){var t=Common.a.a.b("UserPrincipalName")||"",i=t,n;return Common.a.a.d("Microsoft.Office.SharedOnline.OAuthLoginHintEnabled",!1)&&(i=Common.App.OAuth.a.w()||t),n=new Common.App.OAuth.k,n.upn=t,n.loginHint=i,n.authority=Common.App.OAuth.a.n(),n.authorityType=Common.App.OAuth.c.a(),n.tenantId=Common.a.a.b("TenantId")||"",n};Common.App.OAuth.c.a=function(){var n=0,t=Common.App.OAuth.c.c();return t.toLowerCase()==="aad"?n=2:t.toLowerCase()==="msa"&&(n=1),n};Common.App.OAuth.c.c=function(){return Common.a.a.b("HostAuthType")||""};Common.App.OAuth.e=function(n){var t=this,i=this;this.k=this.o(n).then(function(n){return n?t.r():Promise.resolve(1)}).then(function(n){return n?Promise.resolve(n):i.t()})};Common.App.OAuth.e.a=function(){return Common.a.a.d("Microsoft.Office.SharedOnline.OAuthInteractiveFallbackEnabled",!1)};Common.App.OAuth.e.c=function(){return Common.a.a.d("Microsoft.Office.SharedOnline.OAuthLoginFlowEnabled",!1)};Common.App.OAuth.e.d=function(){var n=Common.App.OAuth.a.q();return n&&(Common.c.i()&&Array.contains(n,"Electron")||Common.c.Y()&&Array.contains(n,"Safari")&&!Common.App.OAuth.e.a())?!1:!0};Common.App.OAuth.e.prototype={f:0,e:null,k:null,m:0,p:function(){var n=Common.App.OAuth.a.v(),t,r,i;if(n&&n.length>0){this.f=1;this.e=new Common.App.OAuth.l(n);return}if(t=!1,r=Common.a.a.a("IsO365ConsumerHost")||Common.a.a.a("IsO365CommercialHost")||t,!r){this.f=4;this.e=new Common.App.OAuth.g(this.f);return}if(i=Common.App.OAuth.c.b().loginHint,!i||!i.length||!t&&Common.a.a.a("IsAnonymousUser")){this.f=2;this.e=new Common.App.OAuth.g(this.f);return}if(Common.App.OAuth.a.f()){this.f=1;this.e=new Common.App.OAuth.n;return}if(!Common.App.OAuth.e.d()){this.f=3;this.e=new Common.App.OAuth.g(this.f);return}this.f=1;this.e=new Common.App.OAuth.q},d:function(){return this.e?this.e.a()||"Unknown":"None"},o:function(n){Diag.a.a(562128578,3e3,50,"Creating OAuthManager.");var t=Common.g.a(),i=this,r=this;return Common.a.a.N().then(function(r){return r?(i.p(),n&&(i.e=n),Diag.a.a(42084323,3e3,50,"Creation succeeded OAuthManager successfully in {4} ms with clientVer={0}, appVer={1}, docVer={2}, strategy={3}",5,Common.App.OAuth.a.k(),Common.App.OAuth.a.r(),i.d(),Math.floor(Common.g.a()-t))):Diag.a.a(562128579,3e3,15,"Creation failed for OAuthManager, unable to get app settings after {0} ms, all future TryGetToken requests will fail.",Math.floor(Common.g.a()-t)),Promise.resolve(r)},function(){return Diag.a.a(562128580,3e3,15,"Creation failed for OAuthManager, unable to get app settings after {0} ms, all future TryGetToken requests will fail.",Math.floor(Common.g.a()-t)),Promise.resolve(!1)})},r:function(){Diag.a.a(573390991,3e3,50,"Initializing {0}",this.d());var t=Common.g.a(),n=this,i=this;return Common.App.OAuth.e.b.a(this.e.b(),2,Common.App.OAuth.a.m()).then(function(i){var r,u,o,f,e,s;return i?i===1?(r=n.h(),isNullOrUndefined(r)||(r.set("AuthLibrary",n.d()),o=(u=new Common.U,u.durationMs=Math.floor(Common.g.a()-t),u.extendedProperties=r,u),Common.i.a().recordKpiFailure("OAuthManager","StrategyInitFailed",!1,!0,o))):i===2&&(Diag.a.a(42267908,3e3,15,"Initialization timed out for {0} after {1} ms, all future TryGetToken requests will fail.",n.d(),Math.floor(Common.g.a()-t)),f=n.h(),isNullOrUndefined(f)||(f.set("AuthLibrary",n.d()),s=(e=new Common.U,e.durationMs=Math.floor(Common.g.a()-t),e.extendedProperties=f,e),Common.i.a().recordKpiFailure("OAuthManager","StrategyInitTimedOut",!1,!0,s))):Diag.a.a(42084353,3e3,50,"Initialization succeeded for {0} in {1} ms.",n.d(),Math.floor(Common.g.a()-t)),Promise.resolve(i)},function(){return Diag.a.a(574239256,3e3,15,"Initialization failed for {0} after {1} ms, all future TryGetToken requests will fail.",i.d(),Math.floor(Common.g.a()-t)),Promise.resolve(1)})},t:function(){Diag.a.a(562128581,3e3,50,"Loading {0}",this.d());var n=Common.g.a(),t=this,i=this;return Common.App.OAuth.e.b.a(this.e.c(Common.App.OAuth.c.b()),2,Common.App.OAuth.a.m()).then(function(i){return i?i===1?Diag.a.a(562128583,3e3,15,"Load failed for {0} after {1} ms, all future TryGetToken requests will fail.",t.d(),Math.floor(Common.g.a()-n)):i===2&&Diag.a.a(558469660,3e3,15,"Load timed out for {0} after {1} ms, all future TryGetToken requests will fail.",t.d(),Math.floor(Common.g.a()-n)):Diag.a.a(562128582,3e3,50,"Load succeeded for {0} in {1} ms.",t.d(),Math.floor(Common.g.a()-n)),Promise.resolve(i)},function(){return Diag.a.a(562128584,3e3,15,"Load failed for {0} after {1} ms, all future TryGetToken requests will fail.",i.d(),Math.floor(Common.g.a()-n)),Promise.resolve(1)})},a:function(n,t,i){return this.j(n,t,!1,null,"",i,0)},c:function(n,t,i,r,u){return this.j(n,t,!0,i,r,u,0)},j:function(n,t,i,r,u,f,e){var h,c,o,l;if(e+=1,Diag.a.a(42084352,3e3,50,"OAuthManager TryGetToken(appName={0}, target={1}) called.  Using strategy {2} - attempt {3}",n,this.g(n,t),this.d(),e),h=this.h(),isNullOrUndefined(h)||(h.set("AuthLibrary",this.d()),h.set("AppName",n),h.set("Target",this.g(n,t)),Common.i.a().recordKpiUsage("OAuthManager",0,"WacOAuthFC",h)),!Common.App.OAuth.a.u())return this.l((c=new Common.bE,c.IsSuccess=!1,c.Token=null,c.ErrorCode="NotEnabled",c.ErrorMessage="OAuthManager is disabled.",c),n);if(o=Common.App.OAuth.a.j()[n],isNullOrUndefined(o))return Diag.a.a(41961345,3e3,15,"Auth context not found. Ensure that your app [{0}] is listed in the OAuthManagerApplications setting.",n),this.l((l=new Common.bE,l.IsSuccess=!1,l.Token=null,l.ErrorCode="DisallowedApp",l.ErrorMessage="Disallowed appName: "+n,l),n);var v=Common.g.a(),p=this,w=this.k.then(function(e){return p.s(n,o,t,i,r,u,f,e)}),y=i?0:Common.App.OAuth.a.m(),a,b=(a=new Common.bE,a.IsSuccess=!1,a.Token=null,a.ErrorCode="authTokenStrategy_timeout",a.ErrorMessage="Auth Strategy timed out after ["+y+"] ms when fetching token",a),k=Common.App.OAuth.e.b.a(w,b,y),s=this,d=this;return k.then(function(h){if(e<=2&&(h.ErrorCode==="Timeout"||h.ErrorCode==="authTokenStrategy_timeout"))return Diag.a.a(573175516,3e3,50,"TryGetToken attempt {0} timed out after {1} ms - retrying",e,Math.floor(Common.g.a()-v)),s.j(n,t,i,r,u,f,e);if(h.ErrorCode==="Cookies Disabled"&&!i){if(Diag.a.a(561517645,3e3,50,"TryGetToken attempt {0} failed with ITP error.  3P Cookies are [{1}]. Retry: [{2]}]",e,Common.App.OAuth.e.a()),Common.App.OAuth.e.c()&&s.e.d()){var c=s.e.f(n,o,t,i,r,u,f);c.then(function(i){return Promise.resolve(s.i(i,n,t,o,v))}).catch(function(){var i,r=(i=new Common.bE,i.IsSuccess=!1,i.Token=null,i.ErrorCode="authTokenStrategy_failure",i.ErrorMessage="LoginPopup failed, GetToken could not be called",i);return Promise.resolve(s.i(r,n,t,o,v))})}if(Common.App.OAuth.e.a())return s.j(n,t,!0,r,u,f,e)}return Promise.resolve(s.i(h,n,t,o,v))}).catch(function(){var i,r=(i=new Common.bE,i.IsSuccess=!1,i.Token=null,i.ErrorCode="authTokenStrategy_failure",i.ErrorMessage="Auth Strategy failed with an unknown error",i);return Promise.resolve(d.i(r,n,t,o,v))})},s:function(n,t,i,r,u,f,e,o){var s,h,c;return o===1||o===2?this.l((s=new Common.bE,s.IsSuccess=!1,s.Token=null,s.ErrorCode="InitFailed",s.ErrorMessage="Auth Strategy Failed to Init or Load",s),n):(h=this,c=this,this.e.e(n,t,i,r,u,f,e).then(function(t){return Promise.resolve(h.n(t,!0,n))}).catch(function(t){return Promise.resolve(c.n(t,!1,n))}))},i:function(n,t,i,r,u){var f={},s=Common.g.a()-u,e,o,h;return f.IsSuccess=n.IsSuccess,f.ErrorCode=n.IsSuccess?"Success":n.ErrorCode||"",f.ErrorMessage=n.IsSuccess?"Success":this.g(t,n.ErrorMessage||""),f.Target=this.g(t,i||""),f.TimeInMS=Math.floor(s),f.AuthLibrary=this.d(),f.AppName=t,f.AuthorityType=Common.App.OAuth.f.toString(Common.App.OAuth.c.a()),f.UserType=this.q(Common.App.OAuth.c.b()),f.IsAuthSupportedInSession=Common.App.OAuth.b.toString(this.f),f.RequestCount=++this.m,f.AppId=r,Diag.a.a(593863640,3e3,50,JSON.stringify(f)),n.IsSuccess||(e=this.h(),isNullOrUndefined(e)||(e.set("AppName",t),e.set("AuthLibrary",this.d()),e.set("ErrorCode",n.ErrorCode),e.set("ErrorMessage",this.g(t,n.ErrorMessage)),h=(o=new Common.U,o.durationMs=s,o.extendedProperties=e,o),Common.i.a().recordKpiFailure("OAuthManager","TryGetTokenFailure",!1,!0,h))),n},l:function(n,t){var i,r,u;return Diag.a.a(578435090,3e3,15,"OAuthManager failed without invoking GetToken. AppName: '{0}', Reason: '{1}'",t,this.g(t,n.ErrorMessage)),i=this.h(),isNullOrUndefined(i)||(i.set("AppName",t),i.set("AuthLibrary",this.d()),i.set("ErrorCode",n.ErrorCode),i.set("ErrorMessage",this.g(t,n.ErrorMessage)),u=(r=new Common.U,r.extendedProperties=i,r),Common.i.a().recordKpiFailure("OAuthManager","FailureBeforeGetToken",!1,!0,u)),Promise.resolve(n)},g:function(n,t){return n==="AddinShared"&&t?"REDACTED":t},q:function(n){return Common.a.a.a("IsAnonymousUser")?"anonymous":!n.loginHint||n.loginHint.length<1?"empty":n.loginHint.indexOf("guest#")>-1?"guest":n.loginHint.indexOf("ext#")>-1?"external":n.upn.indexOf("@")<0?"no-at":"supported"},b:function(){return this.f===1},n:function(n,t,i){var r=n,o=null,u=null,f=null,s=null,e;return r?r.ErrorCode||r.ErrorMessage?(u=r.ErrorCode?r.ErrorCode:"Exception",f=r.ErrorMessage?r.ErrorMessage:"No message"):r.Token?t?o=r.Token:(u="RejectToken",f="A rejected promise returned a token."):(u="Exception",f=JSON.stringify(r)):(u="NoResult",f="No result came from Auth Token Strategy"),!r||!r.Telemetry||i==="AddinShared"||(s=r.Telemetry,Diag.a.a(579166408,3e3,50,JSON.stringify(s))),(u==="monitor_window_timeout"||u==="token_renewal_error")&&(u="Timeout",f="Auth Library Timed Out"),u==="login_required"&&f.indexOf("AADSTS50058")>-1&&(u="Cookies Disabled"),(u||f)&&(o=null),e=new Common.bE,e.IsSuccess=!!o,e.Token=o,e.ErrorCode=u,e.ErrorMessage=f,e.Telemetry=s,e},h:function(){try{return new Map}catch(n){return null}}};Common.App.OAuth.e.b=function(){};Common.App.OAuth.e.b.a=function(n,t,i){if(!i)return n;var r=0;return Promise.race([n,new Promise(function(n){r=window.setTimeout(function(){n(t)},i)})]).then(function(n){return window.clearTimeout(r),Promise.resolve(n)}).catch(function(){return window.clearTimeout(r),Promise.resolve(t)})};Common.App.OAuth.m=function(){};Common.App.OAuth.m.a=function(){Common.App.a.a().a(new Common.App.OAuth.m,0,!1)};Common.App.OAuth.m.prototype={a:function(){return"Common.App.OAuth.OAuthPackage"},c:function(n){var t=this;n.c(Common.App.OAuth.d,null).a().b(function(){return new Common.App.OAuth.e(null)})},b:function(){var n=Common.Utils.a.a().a(Common.App.OAuth.d,null);this.d(n)},d:function(n){var e=Common.a.a.b("FileSource"),i,r,f,h,t,c,a;if((Common.a.a.a("IsO365ConsumerHost")||Common.a.a.a("IsO365CommercialHost")||e==="WopiTest")&&(i=Common.App.OAuth.a.t(),r=Common.App.OAuth.a.n(),!isNullOrUndefined(i)&&i.length&&!isNullOrUndefined(r)&&r.length)&&(r!=="https://login.microsoftonline.com/"||Common.a.a.d("Microsoft.Office.SharedOnline.CorePFTEnabled",!1))){var u=Common.App.OAuth.b.toString(n.f),o=Common.c.x(),s=n.d(),l=Common.a.a.a("IsAnonymousUser");l&&Diag.a.a(559272964,3e3,50,'OAuthManager skipped attempt to get a Core token to the WAC FrontEnd API for an anonymous user. SupportStatus={0}, Host="{1}", Browser="{2}", Strategy="{3}"',u,e,o,s);f="WacCorePFT";h="WacOAuthFC";try{t=new Map;isNullOrUndefined(t)?t=null:(t.set("SupportStatus",u),t.set("Browser",o),t.set("AuthStrategy",s))}catch(v){t=null}Common.i.a().recordKpiUsageForAlertableKpi(f,h,t);c=Common.g.a();a=this;n.a("Core",i,null).then(function(i){var l=Math.floor(Common.g.a()-c),r,h;u=Common.App.OAuth.b.toString(n.f);Diag.a.a(562943369,3e3,50,'OAuthManager attempted to get a Core token to the WAC FrontEnd API in {0} ms. Success={1}, SupportStatus={2}, ErrorCode="{3}", Host="{4}", Browser="{5}", AuthStrategy="{6}"',l,i.IsSuccess,u,i.ErrorCode,e,o,s);h=(r=new Common.U,r.durationMs=l,r.extendedProperties=t,r);i.IsSuccess?Common.i.a().recordKpiSuccess(f,h):Common.i.a().recordKpiFailure(f,i.ErrorCode,!1,!1,h)})}}};Common.App.OAuth.n=function(){var i="Unspecified",n=Common.a.a.b("UiHost"),t=Common.a.a.b("UiHostIntegrationType");n=n&&n!==""?n:i;t=t&&t!==""?t:i;this.g=String.format("ParentFrameTokenStrategy uiHost={0} uiHostIntegrationType={1}",n,t)};Common.App.OAuth.n.prototype={g:null,h:null,b:function(){var n=this;return new Promise(function(t){Common.Utils.a.a().b(Common.App.WopiIdentity.d,null).a(function(i){n.h=i;t(0)})})},i:function(n){for(var u,i=!1,f=n.toLocaleUpperCase(),r=["HTTPS:","API:"],e=r.length,t=0;t<e;++t)if(u=r[t],f.startsWith(u)){i=!0;break}return i||this.j(n)?n+"/.default":n},j:function(n){var t=new RegExp("/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i");return t.test(n)},c:function(){return Promise.resolve(0)},e:function(n,t,i,r,u,f,e){var s,c,h,o,l;if(Common.c.r()&&(s=!1,c=Common.a.a.d("Microsoft.Office.SharedOnline.HostSupportsTeamsElectronSSO",!1),c&&(h=Common.App.OAuth.a.z(),h&&(s=Array.contains(h,n))),!s))return l=(o=new Common.bE,o.IsSuccess=!1,o.ErrorCode="TeamsDisallowedApp",o.ErrorMessage="Disallowed appName: "+n,o),Promise.resolve(l);var a=this.i(i),v=new Common.App.WopiIdentity.g(i,a,!r,null,Common.a.j),y=this,p=this;return this.h.getAccessToken(v,t,e).then(function(n){var t;return t=new Common.bE,t.IsSuccess=!0,t.Token=n.get_accessToken(),t},function(n){var t;return t=new Common.bE,t.IsSuccess=!1,t.ErrorCode=n,t})},f:function(){var n;return Promise.resolve((n=new Common.bE,n.IsSuccess=!1,n.ErrorCode="authTokenStrategy_loginNotSupported",n.ErrorMessage="This Token Strategy does not support login flow, TryLogin could not be completed",n))},d:function(){return!1},a:function(){return this.g}};Common.App.OAuth.p=function(n,t,i,r,u,f){var e,o;this.v=Function.createDelegate(this,this.y);this.t=Function.createDelegate(this,this.w);this.u=Function.createDelegate(this,this.x);Common.App.OAuth.p.resolveInheritance();this.e=this.F;this.f=this.dw;Common.App.OAuth.p.initializeBase(this,[!1,!1,!0,!1]);this.m=n;this.r=i;this.n=r;this.s=u;this.q=f;this.k=document.createElement("iframe");this.k.id="SharedAuthInteractiveFrame";this.k.setAttribute("name","SharedAuthInteractiveFrame");this.k.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms allow-popups");this.k.style.border="0";this.k.style.height="48px";$addHandler(this.k,"error",this.u);e=String.format("{0}{1}{2}{3}{4}{5}{6}",this.m,t,"?replyUrl=",window.location.protocol,"//",window.location.host,"&interactive=1");Common.a.a.d("Microsoft.Office.SharedOnline.SharedAuthVNext",!1)&&(e+="&vnext=1");this.k.src=e;o=this;this.o=new Promise(function(n){o.p=n});this.l=!1};Common.App.OAuth.p.prototype={m:null,r:null,n:null,s:null,q:null,k:null,o:null,j:null,p:null,l:!1,g:function(){var n={promptMessage:this.r,errorText:$a.w,rtl:Common.a.h,frameLoaded:!1,createFrame:this.t,resolveDialogStyles:this.p};this.j={id:"SharedAuthConsentDialog",bodyControls:n};this.D(5);this.G($a.q,this.v,this.j)},i:function(n,t,i){this.j&&this.j.bodyControls&&(n!==$$as(Object,this.j.bodyControls).frameLoaded&&($$as(Object,this.j.bodyControls).frameLoaded=n),t!==$$as(Object,this.j.bodyControls).frameLoadSuccess&&($$as(Object,this.j.bodyControls).frameLoadSuccess=t),i!==this.j.dialogButtonsOption&&(this.j.dialogButtonsOption=null,this.D(i)),this.cU(this.j))},h:function(n,t){var i=new Common.cm("SharedAuth_ShowSignInCancelButtons"),r={signInLabel:$a.q,cancelLabel:$a.t,rtl:Common.a.h,messageCorrelationId:n,dialogStyles:t};i.Values=r;this.n.d(i,this.k.contentWindow,this.m)},b:function(){this.i(!0,!1,6)},a:function(){return this.k},c:function(){var n=this;return this.o.then(function(t){return n.l=!0,t})},d:function(){return this.l},x:function(){this.b()},w:function(){return this.k},y:function(n){if(!n){var t;this.s.b((t=new Common.bE,t.ErrorCode="UserCancelled",t.ErrorMessage="The interactive flow was cancelled by the user",t));this.q(null)}}};Common.App.OAuth.i=function(){};Common.App.OAuth.i.$$=function(n){var u=Common.App.OAuth.__tc=Common.App.OAuth.__tc||{},t="i$"+n.getName().replace(/\./g,"_"),i,o,f,e,r;if(!u[t]){i=u[t]=function(){for(var t=[],n=0;n<arguments.length;++n)t[n]=arguments[n];Common.App.OAuth.i.apply(this,t)};i.registerClass("Common.App.OAuth.__tc."+t);o={"Common.App.OAuth.i":{T:n},ctor:Common.App.OAuth.i};i.prototype.$$gta=o;f=Common.App.OAuth.i.prototype;for(e in f)r={key:e,value:f[e]},"constructor"!==r.key&&(i.prototype[r.key]=r.value)}return u[t]};Common.App.OAuth.i.prototype={a:null,b:null,c:0,d:null,e:null};Common.App.OAuth.o=function(){};Common.App.OAuth.o.prototype={b:null,a:null};Common.App.OAuth.q=function(){this.z=Function.createDelegate(this,this.P);this.B=Function.createDelegate(this,this.R);this.E=Function.createDelegate(this,this.U);this.F=Function.createDelegate(this,this.V);this.A=Function.createDelegate(this,this.Q);this.G=Function.createDelegate(this,this.W);this.H=Function.createDelegate(this,this.X);this.C=Function.createDelegate(this,this.S);this.D=Function.createDelegate(this,this.T);this.g=new Common.dl(null,null,null);this.q=Common.a.a.d("Microsoft.Office.SharedOnline.SharedAuthVNext",!1);this.p="SharedAuthTokenStrategy "+(this.q?"BrowserAuth 1.20210701.2/MSAL 2.11.0":"BrowserAuth 1.20210426.1/MSAL 2.11.0");this.j=Common.App.OAuth.a.y();this.t=Common.App.OAuth.a.x();this.s=Common.App.OAuth.a.s();this.v=Common.a.a.d("Microsoft.Office.SharedOnline.OAuthPopupFlashEnabled",!1);this.x=Common.a.a.d("Microsoft.Office.SharedOnline.OAuthSkipUpnCheckEnabled",this.q);this.k={};this.w=new(Common.App.OAuth.h.$$(Object))(1500)};Common.App.OAuth.q.prototype={i:null,j:null,t:null,p:null,s:!1,v:!1,x:!1,o:0,g:null,q:!1,k:null,y:null,h:null,w:null,n:null,r:null,m:null,l:null,a:function(){return this.p},b:function(){var t,n,i;return"loadFrame"in this.k?this.k.loadFrame.d:this.j?(t=this.u(Common.App.OAuth.j,"loadFrame"),this.o=Common.g.a(),n=this.j+this.t+"?replyUrl="+window.location.protocol+"//"+window.location.host+"&usid="+Common.a.j,this.q&&(n=n+"&vnext=1"),this.i=document.createElement("iframe"),this.O(this.i),this.i.style.cssText="height:0;width:0;display:none;",this.i.id="SharedAuthFrame",this.i.setAttribute("name","SharedAuthFrame"),this.i.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms allow-popups"),this.i.setAttribute("title","SharedAuthFrame"),this.i.src=n,document.body.appendChild(this.i),i=Common.g.a()-this.o,Diag.a.a(573112899,3e3,50,"SharedAuthTokenStrategy Create: Frame Appended to Document. E/T:[{0}]. sharedAuthFrame.Src={1}",i,this.i.src),t):(Common.i.a().recordKpiFailure("OAuthManager","SharedFrameOriginNotSet",!1,!1,null),Diag.a.a(562381581,3e3,10,"SharedAuthTokenStrategy Init failed: No Shared Frame Origin Path"),Promise.reject(1))},c:function(n){var t,i;return this.r=n,t=new Common.cm("SharedAuth_Init"),t.Values=this.I(n,!1),i=this.u(Common.App.OAuth.j,"initFrame"),this.g.d(t,this.i.contentWindow,this.j),Diag.a.a(573112900,3e3,50,"SharedAuthTokenStrategy Init: Called package initialize."),i},e:function(n,t,i,r,u,f){var e=new Common.cm("SharedAuth_TryGetToken"),o=this.J(),s,h;return e.Values=this.K(n,t,i,r,u,f,o),s=this.u(Common.bE,o),r&&Common.a.a.d("Microsoft.Office.SharedOnline.SharedAuthInteractiveConsentUI",!1)?(h=this,this.w.g(function(){return new Promise(function(n){h.Z(f,e,n,o)})})):(this.g.d(e,this.i.contentWindow,this.j),Diag.a.a(573112901,3e3,50,"SharedAuthTokenStrategy TryGetToken: Called TryGetToken for app {0}",t)),s},Z:function(n,t,i,r){var f=this.k[r],u;f&&(this.m=t,this.n=(u=new Common.App.OAuth.o,u.b=i,u.a=r,u),this.h=new Common.App.OAuth.p(this.j,this.t,n,this.g,f,i),this.h.g())},J:function(){return Common.u.a().a},K:function(n,t,i,r,u,f,e){var o={};return o.appName=n,o.appId=t,o.target=i,o.withPopup=r,o.claims=u,o.promptMessage=f,o.messageCorrelationId=e,o},O:function(n){$addHandler(n,"load",this.D);$addHandler(n,"error",this.C);this.g.h(this.j);this.g.c("SharedAuth_ScriptLoaded");this.g.b("SharedAuth_ScriptLoaded",this.H);this.g.c("SharedAuth_ScriptInitialized");this.g.b("SharedAuth_ScriptInitialized",this.G);this.g.c("SharedAuth_GetTokenResponse");this.g.b("SharedAuth_GetTokenResponse",this.A);this.g.c("SharedAuth_LoginResponse");this.g.b("SharedAuth_LoginResponse",this.F);this.g.c("SharedAuth_InteractiveFlowReady");this.g.b("SharedAuth_InteractiveFlowReady",this.E);this.g.c("SharedAuth_HideDialog");this.g.b("SharedAuth_HideDialog",this.B);this.g.c("SharedAuth_CloseDialog");this.g.b("SharedAuth_CloseDialog",this.z)},u:function(n,t){var i=new(Common.App.OAuth.i.$$(n)),u,r;return i.c=Common.g.a(),u=this,r=new Promise(function(n,t){i.a=n;i.b=t}),i.d=r,this.k[t]=i,r},T:function(){var n=Common.g.a()-this.o;Diag.a.a(572346566,3e3,50,"WACOAuth.aspx iFrame loaded successfully. E/T:[{0}]",n)},S:function(n){var i=Common.g.a()-this.o,t,r=(t=new Common.U,t.durationMs=i,t);Common.i.a().recordKpiFailure("OAuthManager","WACOAuthAspxFrameError",!1,!0,r);Diag.a.a(572346567,3e3,10,"WACOAuth.aspx iFrame failed to load after {0} ms: {1}",i,this.s?JSON.stringify(n):"")},X:function(n){var f=this.k.loadFrame,e=Common.g.a()-f.c,r=n.Values.AuthLibrary.toString(),o=n.Values.Success.toString(),u,t,i,s;Diag.a.a(573112902,3e3,50,"SharedAuthTokenStrategy OnScriptLoaded. Success={0} AuthLibrary={1} E/T: [{2}]",o,r,e);r&&(this.p="SharedAuthTokenStrategy "+r);u=Boolean.parse(o);u||(t=this.M(),isNullOrUndefined(t)||(t.set("AuthLibrary",this.p),s=(i=new Common.U,i.durationMs=e,i.extendedProperties=t,i),Common.i.a().recordKpiFailure("OAuthManager","StrategyInitFailed",!1,!0,s)));f.a(u?0:1)},W:function(n){var r,u,t,i,f;if(n.Values.interactive&&this.m&&this.m.Values.messageCorrelationId&&(r=n.Values.interactive,u=this.m.Values.messageCorrelationId.toString(),r&&this.h)){t=this;this.h.c().then(function(n){t.g.d(t.m,t.h.a().contentWindow,t.j);t.h.h(u,n);t.h.i(!0,!0,5);t.m=null});return}i=this.k.initFrame;f=Common.g.a()-i.c;Diag.a.a(573112903,3e3,50,"SharedAuthTokenStrategy OnScriptInitialized. E/T: [{0}]",f);i.a(0)},Q:function(n){var i,t,r,u;if(!n.Values.messageCorrelationId||!n.Values.messageCorrelationId.toString()){Diag.a.a(573112904,3e3,10,"SharedAuthTokenStrategy OnGetTokenResponse called without valid messageCorrelationId");return}if(i=n.Values.messageCorrelationId.toString(),t=this.k[i],!t){Diag.a.a(573112905,3e3,10,"SharedAuthTokenStrategy OnGetTokenResponse called with an unregistered messageCorrelationId");return}r=Common.g.a()-t.c;Diag.a.a(573112906,3e3,50,"SharedAuthTokenStrategy OnGetTokenResponse. E/T: [{0}]",r);u=!!n.Values.isSuccess&&n.Values.isSuccess;u?t.a(n.Values.response):t.b(n.Values.response);this.L(i)},U:function(){if(this.h.d())this.h.b();else if(this.r&&this.h){var n=new Common.cm("SharedAuth_Init");n.Values=this.I(this.r,!0);this.g.d(n,this.h.a().contentWindow,this.j)}},R:function(){this.h&&this.h.f()},P:function(n){if(n.Values.cancelled&&n.Values.cancelled&&n.Values.messageCorrelationId){var t=n.Values.messageCorrelationId.toString();this.L(t)}this.h&&this.h.e()},M:function(){try{return new Map}catch(n){return null}},I:function(n,t){var r=Common.a.a.d("Microsoft.Office.SharedOnline.SharedAuthVNext",!1),i={};return i.appIds=this.N(n.authorityType),i.upn=n.loginHint,i.authority=n.authority,i.authorityType=Common.App.OAuth.f.toString(n.authorityType),i.tenantId=n.tenantId,i.correlationId=Common.a.j,i.enableConsoleLogging=this.s,i.enablePopupFlash=this.v,i.skipUpnCheck=this.x,i.interactive=t,i},N:function(){var t=[],u=Common.App.OAuth.a.j(),i=u,n,r;for(n in i)r={key:n,value:i[n]},Array.add(t,r.value);return t},f:function(n,t,i,r,u,f){var e=new Common.cm("SharedAuth_TryLogin"),o=this.J(),s;return e.Values=this.K(n,t,i,r,u,f,o),this.y=e,s=this.u(Common.bE,o),Diag.a.a(555049437,3e3,50,"SharedAuthTokenStrategy TryLogin: Called TryLogin for app {0}",t),this.Y(),s},d:function(){return!0},Y:function(){var n,t,i;if(!this.l&&(this.l=new CommonUI.h($a.qm,$a.ql,null),this.l.d(16),this.l.p(!1),n=this,t=function(){n.g.d(n.y,n.i.contentWindow,n.j)},this.l.a($a.dv,t,$a.dv,!0),i=Common.a.b().a(),!i.v(this.l,!0))){Diag.a.a(555049438,3e3,10,"Failed to add entry to business bar. Login message could not be shown to user.");return}},V:function(n){var t,i,r;if(!n.Values.messageCorrelationId||!n.Values.messageCorrelationId.toString()){Diag.a.a(555049439,3e3,10,"SharedAuthTokenStrategy OnLoginResponse called without valid messageCorrelationId");return}if(t=this.k[n.Values.messageCorrelationId.toString()],!t){Diag.a.a(555049440,3e3,10,"SharedAuthTokenStrategy OnLoginResponse called with an unregistered messageCorrelationId");return}i=Common.g.a()-t.c;Diag.a.a(555049441,3e3,50,"SharedAuthTokenStrategy OnLoginResponse. E/T: [{0}]",i);r=!!n.Values.isSuccess&&n.Values.isSuccess;r?t.a(n.Values.response):t.b(n.Values.response)},L:function(n){this.n&&this.n.a===n&&(this.n.b(null),this.n=null)}};Common.App.OAuth.h=function(n){this.c=new($$sc.v.$$(Common.App.OAuth.i.$$(this.$$gta["Common.App.OAuth.h"].T)));this.b=n};Common.App.OAuth.h.$$=function(n){var u=Common.App.OAuth.__tc=Common.App.OAuth.__tc||{},t="h$"+n.getName().replace(/\./g,"_"),i,o,f,e,r;if(!u[t]){i=u[t]=function(){for(var t=[],n=0;n<arguments.length;++n)t[n]=arguments[n];Common.App.OAuth.h.apply(this,t)};i.registerClass("Common.App.OAuth.__tc."+t);o={"Common.App.OAuth.h":{T:n},ctor:Common.App.OAuth.h};i.prototype.$$gta=o;f=Common.App.OAuth.h.prototype;for(e in f)r={key:e,value:f[e]},"constructor"!==r.key&&(i.prototype[r.key]=r.value)}return u[t]};Common.App.OAuth.h.prototype={c:null,b:0,d:0,a:!1,g:function(n){var t=this;return new Promise(function(i,r){var u;t.c.b((u=new(Common.App.OAuth.i.$$(t.$$gta["Common.App.OAuth.h"].T)),u.e=n,u.a=i,u.b=r,u));t.f()})},f:function(){var n,t,i;if(this.a||this.d===this.c.f.length)return!1;n=this.c.a(this.d++);try{this.a=!0;t=this;i=this;n.e().then(function(i){t.a=!1;t.e(n,i,null,!0)}).catch(function(t){i.a=!1;i.e(n,null,t,!1)})}catch(r){this.a=!1;this.e(n,null,r,!1)}return!0},e:function(n,t,i,r){var e,u,s,o,f,h;r?(e=this,u=function(){n.a(t);e.f()},this.b>0?(s=this,window.setTimeout(function(){u()},this.b)):u()):(o=this,f=function(){n.b(i);o.f()},this.b>0?(h=this,window.setTimeout(function(){f()},this.b)):f())}};Common.App.OAuth.g=function(n){this.g=n;this.h="UnsupportedAuthTokenStrategy Reason="+Common.App.OAuth.b.toString(this.g)};Common.App.OAuth.g.prototype={g:0,h:null,b:function(){return Promise.resolve(0)},c:function(){return Promise.resolve(0)},e:function(){var n;return Promise.resolve((n=new Common.bE,n.IsSuccess=!1,n.ErrorCode=Common.App.OAuth.b.toString(this.g),n.ErrorMessage="Unable to get a token. Reason: ["+Common.App.OAuth.b.toString(this.g)+"]",n))},f:function(){var n;return Promise.resolve((n=new Common.bE,n.IsSuccess=!1,n.ErrorCode="authTokenStrategy_loginNotSupported",n.ErrorMessage="This Token Strategy does not support login flow, TryLogin could not be completed",n))},d:function(){return!1},a:function(){return this.h}};Common.App.OAuth.k.registerClass("Common.App.OAuth.k");Common.App.OAuth.e.registerClass("Common.App.OAuth.e",null,Common.App.OAuth.d);Common.App.OAuth.e.b.registerClass("Common.App.OAuth.e.b");Common.App.OAuth.p.registerClass("Common.App.OAuth.p",CommonUI.b,Common.App.OAuth.s);Common.App.OAuth.o.registerClass("Common.App.OAuth.o");Common.App.OAuth.m.a();Type.registerNamespace("Common.App.LivePersonaUtils");Common.App.LivePersonaUtils.b=function(){};Common.App.LivePersonaUtils.b.a=function(){Common.App.a.a().a(new Common.App.LivePersonaUtils.b,0,!1)};Common.App.LivePersonaUtils.b.prototype={a:function(){return"Common.App.LivePersonaUtils"},b:function(){Common.Utils.a.a().a(Common.ej,null)},c:function(n){var t=this;n.c(Common.App.LivePersonaUtils.a,null).c(Common.ej,null).a().b(function(){return new Common.App.LivePersonaUtils.a(Common.Utils.b.a(Common.App.OAuth.d,n.b(Common.App.OAuth.d,null)))})}};Common.App.LivePersonaUtils.a=function(n){this.b=n};Common.App.LivePersonaUtils.a.a=function(){return Common.a.a.a("IsO365CommercialHost")||Common.a.a.a("IsO365ConsumerHost")};Common.App.LivePersonaUtils.a.prototype={b:null,a:function(){var r=this.c(),t,i,n;return r?Common.App.LivePersonaUtils.a.a()?(n=this,new Promise(function(t,i){n.b.CW(function(){if(n.b.b===4||n.b.b===5){i(Error.create("Error downloading auth library"));return}n.b.a().a("Loki",r,null).then(function(i){var f,r,u;return f=Common.a.a.a("ForceLokiFallbackToACLPTokenIsEnabled")?n.d():i.IsSuccess&&i.Token?(r=new Common.dL,r.isSuccess=!0,r.token=i.Token,r.errorMessage=null,r):(u=new Common.dL,u.isSuccess=!1,u.token=null,u.errorMessage=JSON.stringify(i),u),t(f),f})})})):Promise.resolve((i=new Common.dL,i.isSuccess=!1,i.token=null,i.errorMessage="Not attempting to fetch token because host is not an O365 host.",i)):Promise.resolve((t=new Common.dL,t.isSuccess=!1,t.token=null,t.errorMessage=String.format("Could not get Loki App Id for HostAuthorityType: [{0}]",Common.App.OAuth.c.c()),t))},d:function(){var t=Common.a.a.b("LokiUserDataSignature")||"",n;return n=new Common.dL,n.isSuccess=!0,n.token=t,n.errorMessage=null,n},c:function(){var n=null,t=Common.App.OAuth.c.a();return t===2?n=Common.a.a.b("LokiAADAppId"):t===1&&(n=Common.a.a.b("LokiMSAAppId")),n}};Common.App.LivePersonaUtils.a.registerClass("Common.App.LivePersonaUtils.a",null,Common.ej);Common.App.LivePersonaUtils.b.a();Type.registerNamespace("_Ewa");_Ewa.Am=function(n){_Ewa.Am.initializeBase(this);this.h=n;this.l()};_Ewa.Am.a=function(n){n.a().b(_Ewa.bkq.$$(_Ewa.hD),350,new _Ewa.Am(n))};_Ewa.Am.prototype={h:null,a:function(){this.k(this.h.a().a(_Ewa.hD,349,!1,null)||new _Ewa.OAuthManagerWrapper(Common.Utils.a.a().a(Common.App.OAuth.d,null)))}};_Ewa.OAuthManagerWrapper=function(n){this.c=n};_Ewa.OAuthManagerWrapper.prototype={c:null,b:function(n,t){var i,r;return this.c?(r=this,this.c.a(n,t,null).then(function(t){t.IsSuccess||Diag.a.a(51401292,0,15,"Error retrieving auth token. Message: "+t.ErrorMessage+" Error code: "+t.ErrorCode+" App name: "+n);var i;return i=new _Ewa.hE,i.IsSuccess=t.IsSuccess,i.Token=t.Token,i.ErrorCode=t.ErrorCode,i.ErrorMessage=t.ErrorMessage,i})):(Diag.a.a(51401291,0,10,"Oauth manager is null"),Promise.resolve((i=new _Ewa.hE,i.IsSuccess=!1,i.Token=null,i.ErrorCode="FailedToResolve",i.ErrorMessage="Failed to resolve IOAuthManager from the container.",i)))},a:function(){return this.c?this.c.b():null}};_Ewa.Am.registerClass("_Ewa.Am",_Ewa.sX.$$(_Ewa.hD));_Ewa.OAuthManagerWrapper.registerClass("_Ewa.OAuthManagerWrapper",null,_Ewa.hD);Type.registerNamespace("_Ewa");_Ewa.blS=function(){};_Ewa.blS.a=function(){_Ewa.m.a(function(n){_Ewa.Am.a(n)})};_Ewa.blS.a();