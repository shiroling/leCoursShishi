Type.registerNamespace("Common.App.Policy.Contracts");Common.App.Policy.Contracts.p=function(){};Common.App.Policy.Contracts.p.registerInterface("Common.App.Policy.Contracts.p");Common.App.Policy.Contracts.a=function(){};Common.App.Policy.Contracts.a.prototype={"default":0,auto:1,recommended:2,manual:3,mandatory:4};Common.App.Policy.Contracts.a.registerEnum("Common.App.Policy.Contracts.a",!1);Common.App.Policy.Contracts.b=function(){};Common.App.Policy.Contracts.b.prototype={standard:0,privileged:1};Common.App.Policy.Contracts.b.registerEnum("Common.App.Policy.Contracts.b",!1);Common.App.Policy.Contracts.j=function(){};Common.App.Policy.Contracts.j.prototype={unknown:0,boot:1,refresh:2,selfSetPolicyLabel:3};Common.App.Policy.Contracts.j.registerEnum("Common.App.Policy.Contracts.j",!1);Common.App.Policy.Contracts.c=function(){};Common.App.Policy.Contracts.c.registerInterface("Common.App.Policy.Contracts.c");Common.App.Policy.Contracts.e=function(){};Common.App.Policy.Contracts.e.prototype={none:0,reasonDefaultLabel:1,reasonManual:2,reasonAutomatic:4,reasonRecommended:8,reasonMandatory:16};Common.App.Policy.Contracts.e.registerEnum("Common.App.Policy.Contracts.e",!1);Common.App.Policy.Contracts.h=function(n,t,i){this.a=n.Id;i||(i="");this.d=t;this.c=i;this.b=n};Common.App.Policy.Contracts.h.prototype={a:null,c:null,d:!1,b:null};Common.App.Policy.Contracts.o=function(){this.AreLabelsAvailable=!1;this.AppliedPolicyId="";this.RequiredDowngradeJustification=!1;this.DefaultLabelId="";this.PolicyLabelAssignmentMethod="";this.PolicyLabelVersionToken="";this.SensitivityLabels=new Array(0);this.MandatoryLabelingEnforced=!1;this.CustomUrl=""};Common.App.Policy.Contracts.o.prototype={AreLabelsAvailable:!1,AppliedPolicyId:null,RequiredDowngradeJustification:!1,MandatoryLabelingEnforced:!1,DefaultLabelId:null,CustomUrl:null,PolicyLabelAssignmentMethod:null,PolicyLabelVersionToken:null,SensitivityLabels:null};Common.App.Policy.Contracts.y=function(){this.Id="";this.Enabled=!1;this.Name="";this.DisplayName="";this.Order=0;this.Tooltip="";this.IsEndpointProtectionEnabled=!1;this.ParentId="";this.RequiredDowngradeJustification=!1;this.LabelActions=new Array(0);this.AutoLabelingSensitiveTypeIds=new Array(0);this.Color="";this.HasUserDefinedPermissions=!1};Common.App.Policy.Contracts.y.prototype={Id:null,Enabled:!1,Name:null,DisplayName:null,Order:0,Tooltip:null,IsEndpointProtectionEnabled:!1,ParentId:null,RequiredDowngradeJustification:!1,LabelActions:null,AutoLabelingSensitiveTypeIds:null,Color:null,HasUserDefinedPermissions:!1};Common.App.Policy.Contracts.x=function(){this.Name="";this.Font="";this.FontSize=0;this.FontColor="";this.Text="";this.Margin=0;this.Alignment="";this.Placement=""};Common.App.Policy.Contracts.x.prototype={Name:null,Font:null,FontSize:0,FontColor:null,Text:null,Margin:0,Alignment:null,Placement:null};Common.App.Policy.Contracts.s=function(n,t,i,r){Common.App.Policy.Contracts.s.initializeBase(this);this.d=n;this.c=t;this.a=i;this.b=r};Common.App.Policy.Contracts.s.prototype={c:null,d:null,a:null,b:null};Common.App.Policy.Contracts.k=function(n){Common.App.Policy.Contracts.k.initializeBase(this);this.a=n};Common.App.Policy.Contracts.k.prototype={a:!1};Common.App.Policy.Contracts.i=function(n){Common.App.Policy.Contracts.i.initializeBase(this);this.a=n};Common.App.Policy.Contracts.i.prototype={a:0};Common.App.Policy.Contracts.n=function(){Common.App.Policy.Contracts.n.initializeBase(this)};Common.App.Policy.Contracts.v=function(n){Common.App.Policy.Contracts.v.initializeBase(this);this.a=n};Common.App.Policy.Contracts.v.prototype={a:0};Common.App.Policy.Contracts.u=function(n,t){Common.App.Policy.Contracts.u.initializeBase(this);this.b=n;this.a=t};Common.App.Policy.Contracts.u.prototype={b:null,a:0};Common.App.Policy.Contracts.g=function(n,t,i,r,u,f){Common.App.Policy.Contracts.g.initializeBase(this);this.f=n;this.e=t;this.d=i;this.a=r;this.b=u;this.c=f};Common.App.Policy.Contracts.g.prototype={f:0,e:null,d:null,a:null,b:null,c:!1};Common.App.Policy.Contracts.l=function(n,t){Common.App.Policy.Contracts.l.initializeBase(this);this.b=n;this.a=t};Common.App.Policy.Contracts.l.prototype={b:0,a:!1};Common.App.Policy.Contracts.f=function(n,t,i){Common.App.Policy.Contracts.f.initializeBase(this);this.b=n;this.a=t;this.c=i};Common.App.Policy.Contracts.f.prototype={b:null,a:null,c:null};Common.App.Policy.Contracts.m=function(n,t,i,r,u){Common.App.Policy.Contracts.m.initializeBase(this);this.e=n;this.d=t;this.c=i;this.a=r;this.b=u};Common.App.Policy.Contracts.m.prototype={e:0,d:null,c:null,b:null,a:null};Common.App.Policy.Contracts.t=function(){Common.App.Policy.Contracts.t.initializeBase(this)};Common.App.Policy.Contracts.q=function(n,t){Common.App.Policy.Contracts.q.initializeBase(this);this.b=n;this.a=t};Common.App.Policy.Contracts.q.prototype={b:null,a:0};Common.App.Policy.Contracts.w=function(n){Common.App.Policy.Contracts.w.initializeBase(this);this.a=n};Common.App.Policy.Contracts.w.prototype={a:!1};Common.App.Policy.Contracts.d=function(n,t,i,r,u,f,e){Common.App.Policy.Contracts.d.initializeBase(this);this.a=n;this.g=t;this.f=i;this.e=r;this.d=u;this.c=f;this.b=e};Common.App.Policy.Contracts.d.prototype={a:0,f:!1,g:0,e:null,d:null,c:null,b:null};Common.App.Policy.Contracts.r=function(n,t){this.a=n;this.b=t};Common.App.Policy.Contracts.r.prototype={a:0,b:null};Common.App.Policy.Contracts.z=function(){this.IsSuccessful=!1;this.FailureReason=""};Common.App.Policy.Contracts.z.prototype={IsSuccessful:!1,FailureReason:null};Common.App.Policy.Contracts.h.registerClass("Common.App.Policy.Contracts.h");Common.App.Policy.Contracts.o.registerClass("Common.App.Policy.Contracts.o");Common.App.Policy.Contracts.y.registerClass("Common.App.Policy.Contracts.y");Common.App.Policy.Contracts.s.registerClass("Common.App.Policy.Contracts.s",Sys.EventArgs);Common.App.Policy.Contracts.k.registerClass("Common.App.Policy.Contracts.k",Sys.EventArgs);Common.App.Policy.Contracts.i.registerClass("Common.App.Policy.Contracts.i",Sys.EventArgs);Common.App.Policy.Contracts.n.registerClass("Common.App.Policy.Contracts.n",Sys.EventArgs);Common.App.Policy.Contracts.v.registerClass("Common.App.Policy.Contracts.v",Sys.EventArgs);Common.App.Policy.Contracts.u.registerClass("Common.App.Policy.Contracts.u",Sys.EventArgs);Common.App.Policy.Contracts.g.registerClass("Common.App.Policy.Contracts.g",Sys.EventArgs);Common.App.Policy.Contracts.l.registerClass("Common.App.Policy.Contracts.l",Sys.EventArgs);Common.App.Policy.Contracts.f.registerClass("Common.App.Policy.Contracts.f",Sys.EventArgs);Common.App.Policy.Contracts.m.registerClass("Common.App.Policy.Contracts.m",Sys.EventArgs);Common.App.Policy.Contracts.t.registerClass("Common.App.Policy.Contracts.t",Sys.EventArgs);Common.App.Policy.Contracts.q.registerClass("Common.App.Policy.Contracts.q",Sys.EventArgs);Common.App.Policy.Contracts.w.registerClass("Common.App.Policy.Contracts.w",Sys.EventArgs);Common.App.Policy.Contracts.d.registerClass("Common.App.Policy.Contracts.d",Sys.EventArgs);Common.App.Policy.Contracts.r.registerClass("Common.App.Policy.Contracts.r");Type.registerNamespace("Common.App.Policy");Common.App.Policy.j=function(n,t,i){this.IsPolicyTipAvailable=n;this.GeneralText=t;this.NavigateUrl=i};Common.App.Policy.i=function(){};Common.App.Policy.e=function(){};Common.App.Policy.c=function(n,t,i,r){this.Y=Function.createDelegate(this,this.bt);this.Z=Function.createDelegate(this,this.bu);this.ba=Function.createDelegate(this,this.bC);this.L=Function.createDelegate(this,this.bH);this.M=Function.createDelegate(this,this.bI);this.K=Function.createDelegate(this,this.bG);this.N=Function.createDelegate(this,this.bK);this.H=Function.createDelegate(this,this.bE);this.O=Function.createDelegate(this,this.bM);this.J=Function.createDelegate(this,this.bF);this.G=Function.createDelegate(this,this.by);this.bb=Function.createDelegate(this,this.bD);this.I=Function.createDelegate(this,this.bj);this.c=n;this.f=t;this.d=i;this.b=r;this.l={};this.C={};this.B={};this.t=i.a("WacApplyManualPolicyLabelIsEnabled");this.w=i.a("ClpKpiIsEnabled");this.b.a().k(this.I);this.b.a().e(this.I);this.b.a().d(this.bb);i.a("SupportsPolicies")&&i.b("AppliedPolicyId")&&(this.A=i.b("IrmPolicyTitle"),this.q=i.b("IrmPolicyDescription"));this.D=i.a("ProtectedFile");this.P=this.d.c("SetPolicyLabelAwaitFileExistsOnHostMaxRetries",6);this.Q=this.d.c("SetPolicyLabelAwaitFileExistsOnHostRetryDelayMs",5e3)};Common.App.Policy.c.a=function(n){n?(Common.bM.c("ribbon","sensitivity",!1),Common.bM.b("ribbon","sensitivity",!1)):Common.bM.d("ribbon","sensitivity",!1)};Common.App.Policy.c.b=function(n){return n&&n.length?!1:!0};Common.App.Policy.c.prototype={c:null,f:null,d:null,b:null,A:null,q:null,P:0,Q:0,x:!1,S:!1,D:!1,m:!1,z:!1,w:!1,a:null,g:null,e:null,l:null,C:null,B:null,p:null,j:null,i:null,h:null,k:null,u:0,t:!1,V:function(){return Common.a.cT||!!this.y&&this.y()},v:null,y:null,R:null,bl:function(){this.c.a(3427834559,2147483648,this.G);this.c.b(497870830,2147483648,this.J,96);this.c.a(941487903,2147483648,this.O);this.c.a(1145315516,2147483648,this.H);this.c.a(2935633379,2147483648,this.N);this.c.b(3134802707,2147483648,this.K,96);this.c.a(991261903,2147483648,this.M);this.c.a(2875864574,2147483648,this.L);this.r(941487903)||this.c.f(941487903,4);this.r(1145315516)||this.c.f(1145315516,4);this.r(2935633379)||this.c.f(2935633379,4);this.r(991261903)||this.c.f(991261903,4);this.r(2875864574)||this.c.f(2875864574,4);this.f.c(!1)},bO:function(){this.c.e(3427834559,2147483648,this.G);this.c.e(497870830,2147483648,this.J);this.c.e(941487903,2147483648,this.O);this.c.e(1145315516,2147483648,this.H);this.c.e(2935633379,2147483648,this.N);this.c.e(3134802707,2147483648,this.K);this.c.e(991261903,2147483648,this.M);this.c.e(2875864574,2147483648,this.L)},bM:function(){return 32},be:function(n){var t="mandatoryLabelling_"+n.Id;return this.B[t]=n.Id,{type:"AppToggleButtonProps",id:t,label:n.DisplayName,hideLabel:!1,customTooltip:n.Tooltip}},bz:function(){var i=[],u=this.g,r,c,t,l;for(r in u){var f={key:r,value:u[r]},e=f.value,n=this.e[f.key];if(n&&n.Enabled)if(e.f.length){for(var o={sections:[],shouldAutoOpen:!1},s={id:"mandatoryLabelling_flyoutMenuSection_"+n.Id,controls:[]},h=e.$$lge();h.$$mn();)(c=h.$$cu(),t=this.e[c],t&&t.Enabled)&&Array.add(s.controls,this.be(t));Array.add(o.sections,s);l={type:"AppFlyoutAnchorProps",id:"mandatoryLabelling_"+n.Id,label:n.DisplayName,hideLabel:!1,hideChevron:!1,hideIcon:!1,menuDefinition:o};Array.add(i,l)}else Array.add(i,this.be(n))}return i},bE:function(n,t,i,r,u){if(i===1||!this.b.a().b())return 32;var f=u,e;return f.MenuItems=(e=new Common.cF,e.Id="SensitivityList",e.MenuSectionList=[],e.UpdateDynamically=!0,e),Array.add(f.MenuItems.MenuSectionList,this.bw(!this.n())),this.a.CustomUrl&&Array.add(f.MenuItems.MenuSectionList,this.bv(this.n()?this.a.CustomUrl:Common.d.c(this.a.CustomUrl))),this.n()||(f.PopulationXML=Common.Q.d(f.MenuItems)),32},bG:function(n,t,i,r,u){if(i===1||!u||!this.t)return 32;if(this.a=this.b.a().a(),this.b.a().b()){var f=u;f[Common.App.Policy.a.d]=!0;Common.A.a("MipLabelsAvailable",!0,0,null)}return 32},bI:function(n,t,i,r,u){if(i===1||!u)return 32;var f=u,e,o;return f[Common.App.Policy.a.o]=!!(e=f[Common.App.Policy.a.s])&&!!(o=this.l[e])&&o===this.a.AppliedPolicyId,32},bH:function(n,t,i,r,u){if(i===1||!u)return 32;var f=u,e,o,s,h=!!(e=f[Common.App.Policy.a.n])&&!!(o=this.l[e])&&!!(s=this.g[o])&&s.c(this.a.AppliedPolicyId);return f[Common.App.Policy.a.p]=h,f[Common.App.Policy.a.o]=h,32},bK:function(n,t,i,r,u){if(i===1||!u)return 32;var f=u,e=f[Common.App.Policy.a.n],o=this.l[e];return this.o(o,f,2)},bN:function(){this.a.DefaultLabelId&&this.a.MandatoryLabelingEnforced?this.x?this.a.AppliedPolicyId?this.F(""):this.b.a().C(this.b.a().A())&&this.U():this.s():this.a.DefaultLabelId?this.s():this.a.MandatoryLabelingEnforced&&(this.a.AppliedPolicyId?this.F(""):this.U())},bp:function(){if(!this.a.MandatoryLabelingEnforced){Diag.a.a(572601945,306,50,"Mandatory labelling not invoked b/c user did not have policy!");return}if(!this.a||!this.a.AreLabelsAvailable){Diag.a.a(572601946,306,50,"Mandatory labelling not invoked b/c there are no sensitivity labels!");return}if(!this.d.a("TestOverrideIsReactDialogEnabled")&&(!this.f||!this.f.a()||!this.f.a().d())){Diag.a.a(572641315,306,50,"Mandatory labelling not invoked b/c react dialogs disabled!");return}if(this.a.AppliedPolicyId===""){if(!this.d.d("Microsoft.Office.SharedOnline.DefaultAndMandatoryLabelingDecouplingEnabled",!1)&&this.a.DefaultLabelId&&(this.d.d("Microsoft.Office.SharedOnline.DefaultLabelingExistingDocumentIsEnabled",!1)||this.V())){Diag.a.a(572601948,306,50,"Mandatory labelling not invoked b/c default label policy present!");return}this.U()}else this.F("")},bi:function(){return this.a.MandatoryLabelingEnforced?!this.a||!this.a.AreLabelsAvailable?(Diag.a.a(539109064,306,50,"Mandatory labelling not invoked b/c there are no sensitivity labels!"),!1):!this.d.a("TestOverrideIsReactDialogEnabled")&&(!this.f||!this.f.a()||!this.f.a().d())?(Diag.a.a(539109065,306,50,"Mandatory labelling not invoked b/c react dialogs disabled!"),!1):!0:(Diag.a.a(539109063,306,50,"Mandatory labelling not invoked b/c user did not have policy!"),!1)},U:function(){if((!this.d.d("Microsoft.Office.SharedOnline.DefaultAndMandatoryLabelingDecouplingEnabled",!1)||this.bi())&&!Common.a.z&&!this.S){Common.a.z=!0;this.S=!0;Diag.a.a(562837517,306,50,"Mandatory labelling is invoked successfully.");this.b.a().n("",1);var n=this;this.b.a().x(37,$a.bJ,$a.bK,$a.iK,function(){n.bB()})}},F:function(n){(!this.d.d("Microsoft.Office.SharedOnline.DefaultAndMandatoryLabelingDecouplingEnabled",!1)||this.bi())&&Common.a.z&&(Common.a.z=!1,Diag.a.a(562837518,306,50,"Mandatory labelling is escaped successfully."),this.b.a().R(),this.b.a().n(n,2))},bB:function(){Common.App.Policy.d.b().a(this.bz(),this.a.CustomUrl,this.ba)},bC:function(n){this.F(this.B[n])},bc:function(){return this.d.a("CoAuthForProtectedFilesEnabled")&&this.d.a("SupportsOfficeClientCoauthoring")&&this.d.a("SetPolicyLabelAwaitFileExistsOnHostIsEnabled")&&!!this.R&&this.V()},o:function(n,t,i){var s;this.w&&this.b.a().D(i);var u=32,f=!1,e=!0,r=i===2||i===8||i===16,o=n===this.a.AppliedPolicyId;if(this.v&&this.v(n,r))Diag.a.a(42860829,306,15,"SetSensitivity : As app doesn't support changing the label, skipping SetSensitivity call. ApplyLabelFlag : {0}",i),this.f.c(!1);else if(t&&Common.App.Policy.a.f in t&&this.b.a().S(t[Common.App.Policy.a.f]),n)if(this.b.a().m()||this.bc()&&this.z)Diag.a.a(42796168,306,50,"Policy label cannot be set because a set policy label request is already in progress. ApplyLabelFlag: {0}",i),this.f.c(!1),r&&this.E(i,n,$a.B,$a.mp);else if(this.d.a("HasDocumentEditRights"))if(this.b.a().y(n))if(this.d.d("Microsoft.Office.SharedOnline.LabelHasUDPEnabled",!1)&&this.e[n]&&this.e[n].HasUserDefinedPermissions)Diag.a.a(540608323,306,50,"UDP label cannot be applied during UDP in WAC Phase 1. ApplyLabelFlag: {0}",i),i!==1&&i!==4&&this.bq();else if(r&&this.a.MandatoryLabelingEnforced&&o)Diag.a.a(570972054,306,50,"Policy label cannot be removed due to mandatory labeling. ApplyLabelFlag: {0}",i),this.E(i,"",$a.iJ,$a.iI);else{if(r&&this.d.a("WacLabelingJustificationDialogIsEnabled")&&this.a.RequiredDowngradeJustification&&(o||this.e[n].RequiredDowngradeJustification)&&!this.p)return Diag.a.a(570972055,306,50,"Downgrade justification is required. ApplyLabelFlag: {0}",i),this.bL(n),u;if(this.bc()&&!this.R())this.u<this.P?(Diag.a.a(577356770,306,50,"File does not exist on host, retrying after delay. RetryCount: {0} ApplyLabelFlag: {1}",this.u,i),this.z=!0,this.u++,s=this,$$sc.a.b(this.Q).CW(function(){s.z=!1;s.o(n,t,i)})):(Diag.a.a(577356771,306,15,"Policy label cannot be set because maximum retries were reached checking for file existence. ApplyLabelFlag: {0}",i),f=i!==1,e=!1,u=8);else return this.d.d("Microsoft.Office.SharedOnline.WacBlockParentLabelSetLabel",!1)&&this.bA(n)&&(Diag.a.a(553911752,306,15,"Policy label cannot be set because the selected label is a parent label. ApplyLabelFlag: {0}",i),i===1||i===8||i===4)?u:(Diag.a.a(570972056,306,50,"SetSensitivityByPolicyId is succeeded. ApplyLabelFlag: {0}",i),this.bo(o?"":n,this.p,i),u)}else Diag.a.a(42796169,306,50,"Policy label cannot be set because the user is in a coauth session. ApplyLabelFlag: {0}",i),this.f.c(!1),r&&this.E(i,n,$a.B,$a.mn);else Diag.a.a(558892739,306,50,"Policy label cannot be set because the user doesn't have edit rights. ApplyLabelFlag: {0}",i),this.f.c(!1),r&&this.E(i,n,$a.B,$a.mo);else Diag.a.a(42796167,306,15,"Policy label cannot be set because the selected policy ID is null. ApplyLabelFlag: {0}",i),this.f.c(!1),f=r,e=!1,u=8;return this.b.a().o(0,i,f,e),u},br:function(n,t,i,r){this.w||Common.i.a().recordKpiUsage("MipAutoClassificationSetLabel",0,"wordclpfc",null);this.d.a("SupportsOfficeClientCoauthoring")&&this.d.a("CoAuthForProtectedFilesIsEnabled")?(this.m=!1,this.a=this.b.a().a(),this.a&&!this.a.AppliedPolicyId?this.m=!0:this.a&&this.a.PolicyLabelAssignmentMethod&&(this.m=this.a.PolicyLabelAssignmentMethod.toUpperCase()===Common.App.Policy.Contracts.b.toString(0).toUpperCase())):this.m=r;var u=Common.App.Policy.c.b(n)?null:this.e[n],f=Common.App.Policy.c.b(t)?null:this.e[t];return f?this.i=new Common.App.Policy.Contracts.h(f,!0,i):(this.b.a().c(29),this.h=null),u?this.j=new Common.App.Policy.Contracts.h(u,!1,null):this.k=null,this.bj(null,null),32},bs:function(n,t){return this.a.AppliedPolicyId!==""&&t?(this.b.a().o(4,16,!0,!0),8):this.o(n,null,16)},bm:function(){var t;if(this.e={},this.a=this.b.a().a(),this.a)for(var i=this.a.SensitivityLabels,r=i.length,n=0;n<r;++n)t=i[n],this.e[t.Id]=t},bA:function(n){var r,t,u,i;if(this.g&&n in this.g)for(r=this.g[n],t=r.$$lge();t.$$mn();)if(u=t.$$cu(),i=this.e[u],i&&i.Enabled)return!0;return!1},bn:function(){var i,n,e;if(this.g={},this.a=this.b.a().a(),this.a){for(var u=this.a.SensitivityLabels,o=u.length,t=0;t<o;++t)i=u[t],i.ParentId||(this.g[i.Id]=new($$sc.v.$$(String)));for(var f=this.a.SensitivityLabels,s=f.length,r=0;r<s;++r)(n=f[r],n.ParentId&&n.ParentId in this.g)&&(e=this.g[n.ParentId],e.b(n.Id))}},bk:function(){if(!this.t||!this.n()){Common.App.Policy.c.a(!1);return}if(this.a=this.b.a().a(),!this.b.a().b()){Common.App.Policy.c.a(!1);return}Common.App.Policy.c.a(!0);appChrome.api.dispatch(appChrome.actions.updateControlHiddenState("Sensitivity",!1))},s:function(){this.d.a("WacApplyDefaultPolicyLabelIsEnabled")&&(this.x||(this.x=!0,this.a=this.b.a().a(),this.a&&this.a.DefaultLabelId&&!this.a.AppliedPolicyId)&&(Diag.a.a(593774211,306,50,"Default label configured, checking if this is a new file"),(this.d.d("Microsoft.Office.SharedOnline.DefaultLabelingExistingDocumentIsEnabled",!1)||this.V())&&(Diag.a.a(593774210,306,50,"Default labeling triggered. DefaultLabel: {0}",this.a.DefaultLabelId),this.o(this.a.DefaultLabelId,null,1))))},bj:function(){var n,t,i,r,u;this.b.a().m()||(n=this.e[this.b.a().a().AppliedPolicyId],this.m&&this.j&&this.k!==this.j.a&&(!n||n.Order<this.j.b.Order)&&(t=this.o(this.j.a,{},4),t!==32?Diag.a.a(50868813,306,10,"ProcessAutoSensitivityLabel: SetSensitivityByPolicyId failed with response: "+t):(this.k=this.j.a,this.h&&(i=this.e[this.h],i&&i.Order<=this.j.b.Order&&(this.b.a().c(29),this.h=null)))),n=this.e[this.b.a().a().AppliedPolicyId],this.i&&this.h!==this.i.a&&(!n||n.Order<this.i.b.Order)&&(r=this.i.a,this.b.a().c(29),u=this,this.b.a().w(29,$a.N,String.format($a.lp,this.W(this.i.b))+" "+this.i.c,$a.lo,function(){u.o(r,{},8)}),this.h=this.i.a),this.j=null,this.i=null)},bo:function(n,t,i){this.p=t;this.b.a().T(n);this.f.c(!1);var r=this.e[n],u=new Common.App.Policy.Contracts.r(i,this.W(r));this.b.a().U(n,this.p,u)},bu:function(n,t,i){n===1?this.bo(t===this.a.AppliedPolicyId?"":t,i,2):this.f.c(!1)},bL:function(n){var t=new Common.App.Policy.b(n,this.Z);t.s()},E:function(n,t,i,r){var u=new CommonUI.d;u.bk=Common.a.bI;u.D(0);u.E(1,$a.b);u.bL(i,r,null)},bt:function(n){n===1&&this.b.a().E(!0)},bq:function(){var n=new CommonUI.d;n.bk=Common.a.bI;n.D(1);n.E(1,$a.jU);n.E(0,$a.b);n.bL($a.B,$a.mm,this.Y)},n:function(){return!!this.f&&!!this.f.a()&&this.f.a().g()},X:function(){return!this.f||!this.f.a()?!1:this.f.a().bB()},by:function(n,t,i){return i===1?32:(i===2,32)},bF:function(n,t,i,r,u){var f,o,e,h;if(i===1||(this.a=this.b.a().a(),!this.a||!u))return 32;if(f=u,f[Common.App.Policy.a.a]="",f[Common.App.Policy.a.c]="",f[Common.App.Policy.a.e]=null,f[Common.App.Policy.a.l]=null,f[Common.App.Policy.a.m]=null,f[Common.App.Policy.a.d]=!1,f[Common.App.Policy.a.g]="",f[Common.App.Policy.a.b]="",o="",this.a.AreLabelsAvailable){if(this.a.AppliedPolicyId){e=null;for(var c=this.a.SensitivityLabels,l=c.length,s=0;s<l;++s)if(h=c[s],h.Id.toLowerCase()===this.a.AppliedPolicyId.toLowerCase()){e=h;break}e&&(f[Common.App.Policy.a.a]=f[Common.App.Policy.a.c]=this.W(e),this.X()?f[Common.App.Policy.a.j]=e.Tooltip:f[Common.App.Policy.a.e]=e.Tooltip,this.D=Common.a.v=e.IsEndpointProtectionEnabled,o=this.bf(e))}}else{if(!this.A)return 32;f[Common.App.Policy.a.a]=f[Common.App.Policy.a.c]=this.A;this.q&&(this.X()?f[Common.App.Policy.a.j]=this.q:f[Common.App.Policy.a.e]=this.q)}return f[Common.App.Policy.a.a]?this.bJ(o,this.D,f):this.d.d("Microsoft.Office.Security.ClpLouderLabelEnabled",!1)&&(f[Common.App.Policy.a.g]=Common.App.Policy.a.k,this.a.MandatoryLabelingEnforced?(f[Common.App.Policy.a.a]=f[Common.App.Policy.a.c]=Common.App.Policy.a.E,f[Common.App.Policy.a.b]=Common.App.Policy.a.t):(f[Common.App.Policy.a.a]=f[Common.App.Policy.a.c]=Common.App.Policy.a.D,f[Common.App.Policy.a.b]=Common.App.Policy.a.y),f[Common.App.Policy.a.d]=!0),32},W:function(n){return n?this.e?n.ParentId&&this.e[n.ParentId]?this.e[n.ParentId].DisplayName+"\\"+n.DisplayName:n.DisplayName:(Diag.a.a(4282e4,306,15,"Policy ID to Sensitivity label dictionary has not been initialized."),n.DisplayName):""},bJ:function(n,t,i){this.d.d("Microsoft.Office.Security.ClpLouderLabelEnabled",!1)&&(i[Common.App.Policy.a.g]=this.bh(n));i[Common.App.Policy.a.l]=Common.a.q;i[Common.App.Policy.a.m]=t?Common.P.b(Common.App.Policy.a.A):Common.P.b(Common.App.Policy.a.C);this.X()&&(i[Common.App.Policy.a.b]=this.d.d("Microsoft.Office.Security.ClpLouderLabelEnabled",!1)?this.bg(n,t):t?Common.App.Policy.a.z:Common.App.Policy.a.B);i[Common.App.Policy.a.d]=!0},bv:function(n){var i=this.T("LearnMoreSection",!0),r="SensitivityLearnMore",t,u=(t=new Common.bP,t.Id=r,t.ExternalId=r,t.MenuItemId=n,t.LabelText=$a.n,t.Command="1959943459",t.Image16by16=Common.a.q,t.Image16by16Class=Common.P.b(Common.App.Policy.a.q),t.Visible=!0,t.Alt=$a.L_LearnMoreTooltip,t.KeyTip="L",t);return Array.add(i.ControlList,u),i},bd:function(n,t,i,r){var o="Toggle_",a,f,u,s;Common.a.eu("4ie32269;hjfid788");o+=this.d.d("Microsoft.Office.SharedOnline.ClpToggleButtonIdIsEnabled",!1)?n.Id:i+"_"+n.Name;o="Sensitivity_"+o;var h=n.DisplayName,c=n.Tooltip,v=n.Id===this.a.AppliedPolicyId,e=r?Common.d.c(o):o,l=null;return this.d.d("Microsoft.Office.Security.ClpLouderLabelEnabled",!1)?(a=this.bf(n),l=(f=new Common.dS,f.Id=e,f.ExternalId=e,f.LabelText=r?Common.d.c(h):h,f.Command="2935633379",f.MenuItemId=e,f.QueryCommand="991261903",f.Visible=!0,f.Alt=r?Common.d.c(c):c,f.AriaLabel="menuitemradio",f.IconColor=this.bh(a),f.KeyTip=t,f),l.ExternalImageId=this.bg(a,n.IsEndpointProtectionEnabled)):(s=(u=new Common.dn,u.Id=e,u.ExternalId=e,u.LabelText=r?Common.d.c(h):h,u.Command="2935633379",u.MenuItemId=e,u.QueryCommand="991261903",u.CheckedImage=Common.a.q,u.Visible=!0,u.Alt=r?Common.d.c(c):c,u.IsChecked=v,u.AriaLabel="menuitemradio",u.KeyTip=t,u),this.n()?(s.CheckedImageClass=Common.P.b(Common.App.Policy.a.h),s.ExternalImageId=Common.App.Policy.a.h):s.CheckedImageClass=Common.P.b(Common.App.Policy.a.i),l=s),e=o,this.l[e]=n.Id,this.C[n.Id]=e,l},T:function(n,t){var i;return i=new Common.bS,i.Title="",i.Id=n,i.DisplayMode=Common.App.Policy.a.r,i.ShowMenuSectionSeparator=t,i.ControlsId="Ctrl_"+n,i.ControlList=[],i},bx:function(n,t,i){for(var u=this.T(n+"Sub",!1),f=1,e=t.$$lge(),o,r;e.$$mn();)o=e.$$cu(),r=this.e[o],r&&r.Enabled&&(Array.add(u.ControlList,this.bd(r,f.toString(),n,i)),f++);return u},bw:function(n){var f=this.T("SensitivitySection",!1),e=1,s=this.g;for(var h in s){var c={key:h,value:s[h]},l=c.value,i=this.e[c.key];if(i&&i.Enabled){if(l.f.length){var o="Sensitivity_"+i.Name,a=n?Common.d.c(o):o,u,t,r=(t=new Common.cO,t.Id=a,t.ExternalId=a,t.LabelText=n?Common.d.c(i.DisplayName):i.DisplayName,t.Command="798637440",t.QueryCommand="2875864574",t.Menu=(u=new Common.cF,u.Title="",u.MenuSectionList=[],u.UpdateDynamically=!0,u),t.ImageIsVisible=!1,t.Toggled=!1,t.ImageUsesSpaceWhileInvisible=!0,t.AriaLabel="menuitemradio",t.KeyTip=e.toString(),t);this.n()?r.ExternalImageId=Common.App.Policy.a.h:(r.Image16by16=Common.a.q,r.Image16by16Class=Common.P.b(Common.App.Policy.a.i));Array.add(r.Menu.MenuSectionList,this.bx(o,l,n));Array.add(f.ControlList,r);this.l[r.Id]=i.Id;this.C[i.Id]=r.Id}else Array.add(f.ControlList,this.bd(i,e.toString(),"",n));e++}}return f},r:function(n){return!!this.c.g(n)&&!!this.c.g(n).a&&!!this.c.g(n).a.length},bD:function(n,t){var i,r;t.a&&this.e&&(i=this.e[this.b.a().a().AppliedPolicyId],i)&&(this.h&&(r=this.e[this.h],r&&r.Order<=i.Order&&(this.b.a().c(29),this.h=null)),this.k&&this.k!==i.Id&&(this.b.a().c(28),this.k=null))},bg:function(n,t){var i=Common.App.Policy.c.b(n);return t?i?Common.App.Policy.a.w:Common.App.Policy.a.v:i?Common.App.Policy.a.x:Common.App.Policy.a.u},bh:function(n){return Common.App.Policy.c.b(n)?Common.App.Policy.a.k:n},bf:function(n){if(!Common.App.Policy.c.b(n.Color)||!n.ParentId)return n.Color;var t=this.e[n.ParentId];return t?t.Color:n.Color}};Common.App.Policy.a=function(){};Common.App.Policy.f=function(n,t,i,r,u,f){this.bI=Function.createDelegate(this,this.cB);this.bJ=Function.createDelegate(this,this.cC);this.bG=Function.createDelegate(this,this.cy);this.bH=Function.createDelegate(this,this.cz);this.bY=Function.createDelegate(this,this.cw);this.bE=Function.createDelegate(this,this.cv);this.bF=Function.createDelegate(this,this.cx);this.bZ=Function.createDelegate(this,this.cA);this.cm=Function.createDelegate(this,this.cn);this.V=new Common.bc;this.X=n;this.be=t;this.Z=i;this.bn=r;this.W=new Common.App.Policy.Contracts.o;this.bA=this.X.b("PolicyHandlerEndpointName")||"PolicyHandler.ashx";this.bv=u;this.ca=f?this.cf(f):this.cf(Common.a.b().a().a());this.bK=n.a("WacApplyManualPolicyLabelIsEnabled");this.bq=n.a("CoAuthForProtectedFilesIsEnabled");this.bc=n.a("SupportsOfficeClientCoauthoring");this.bf=n.a("ClpKpiIsEnabled");this.bL=!1;this.bM=3e4;this.bR=Common.S.a();n.a("SupportsPolicies")&&Common.A.a("MipSupportsPolicies",!0,0,null);this.bq&&this.bc&&Common.A.a("MipSupportsOfficeClientCoauthoring",!0,0,null)};Common.App.Policy.f.prototype={bA:null,X:null,bN:null,bR:null,bx:null,be:null,bn:0,bm:0,bl:0,bb:0,Y:"",bz:null,ba:null,bO:null,bw:null,bQ:null,W:null,bv:null,bh:null,bP:!1,bd:null,by:0,Z:null,bs:null,bg:null,bi:null,bt:null,ca:null,bu:null,bq:!1,bf:!1,bo:null,br:null,bj:!1,h:function(n){this.V.m("PolicyTipEvent",n)},d:function(n){this.V.m("LabelInfoUpdateEvent",n)},k:function(n){this.V.m("SetPolicyLabelEventKey",n)},O:function(n){this.V.n("SetPolicyLabelEventKey",n)},e:function(n){this.V.m("SetPolicyLabelFailureEventKey",n)},N:function(n){this.V.n("SetPolicyLabelFailureEventKey",n)},s:function(n){this.V.m("GetPolicyLabelEventKey",n)},r:function(n){this.V.m("GetPolicyLabelFailureEventKey",n)},q:function(n){this.V.m("GetAutoPolicyLabelEventKey",n);this.bj&&(Diag.a.a(51668058,306,15,"GetAutoPolicyLabelHandler was registered after the AutoPolicyLabelHandlerEvent was raised"),this.bV(new Common.App.Policy.Contracts.i(0)))},J:function(n){this.V.n("GetAutoPolicyLabelEventKey",n)},p:function(n){this.V.m("CreateAutoCLPSecurityNodesEventKey",n)},I:function(n){this.V.n("CreateAutoCLPSecurityNodesEventKey",n)},u:function(n){this.V.m("UpdateAutoCLPLabelPriorityNodeEventKey",n)},P:function(n){this.V.n("UpdateAutoCLPLabelPriorityNodeEventKey",n)},v:function(n){this.V.m("UpdateAutoCLPSITNodesEventKey",n)},Q:function(n){this.V.n("UpdateAutoCLPSITNodesEventKey",n)},f:function(n){this.V.m("AddAutoPolicyBusinessBarEntryEventKey",n)},G:function(n){this.V.n("AddAutoPolicyBusinessBarEntryEventKey",n)},i:function(n){this.V.m("RemoveAutoPolicyBusinessBarEntryEventKey",n)},L:function(n){this.V.n("RemoveAutoPolicyBusinessBarEntryEventKey",n)},g:function(n){this.V.m("AddMandatoryLabellingBusinessBarEntryEventKey",n)},H:function(n){this.V.n("AddMandatoryLabellingBusinessBarEntryEventKey",n)},j:function(n){this.V.m("RemoveMandatoryLabellingBusinessBarEntryEventKey",n)},M:function(n){this.V.n("RemoveMandatoryLabellingBusinessBarEntryEventKey",n)},t:function(n){this.V.m("MandatoryLabellingAppHandlerEventKey",n)},K:function(n){this.V.n("MandatoryLabellingAppHandlerEventKey",n)},bK:!1,bL:!1,bM:0,bc:!1,cq:function(){var t;if(!this.bN)return!1;for(var i=this.bN.a(),r=i.length,n=0;n<r;++n)if(t=i[n],!t.Capabilities||!t.Capabilities.SupportsClientIsMipTrusted)return!1;return!0},cc:function(){return!!this.bu},bk:null,A:function(){return this.bk},z:function(){return Common.a.a.d("Microsoft.Office.SharedOnline.IsClpBlockedByAppSpecificScenarioEnabled",!1)?this.bO?this.bO():!1:!1},F:function(n){this.bw=n},bT:function(){return(new Date).getTime()},cn:function(n){if(!this.cc()){var i=n.a(),t=this;i.CW(function(){t.bu=i.a();t.bu.a(t.bZ)})}},cA:function(n,t){t.a===12&&(this.bQ?this.bQ():this.B(this.Y,2,this.ba,!0))},l:function(){var n,t,i;this.Z&&(this.bs=this.Z.a("WebServiceCall","Call Get Policy Endpoint On Server"));n=Common.ci.a(1,1);this.X.a("SendHostAttributionInfoForPolicyLabelEnabled")?(t=new Common.eE(this.bp("datalosspolicy",!1),1,null,null,!0,2,null,null,null,!1,null,null,null,null,!1,null,null,null,null,n,null),i=this.be.l(t),i.b(this.bF,this.bE)):this.be.a(this.bp("datalosspolicy",!1),1,null,null,!0,2,this.bF,this.bE,null,null,!1,null,null,null,null,!1,null,!1,null);this.bm++;Diag.a.a(25565151,306,50,"Policy request is sent to server. The endpoint used is {0}. Policy call times: {1}.",this.bA,this.bm)},B:function(n,t,i,r){this.bf&&(Common.i.a().recordKpiUsage("MipGetPolicyLabel",0,"officewebclp",this.bU(null,t)),this.bo=this.bT());var u=this.bS(t);this.bC(n,u,i,r,t)},a:function(){return this.W},cx:function(n){this.cg();var t="",i,r;(r=this.bX(n,i={val:t}),t=i.val,r)&&(Diag.a.a(25565153,306,50,"Request to get DataLossPrevention policy succeeded."),this.bm=0,this.Z&&(this.bt=this.Z.a("Task","Parse and Handle Get Policy Response")),this.cD(t),this.bt)&&(this.bt.a(),this.bt=null)},cv:function(n){if(this.cg(),this.bm<=this.bn){this.l();return}Diag.a.a(25565154,306,15,"Request to get DataLossPrevention policy failed with error response: {0}.",n?n.b?n.b.k:null:null);this.bm=0},m:function(){return this.bb>0},T:function(n){this.W.AppliedPolicyId=n},U:function(n,t,i){var r=this.cp(i);this.cN(n,t,r,i)},cC:function(n){var t,i,f,e;this.bi&&(this.bi.a(),this.bi=null);this.ce(n,f={val:t},e={val:i});t=f.val;i=e.val;var r=n.b.f,o=r?r.a:2,u="",s,h;if(!(h=this.bX(n,s={val:u}),u=s.val,h)){this.bW(o,0);return}Diag.a.a(41799707,306,50,"Request to set label policy data succeeded. ApplyLabelFlag: {0}",o);this.bb=0;this.cF(u,t,i,r)},D:function(n){this.bf&&(Common.i.a().recordKpiUsage("MipSetPolicyLabel",0,"officewebclp",this.bU(n,null)),this.br=this.bT());Diag.a.a(575947405,306,50,"Raising set policy label triggered event.");this.V.k("SetPolicyLabelTriggeredEventKey",new Common.App.Policy.Contracts.v(n),null)},cu:function(){this.bq&&this.bc&&this.cc()&&this.bu.f(12,null,!0)},cB:function(n){var t,i,f,e,r,u;if(this.bi&&(this.bi.a(),this.bi=null),this.ce(n,f={val:t},e={val:i}),t=f.val,i=e.val,this.bb<=this.bn){this.U(t,i,null);return}r=n.b.f;u=r?r.a:2;Diag.a.a(41799708,306,15,"Request to set label policy failed with error response: {0}. ApplyLabelFlag: {1}",n?n.b?n.b.k:null:null,u);this.bk="WACServerConnectionFailed";this.bb=0;this.bW(u,0)},C:function(n){return n&&(n==="LabelNotSupported"||n==="LabelErrorRetryLater"||n==="CoherencyFailure"||n==="LabelIdNotFound"||n==="LabelDisabled")?(Diag.a.a(539103556,306,50,"LabelError is retriable: {0}",n),!0):(Diag.a.a(539103557,306,50,"LabelError is not retriable: {0}",n),!1)},y:function(n){var i,r,t;if(!n)return!1;i=null;r=null;for(var f=this.W.SensitivityLabels,e=f.length,u=0;u<e;++u)t=f[u],t.Id===n&&(i=t),t.Id===this.Y&&(r=t);if(!i)return!1;if(this.bq&&this.bc){if(this.bw&&this.bw()||this.cq())return!0}else if(Common.a.B&&Common.a.B.a()||this.ba&&this.ba())return!0;return i.IsEndpointProtectionEnabled===(!!r&&r.IsEndpointProtectionEnabled)},w:function(n,t,i,r,u){n===28?this.ch(new Common.App.Policy.Contracts.g(n,t,i,r,u,!1)):this.ch(new Common.App.Policy.Contracts.g(n,t,i,r,u,!0))},c:function(n){n===28?this.cj(new Common.App.Policy.Contracts.l(n,!1)):this.cj(new Common.App.Policy.Contracts.l(n,!0))},cH:function(n,t,i){Diag.a.a(545280777,306,50,"Raising a CreateAutoCLPSecurityNodes event.");this.V.k("CreateAutoCLPSecurityNodesEventKey",new Common.App.Policy.Contracts.f(n,t,i),null)},cL:function(n){Diag.a.a(545280778,306,50,"Raising a UpdateAutoCLPLabelPriorityNode event.");this.V.k("UpdateAutoCLPLabelPriorityNodeEventKey",new Common.App.Policy.Contracts.f(null,null,n),null)},cM:function(n,t){Diag.a.a(545280779,306,50,"Raising a UpdateAutoCLPSITNodes event.");this.V.k("UpdateAutoCLPSITNodesEventKey",new Common.App.Policy.Contracts.f(n,t,null),null)},n:function(n,t){var i=t===1?"Reading":"Edit";Diag.a.a(572650527,306,50,"Raising a mandatory labelling"+i+" switch event.");this.V.k("MandatoryLabellingAppHandlerEventKey",new Common.App.Policy.Contracts.q(n,t),null)},x:function(n,t,i,r,u){n===37&&this.cG(new Common.App.Policy.Contracts.m(37,t,i,r,u))},R:function(){this.cJ(new Common.App.Policy.Contracts.t)},E:function(n){Diag.a.a(540608322,306,50,"Raising a UDP labeling event.");this.V.k("UDPLabelingAppHandlerEventKey",new Common.App.Policy.Contracts.w(n),null)},b:function(){var t=this,n=!!this.W&&this.W.AreLabelsAvailable&&!!this.W.SensitivityLabels&&this.W.SensitivityLabels.length>0&&Common.x.a(this.W.SensitivityLabels,function(n){return!!n&&n.Enabled});return n||Common.App.Policy.c.a(!1),n},cz:function(n){var t,f,e,r,u,i;if(this.bg&&(this.bg.a(),this.bg=null),t="",!(e=this.bX(n,f={val:t}),t=f.val,e)){this.bD();return}Diag.a.a(34996493,306,50,"Request to get label policy data succeeded.");this.bl=0;r=this.cE(t);u=this.cd(n.b);this.bf&&(Common.i.a().recordKpiSuccess("MipGetPolicyLabel",this.bB(null,u,this.bo)),this.bo=null);i=new Common.App.Policy.Contracts.i(u);this.cI(i);this.X.d("Microsoft.Office.SharedOnline.AutoCLPV2Transition",!1)?r&&this.cP()?this.bj?this.cR():(this.co(),this.bV(i),this.bj=!0):this.bD():!this.bj&&r&&this.X.a("WacApplyManualPolicyLabelIsEnabled")&&this.cb()?(this.bV(i),this.bj=!0):this.bD()},cP:function(){return this.X.a("WacApplyManualPolicyLabelIsEnabled")?this.cb()?this.Y===""?(Diag.a.a(539877696,306,50,"ShouldAutoClassificationRun returned true - document is not labeled"),!0):this.bd===this.by?(Diag.a.a(539877697,306,50,"ShouldAutoClassificationRun returned false - Applied label already has the highest priority"),!1):(Diag.a.a(539877698,306,50,"ShouldAutoClassificationRun returned true - document is labeled but not with the highest priority label"),!0):!1:(Diag.a.a(539877667,306,50,"ShouldAutoClassificationRun returned false - Manual Labeling is not enabled"),!1)},co:function(){this.cl();Diag.a.a(545104324,306,50,"Creating AutoCLP Security nodes. HasSITs: {0}, LabelPriority: {1}",this.bh.c>0,this.bd);var n=Common.eN.a(this.bh);this.cH(n,n,this.bd)},cR:function(){var t=this.bh,n;this.cl();Common.eN.b(t,this.bh)||(Diag.a.a(545104325,306,50,"Updating AutoCLP SIT nodes. HasSITs: {0}",this.bh.c>0),n=Common.eN.a(this.bh),this.cM(n,n));this.bP&&(Diag.a.a(545104326,306,50,"Updating AutoCLP Label Priority node. LabelPriority: {0}",this.bd),this.cL(this.bd))},cl:function(){for(var n,r,u=new($$sc.n.$$(String))($$sc.d.a()),f=this.W.SensitivityLabels,o=f.length,t=0;t<o;++t)if((n=f[t],n)&&n.AutoLabelingSensitiveTypeIds&&n.AutoLabelingSensitiveTypeIds.length>0)for(var e=n.AutoLabelingSensitiveTypeIds,s=e.length,i=0;i<s;++i)r=e[i],r&&u.a(r);this.bh=u},cy:function(n){var i=this.cd(n.b),t;if(this.bf&&(Common.i.a().recordKpiFailure("MipGetPolicyLabel","GetPolicyLabelsFailure",!1,!1,this.bB(null,i,this.bo)),this.bo=null),this.bg&&(this.bg.a(),this.bg=null),this.bl<=this.bn){if(this.X.a("SendHostAttributionInfoForPolicyLabelEnabled")&&(t=n.b.e.get_headers(),"HostAttributionInfo.ScenarioParamName"in t&&t.hascn&&"HostAttributionInfo.ScenarioTypeParamName"in t&&t.hascnt)){var u=n.b.e.get_headers().hascn,f=n.b.e.get_headers().hascnt,r=this.bS(i);this.bC(this.Y,r,this.ba,!1,i);return}this.B(this.Y,i,this.ba,!1);return}Diag.a.a(34996494,306,15,"Request to get label policy failed with error response: {0}.",n?n.b?n.b.k:null:null);this.bD();this.bl=0},cd:function(n){return n.f?n.f:0},bp:function(n,t){var r=this.X.b("PolicyHandlerWebServiceBase")||Common.a.b().a().n(),i=String.format("{0}{1}?action={2}&{3}",r,this.bA,n,Common.a.i);return n==="setpolicylabel"&&Common.a.B&&Common.a.B.c()&&(i=Common.k.a(i,"sl","1",!1)),t&&(i=Common.k.a(i,"cbd","1",!1)),i},ce:function(n,t,i){t.val=i.val=null;n&&n.a()&&n.a().e&&n.a().e.get_headers()&&(t.val=n.a().e.get_headers()["X-SelectedPolicyLabelId"],i.val=n.a().e.get_headers()["X-SetPolicyLabelJustification"])},bX:function(n,t){return(t.val=n?n.b?n.b.b:null:null,!t.val||!t.val.length||this.ct(t.val))?(Diag.a.a(25565152,306,10,"No response data from policy endpoint."),!1):!0},cD:function(n){var t;try{t=JSON.parse(n)}catch(i){Diag.a.a(37880331,306,10,"Error when deserializing DataLossPrevention response.");return}if(!t){Diag.a.a(25565185,306,10,"policyData is null after deserializing DataLossPrevention response.");return}if(!t.IsPolicyTipAvailable){Diag.a.a(26007260,306,10,"policyData.IsPolicyTipAvailable is null or empty whereas it should be 'true' or 'false'.");return}switch(t.IsPolicyTipAvailable.toLowerCase()){case"false":Diag.a.a(26007261,306,50,"policyData.IsPolicyTipAvailable is false so DLP policy tip is not present.");return;case"true":Diag.a.a(25565186,306,50,"DLP Policy is enabled on this document.");this.bx=t.NavigateUrl;this.cQ(t.GeneralText,this.bY);break;default:Diag.a.a(26007262,306,10,"policyData.IsPolicyTipAvailable is expected to be 'true' or 'false' but it is {0}",t.IsPolicyTipAvailable)}},cF:function(n,t,i,r){var u=r?r.a:2,e=0,s="",f,a,v,l,o,y,p,h,c;if(v=Common.bp.a(n,a={val:f}),f=a.val,v)if(f){if(s="Success",l=this.bS(3),f.IsSuccessful){this.bf&&(Common.i.a().recordKpiSuccess("MipSetPolicyLabel",this.bB(u,null,this.br)),this.br=null);this.bk=null;Diag.a.a(51233632,306,50,"setPolicyLabel was successful as seen after deserializing set policy label data response. ApplyLabelFlag: {0}",u);u===2&&this.c(29);this.cO(t,u);this.cu();this.c(28);r&&u===4&&(p=this,this.w(28,$a.N,String.format($a.ln,r.b),$a.m,function(){}));Common.A.a("MipAppliedLabels",!0,0,[(h=new Otel.a,h.name="SetPolicyLabelApplyFlag",h.string=Common.App.Policy.Contracts.e.toString(u),h)]);this.bC(t,l,this.ba,!1,3);return}Diag.a.a(51233631,306,10,"setPolicyLabel was unsuccessful as seen after deserializing set policy label data response. ApplyLabelFlag: {0}, FailureReason: {1}",u,f.FailureReason);this.bk=f.FailureReason;f.FailureReason==="FileTooLarge"?e=1:f.FailureReason==="LabelNotSupported"?e=2:this.X.a("ClpLabelDisabledErrorCodeIsEnabled")&&f.FailureReason==="LabelDisabled"?e=3:f.FailureReason==="MinorVersionLimitExceeded"&&(e=5);this.bL&&f.FailureReason.indexOf("InvalidOperationOnZeroByteFile")>=0&&(o=this,y=new Common.V(2,1,this.bM,function(){Diag.a.a(575428443,306,15,"Retring SetPolicyLabelRequestAsync as previous called failed due to zero byte. Attempt number : {0}",o.bb);o.bb<=o.bn&&o.U(t,i,null)},0,null,!1,0),this.bR.a(y));this.bq&&this.bc&&this.bC(this.W.AppliedPolicyId,l,this.ba,!0,3)}else s="setPolicyLabelData null.",Diag.a.a(42467541,306,10,"setPolicyLabelData is null after deserializing set policy label data response. ApplyLabelFlag: {0}",u);else s="TryDeserialize failed.",Diag.a.a(41799709,306,10,"Error when deserializing set policy label data response. ApplyLabelFlag: {0}",u);this.bW(u,e);this.bf&&(c=this.bB(u,null,this.br),this.br=null,c.extendedProperties.set("SetPolicyLabelDataFailureReason",this.bk),c.extendedProperties.set("SetPolicyLabelDataParseStatus",s.toString()),Common.i.a().recordKpiFailure("MipSetPolicyLabel","SetPolicyLabelFailure",!1,!1,c))},bW:function(n,t){this.W.AppliedPolicyId=this.Y;this.ci(new Common.App.Policy.Contracts.k(!1));var i=n===2||n===8||n===16;this.o(t,n,i,!1)},cO:function(n,t){var i;if(this.W.AppliedPolicyId=this.Y=n,n==="")this.X.d("Microsoft.Office.SharedOnline.ClpProtectFileUnchangedIsEnabled",!1)||(Common.a.bj=!1),Common.a.v=!1,Common.a.bO=!1;else for(var u=this.W.SensitivityLabels,f=u.length,r=0;r<f;++r)if(i=u[r],i.Id===n){this.X.d("Microsoft.Office.SharedOnline.ClpProtectFileUnchangedIsEnabled",!1)||(Common.a.bj=i.IsEndpointProtectionEnabled);Common.a.v=i.IsEndpointProtectionEnabled;break}this.cK(new Common.App.Policy.Contracts.u(n,t))},cS:function(){for(var n,i=this.W.SensitivityLabels,r=i.length,t=0;t<r;++t)n=i[t],n&&n.Enabled&&(n.Id===this.Y&&(this.bP=this.bd!==n.Order,this.bd=n.Order),n.Order>this.by&&(this.by=n.Order))},cE:function(n){var t,i,r;return(r=Common.bp.a(n,i={val:t}),t=i.val,r)?t?t.AreLabelsAvailable?(this.W=t,this.Y=t.AppliedPolicyId,this.X.d("Microsoft.Office.SharedOnline.AutoCLPV2Transition",!1)&&this.cS(),this.b()&&Diag.a.a(51197846,306,50,"Labels are available for display after GetPolicyLabels call."),this.ci(new Common.App.Policy.Contracts.k(!0)),!0):!1:(Diag.a.a(42467542,306,10,"policyData is null after deserializing label policy data response."),!1):(Diag.a.a(34996495,306,10,"Error when deserializing label policy data response."),!1)},cb:function(){var n;if(!this.b())return Diag.a.a(539877699,306,50,"AreAutoLabelingSensitiveTypesAvailable returned false - No labels to display"),!1;for(var i=this.W.SensitivityLabels,r=i.length,t=0;t<r;++t)if(n=i[t],n&&n.AutoLabelingSensitiveTypeIds&&n.AutoLabelingSensitiveTypeIds.length>0)return!0;return Diag.a.a(539877700,306,50,"AreAutoLabelingSensitiveTypesAvailable returned false - No labels with AutoClp SIT"),!1},ci:function(n){Diag.a.a(35393610,306,50,"Raising label info update event.");this.V.k("LabelInfoUpdateEvent",n,null)},cI:function(n){Diag.a.a(50676305,306,50,"Raising get policy label event.");this.V.k("GetPolicyLabelEventKey",n,null)},bD:function(){Common.App.Policy.c.a(!1);this.V.k("GetPolicyLabelFailureEventKey",new Common.App.Policy.Contracts.n,null)},bV:function(n){if(this.bv){var t=this;this.bv.a(function(i){var r=[i.a("MsoClpSpTwo",!0),i.a("MsoDrmPremiumSpTwo",!0)];Promise.all(r).then(function(i){var r=Common.x.a(i,function(n){return n});return r&&(Diag.a.a(50944077,306,50,"Raising get auto policy label event."),t.V.k("GetAutoPolicyLabelEventKey",n,null),Common.A.a("MipAutoClassificationEnabled",!0,0,null)),null})})}},bU:function(n,t){var i=new Map;return i.set("ClpCoauth",this.bc.toString()),n!=null&&i.set("ApplyLabelFlags",Common.App.Policy.Contracts.e.toString(n)),t!=null&&i.set("GetPolicyLabelsReason",Common.App.Policy.Contracts.j.toString(t)),i},bB:function(n,t,i){var r=new Common.U;return r.extendedProperties=this.bU(n,t),i!=null&&(r.durationMs=this.bT()-i),r},cK:function(n){Diag.a.a(41799710,306,50,"Raising set policy label event.");this.V.k("SetPolicyLabelEventKey",n,null)},ch:function(n){Diag.a.a(51128227,306,50,"Raising an add auto policy business bar entry event.");n&&n.c&&Common.A.a("MipRecommendations",!0,0,null);this.V.k("AddAutoPolicyBusinessBarEntryEventKey",n,null)},cj:function(n){Diag.a.a(51128256,306,50,"Raising an remove auto policy business bar entry event.");this.V.k("RemoveAutoPolicyBusinessBarEntryEventKey",n,null)},cG:function(n){Diag.a.a(573842331,306,50,"Raising an add mandatory labelling business bar entry event.");this.V.k("AddMandatoryLabellingBusinessBarEntryEventKey",n,null)},cJ:function(n){Diag.a.a(573842332,306,50,"Raising a remove mandatory labelling business bar entry event.");this.V.k("RemoveMandatoryLabellingBusinessBarEntryEventKey",n,null)},cQ:function(n,t){Diag.a.a(34996496,306,50,"Showing policy tip to user.");this.V.k("PolicyTipEvent",new Common.App.Policy.Contracts.s($a.N,n,$a.lq,t),null)},o:function(n,t,i,r){var e,h,c;if(Diag.a.a(42074656,306,r?50:15,"Raising set policy label failure event. ApplyLabelFlags: {0}",t),this.X.d("Microsoft.Office.SharedOnline.CommonBusinessBarEntryForSensitivityLabelError",!1)){var u=$a.cO,f=$a.cN,o=null,s=null;switch(n){case 1:u=$a.cQ;f=$a.cP;break;case 2:u=$a.cU;f=$a.cT;break;case 3:this.X.a("ClpLabelDisabledErrorCodeIsEnabled")&&(u=$a.cS,f=$a.cR);break;case 4:u=$a.cY;f=$a.cX;break;case 5:u=$a.cW;f=$a.cV;o=$a.n;h=this;s=function(){h.ck()}}e=new Common.App.Policy.Contracts.d(n,t,i,u,f,o,s)}else n===5?(c=this,e=new Common.App.Policy.Contracts.d(n,t,i,$a.cW,$a.cV,$a.n,function(){c.ck()})):e=new Common.App.Policy.Contracts.d(n,t,i,null,null,null,null);this.V.k("SetPolicyLabelFailureEventKey",e,null)},S:function(n){this.bz=n},cw:function(){this.bx?(Diag.a.a(25565187,306,50,"DLP override button was clicked."),Common.g.e(this.bx)):Diag.a.a(25565188,306,10,"Null NavigateUrl got in policy response. Could not navigate to SPO.")},ct:function(n){return!n.startsWith("<")||n.indexOf("Error")===-1&&n.indexOf("Unavailable")===-1?!1:(Diag.a.a(25565189,306,10,"The response from server is not a valid JSON response and it matches the error page keyword. This might be the error response from a non-existing endpoint."),!0)},cg:function(){this.bs&&(this.bs.a(),this.bs=null)},cr:function(n){if(!n)return Common.App.Policy.Contracts.a.toString(3);var t=n.a;switch(t){case 0:return Common.App.Policy.Contracts.a.toString(3);case 4:return Common.App.Policy.Contracts.a.toString(1);case 1:return Common.App.Policy.Contracts.a.toString(0);case 16:return Common.App.Policy.Contracts.a.toString(4);case 2:return Common.App.Policy.Contracts.a.toString(3);case 8:return Common.App.Policy.Contracts.a.toString(2);default:return Common.App.Policy.Contracts.a.toString(3)}},cs:function(n){if(!n)return Common.App.Policy.Contracts.b.toString(1);var t=n.a,i=Common.App.Policy.Contracts.b.toString(1);return(t===4||t===1)&&(i=Common.App.Policy.Contracts.b.toString(0)),i},cf:function(n){switch(n){case 1:return"Excel";case 4:return"OneNote";case 2:return"PowerPoint";case 5:return"Visio";case 3:return"Word";case 0:default:return"Unknown"}},bC:function(n,t,i,r,u){var f,e,o;this.X.a("WacLabelingGetPolicyLabelsIsEnabled")&&(this.Y=n,this.ba=i,this.Z&&(this.bg=this.Z.a("WebServiceCall","Call Get Policy Endpoint On Server")),f={},f["X-AppliedPolicyId"]=n,this.X.a("SendHostAttributionInfoForPolicyLabelEnabled")?(e=new Common.eE(this.bp("getpolicylabels",r),1,null,f,!0,2,u,null,null,!1,null,null,null,null,!1,null,null,null,null,t,null),o=this.be.l(e),o.b(this.bH,this.bG)):this.be.a(this.bp("getpolicylabels",r),1,null,f,!0,2,this.bH,this.bG,u,null,!1,null,null,"22",null,!1,null,!1,null),this.bl++,Diag.a.a(34996492,306,50,"Policy label request sent to server. Policy call times: {0}",this.bl))},cN:function(n,t,i,r){var u,f,e;if(!this.bK){Diag.a.a(570972052,306,50,"SetPolicyLabelRequestInternalAsync was exited - ApplyManualPolicyLabel was not enabled.");return}this.Z&&(this.bi=this.Z.a("WebServiceCall","Call Set Policy Endpoint On Server"));u={};u["X-SelectedPolicyLabelId"]=n;t&&(u["X-SetPolicyLabelJustification"]=encodeURIComponent(t));this.bz&&(u["X-AppLockId"]=this.bz);r?(u["X-SetPolicyLabelActionSource"]=this.cr(r),u["X-SetPolicyLabelAssignmentMethod"]=this.cs(r)):(u["X-SetPolicyLabelActionSource"]=Common.App.Policy.Contracts.a.toString(3),u["X-SetPolicyLabelAssignmentMethod"]=Common.App.Policy.Contracts.b.toString(1));this.bc&&this.W&&(u["X-PolicyLabelVersionToken"]=this.W.PolicyLabelVersionToken);this.X.a("SendHostAttributionInfoForPolicyLabelEnabled")?(f=new Common.eE(this.bp("setpolicylabel",!0),1,null,u,!0,2,r,null,null,!1,null,null,null,null,!1,null,null,null,null,i,null),e=this.be.l(f),e.b(this.bJ,this.bI)):this.be.a(this.bp("setpolicylabel",!0),1,null,u,!0,2,this.bJ,this.bI,r,null,!1,null,null,"32",null,!1,null,!1,null);this.bb++;Diag.a.a(41799706,306,50,"Set policy label request sent to server. Policy call times: {0}",this.bb)},ck:function(){var n=new CommonUI.d,t=this.X.b("BreadcrumbFolderUrl"),i;t?(n.D(11),n.E(1,$a.mi),n.E(2,$a.m)):(n.D(0),n.E(1,$a.m));n.eA($a.mj,"0f6cd105-974f-44a4-aadb-43ac5bdfd247",null);n.fC();i=this;n.bL($a.ml,$a.mk,function(n){n===1&&t&&Common.g.b(t,"_blank","","SetPolicyLabelFailureBusinessBarActionCallback.BreadcrumbFolderUrl")})},bS:function(n){switch(n){case 1:return Common.ci.a(1,1);case 2:return Common.ci.a(7,1);case 3:return Common.ci.a(8,1);case 0:default:return Common.ci.a(7,0)}},cp:function(n){if(!n)return Common.ci.a(8,0);var t=n.a;switch(t){case 1:case 16:return Common.ci.a(1,1);case 4:case 2:case 8:return Common.ci.a(8,1);case 0:default:return Common.ci.a(8,0)}}};Common.App.Policy.h=function(){this.r=Function.createDelegate(this,this.A);this.n=Function.createDelegate(this,this.w);this.q=Function.createDelegate(this,this.z);this.m=Function.createDelegate(this,this.v);this.o=Function.createDelegate(this,this.x);this.t=Function.createDelegate(this,this.C);this.p=Function.createDelegate(this,this.y);this.s=Function.createDelegate(this,this.B)};Common.App.Policy.h.a=function(){Common.App.a.a().a(new Common.App.Policy.h,0,!1)};Common.App.Policy.h.prototype={a:function(){return"Common.App.Policy"},e:null,g:null,f:null,d:null,j:null,l:null,k:null,h:null,i:null,b:function(){if(!Common.a.a.a("ShouldInitCommonPolicyPackage")){Common.App.Policy.c.a(!1);return}if(Common.a.a.a("IsDataLossPreventionEnabledForUser")&&Common.a.b()){this.e=this.g.a(Common.App.Policy.Contracts.c,null);this.e.h(this.s);Diag.a.a(36537375,306,50,"PolicyManager is created successfully.");var n=this;Common.App.AppLifecycleManager.get_instance().a(6,function(){n.e.l()},3)}Common.a.a.a("WacLabelingPoliciesIsEnabled")&&Common.a.a.a("SupportsPolicies")?Common.App.AppLifecycleManager.get_instance().a(6,this.p,3):Common.App.Policy.c.a(!1)},c:function(n){var i=this,t;n.c(Common.App.Policy.Contracts.c,null).a().b(function(){return new Common.App.Policy.f(Common.a.a,Common.a.e,Common.a.b().d(),Common.a.a.c("MaxGetPolicyRetries",1),n.b(Common.App.ApplicationFeatureHelper.a,null),Common.a.b().a().a())});t=this;n.c(Common.App.Policy.c,null).c(Common.App.Policy.Contracts.p,null).a().b(function(){return new Common.App.Policy.c(Common.a.c(),Common.a.b(),Common.a.a,n.e(Common.App.Policy.Contracts.c,null))});this.g=n},y:function(){this.f=this.g.a(Common.App.Policy.c,null);this.f.bl();this.d=this.g.d(CommonUI.t,null);this.e||(this.e=this.g.a(Common.App.Policy.Contracts.c,null));this.e.d(this.t);Common.a.a.a("WacApplyManualPolicyLabelIsEnabled")&&(this.e.e(this.o),this.e.f(this.m),this.e.i(this.q),this.e.g(this.n),this.e.j(this.r))},C:function(n,t){this.f.bn();this.f.bm();this.f.bk();var i=this.e.z();Common.a.a.a("HasDocumentEditRights")&&!i?Common.a.a.d("Microsoft.Office.SharedOnline.DefaultAndMandatoryLabelingDecouplingEnabled",!1)?this.f.bN():(this.f.s(),t.a&&this.f.bp()):Diag.a.a(558682911,306,50,"Default/Mandatory Labeling has been skipped because HasDocumentEditRights: {0}, IsClpBlockedByAppSpecificScenario: {1}",Common.a.a.a("HasDocumentEditRights"),i);Common.a.b().c(!1)},B:function(n,t){this.h&&this.d.b(38)&&this.d.a(this.h);var i=this.u(t.d,t.c,38,null,t.b,t.a,null,null),r=Common.a.b().a();if(!r.v(i,!0)){Diag.a.a(34174784,306,10,"Failed to add entry to business bar. Policy message could not be shown to user.");return}this.h=i;Diag.a.a(34174785,306,50,"Add entry to BusinessBar succeeded. Policy message is shown to user.")},x:function(n,t){var e;if(t.f){this.i&&this.d.b(21)&&this.d.a(this.i);var i=$a.cO,r=$a.cN,u=null,f=null;if(Common.a.a.d("Microsoft.Office.SharedOnline.CommonBusinessBarEntryForSensitivityLabelError",!1)?(i=t.e,r=t.d,u=t.c,f=t.b):t.a===1?(i=$a.cQ,r=$a.cP):t.a===2?(i=$a.cU,r=$a.cT):Common.a.a.a("ClpLabelDisabledErrorCodeIsEnabled")&&t.a===3?(i=$a.cS,r=$a.cR):t.a===4?(i=$a.cY,r=$a.cX):t.a===5&&(i=t.e,r=t.d,u=t.c,f=t.b),e=this.u(i,r,21,null,null,null,f,u),!Common.a.b().a().v(e,!0)){Diag.a.a(42074654,306,10,"Failed to add entry to business bar. CLP policy message could not be shown to user.");return}this.i=e;Diag.a.a(42074655,306,50,"Add entry to BusinessBar succeeded. CLP policy message is shown to user.")}},z:function(n,t){var i;i=t.a?this.l:this.j;i&&this.d&&this.d.b(t.b)&&this.d.a(i)},v:function(n,t){if(this.d){this.e.c(t.f);var i=new CommonUI.h(t.e,t.d,null);i.d(t.f);i.e(!0);i.f(3);i.a(t.a,t.b,t.a,!0);this.d.c(i,!1,null,null,null);t.c?this.l=i:this.j=i}},w:function(n,t){if(this.d){var i=new CommonUI.h(t.d,t.c,null);i.d(t.e);i.e(!1);i.f(3);i.a(t.a,t.b,t.a,!1);this.d.c(i,!1,null,null,null);this.k=i}},A:function(){var n=this.k;n&&this.d&&this.d.b(n.c())&&this.d.a(n)},u:function(n,t,i,r,u,f,e,o){var s=new CommonUI.h(n,t,r);return s.d(i),s.e(!0),u&&s.l(f,u),e&&s.a(o,e,o,!1),s}};Common.App.Policy.b=function(n,t){this.f=Function.createDelegate(this,this.p);this.i=Function.createDelegate(this,this.o);this.j=Function.createDelegate(this,this.t);this.h=Function.createDelegate(this,this.n);this.g=Function.createDelegate(this,this.q);this.a=[$a.db,$a.cZ,$a.dc];Common.App.Policy.b.initializeBase(this,[!1,!1,Common.App.Policy.b.c(),!1]);this.e=n;this.d=t;this.M=this.m();this.D(1);this.H=Common.App.Policy.b.e;this.E(1,$a.bg);this.bd(1,!1);this.bi=0};Common.App.Policy.b.c=function(){return Common.a.b().a().d()&&Common.a.b().a().Z()};Common.App.Policy.b.prototype={e:null,d:null,c:null,b:!1,s:function(){var n,t;if(Common.App.Policy.b.c())this.G($a.V,this.g,this.k(this.b));else{for(n={},t=0;t<this.a.length;t++)n[Common.App.Policy.b.b+t]=!1;n[Common.App.Policy.b.a]="";this.G($a.V,this.h,n);this.r();Common.m.b($get(Common.App.Policy.b.a),"input",this.j)}},bV:function(){if(Common.App.Policy.b.c())return this.l(this.c);var n=$get(Common.App.Policy.b.a);return n.disabled?!0:this.l(n.value)},l:function(n){var t=n.length<2,i=n.length>500,r=new RegExp("[{|}|;|\\\\]").test(n),u=Common.d.K(n)==="";return!t&&!i&&!r&&!u},n:function(n,t){var r="",i;if(n===1)for(i=0;i<this.a.length;i++)if(t[Common.App.Policy.b.b+i]){r=i===this.a.length-1?t[Common.App.Policy.b.a]:this.a[i];break}this.d(n,this.e,r)},q:function(n){var t="";n===1&&this.c&&(t=this.c);this.d(n,this.e,t)},o:function(n){this.c=n;var t=this.bV();this.b!==t&&(this.b=t,this.dh($a.V,this.g,this.k(this.b)))},k:function(n){return{id:this.H,bodyControls:{choiceGroupProps:{},textAreaProps:{placeholder:$a.dd}},actionButtonProps:{label:$a.bg,disabled:!n},infoMessage:$a.da,justificationIrrelevantLabel:$a.db,justificationIncorrectLabel:$a.cZ,justificationOtherLabel:$a.dc,onJustificationUpdated:this.i}},t:function(n){var t=n.target;t&&this.bd(1,this.bV())},m:function(){return CommonUI.b.a(Common.App.Policy.b.f,Common.a.q,Common.P.b(Common.App.Policy.b.d),$a.da,this.a[0],this.a[1],this.a[2],$a.dd)},r:function(){for(var t=document.getElementsByName(Common.App.Policy.b.g),n=0;n<t.length;n++)Common.m.b(t[n],"focus",this.f),Common.m.b(t[n],"click",this.f)},p:function(n){var i=n.target,t;i&&(i.checked=!0,t=$get(Common.App.Policy.b.a),i.id===Common.App.Policy.b.b+(this.a.length-1)?(t.disabled=!1,Sys.UI.DomElement.setVisible(t,!0),t.focus()):(t.disabled=!0,i.focus()),this.bd(1,this.bV()))}};Common.App.Policy.g=function(n,t,i){var r,f,e,u,o;if(this.c=Function.createDelegate(this,this.d),Common.App.Policy.g.initializeBase(this,[!1,!1,!0,!1]),!n||!i){Diag.a.a(560547850,306,10,"MandatoryLabelingDialog was triggered with invalid inputs");return}r={id:"MandatoryLabellingDialog"};this.b=i;this.a=t;(!Common.a.a.a("MandatoryLabelingDialogLearnMoreSwitchIsEnabled")||this.a&&this.a!=="")&&(f={href:this.a,target:"_blank"},r.learnMoreLink={type:"AppLinkProps",id:"mandatoryLabellingLearnMoreLink",text:$a.n,handler:f,customTooltip:$a.L_LearnMoreTooltip});e={id:"mandatoryLabellingFlyoutMenuSection",controls:n};u={sections:[],shouldAutoOpen:!1};Array.add(u.sections,e);r.labelFlyout={type:"AppFlyoutAnchorProps",id:"mandatoryLabellingFyout",label:"Pick a label",hideLabel:!1,hideChevron:!1,hideIcon:!0,menuDefinition:u};o={id:"MandatoryLabellingDialog",bodyControls:r};r.initialLabelText=$a.iL;r.descriptionText=$a.bK;this.G($a.bJ,this.c,o)};Common.App.Policy.g.prototype={b:null,a:null,d:function(n,t){if(n===1&&t.selectedLabel){var i=t.selectedLabel;if(i!==""){this.b(i);return}}}};Common.App.Policy.d=function(){this.b=!!Common.a.b()&&Common.a.b().a().d()};Common.App.Policy.d.b=function(){return Common.App.Policy.d.a||(Common.App.Policy.d.a=new Common.App.Policy.d)};Common.App.Policy.d.prototype={b:!1,a:function(n,t,i){return this.b?new Common.App.Policy.g(n,t,i):null}};Common.App.Policy.c.registerClass("Common.App.Policy.c",null,Common.App.Policy.Contracts.p);Common.App.Policy.b.registerClass("Common.App.Policy.b",CommonUI.b);Common.App.Policy.g.registerClass("Common.App.Policy.g",CommonUI.b);Common.App.Policy.e.a="<div class='WACDialogRow' id='JustificationMessageBlock'> <div class='WACDialogIcon' id='JustificationIconArea'> <div class='clip32x32' id='JustificationIconClip' unselectable='on' style='z-index: 0; display: inline-block;'> <img id='iconJustification' class='{1}' role='presentation' src={0} /> <\/div> <\/div> <div class='WACDialogTextPanel WACJustificationDialogMessage' id='JustificationMessageArea'> <label id='messageJustification' class='WACDialogLabel' >{2}<\/label> <\/div> <\/div> <br/> <div class='WACDialogTextPanel WACJustificationDialogRow' id='JustificationDlgBlock0'> <input type='radio' id='radiobox0' name='ListRadioBox' class='WACDialogRadio' alt='{3}' title='{3}'><\/input> <label id='JustificationDlgList0' class='WACDialogLabel' for='radiobox0' >{3}<\/label> <\/div> <div class='WACDialogTextPanel WACJustificationDialogRow' id='JustificationDlgBlock1'> <input type='radio' id='radiobox1' name='ListRadioBox' class='WACDialogRadio' alt='{4}' title='{4}'><\/input> <label id='JustificationDlgList1' class='WACDialogLabel' for='radiobox1' >{4}<\/label> <\/div> <div class='WACDialogTextPanel WACJustificationDialogRow' id='JustificationDlgBlock2'> <input type='radio' id='radiobox2' name='ListRadioBox' class='WACDialogRadio' alt='{5}' title='{5}'><\/input> <label id='JustificationDlgList2' class='WACDialogLabel' for='radiobox2' >{5}<\/label> <\/div> <div class='WACDialogTextPanel WACJustificationDialogRow WACJustificationDialogTextAreaRow' id='JustificationTextAreaBlock'> <textarea id='txtJustification' class='JustificationTextArea' placeholder='{6}' style='border:solid 1px grey;resize:none;' autocomplete=\"off\"><\/textarea> <\/div>";Common.App.Policy.a.A="sbProtectForm14";Common.App.Policy.a.C="SBStatusBarMarkAsReadOnly14";Common.App.Policy.a.q="Info_16x16x32";Common.App.Policy.a.i="QuickSearchCompletedToday_16x16x32";Common.App.Policy.a.h="CommonControlCheckboxCheck_16";Common.App.Policy.a.o="On";Common.App.Policy.a.d="Visible";Common.App.Policy.a.p="ImageIsVisible";Common.App.Policy.a.n="SourceControlId";Common.App.Policy.a.s="MenuItemId";Common.App.Policy.a.r="Menu";Common.App.Policy.a.f="AppLockId";Common.App.Policy.a.a="Value";Common.App.Policy.a.c="LabelText";Common.App.Policy.a.e="Alt";Common.App.Policy.a.l="Image16by16";Common.App.Policy.a.m="Image16by16Class";Common.App.Policy.a.z="SBProtectForm_16";Common.App.Policy.a.B="SBStatusBarMarkAsReadOnly_16";Common.App.Policy.a.b="Icon";Common.App.Policy.a.g="IconColor";Common.App.Policy.a.j="CustomTooltip";Common.App.Policy.a.x="MipTagOutline_24";Common.App.Policy.a.u="MipTagFilled_24";Common.App.Policy.a.w="MipTagLockOutline_24";Common.App.Policy.a.v="MipTagLockFilled_24";Common.App.Policy.a.t="MipTagError_24";Common.App.Policy.a.y="MipTagQuestion_24";Common.App.Policy.a.k="#000000";Common.App.Policy.a.D="No Label";Common.App.Policy.a.E="Select A Label";Common.App.Policy.b.f=Common.App.Policy.e.a;Common.App.Policy.b.g="ListRadioBox";Common.App.Policy.b.b="radiobox";Common.App.Policy.b.a="txtJustification";Common.App.Policy.b.d="Info_32x32x32";Common.App.Policy.b.e="JustificationDialog";Common.App.Policy.d.a=null;Common.App.Policy.h.a();Type.registerNamespace("_Ewa");_Ewa.VD=function(){};_Ewa.VD.prototype={c:null,b:null,a:0};_Ewa.VE=function(n,t,i,r,u){this.s=Function.createDelegate(this,this.Z);this.C=Function.createDelegate(this,this.X);this.B=Function.createDelegate(this,this.W);this.w=Function.createDelegate(this,this.bf);this.v=Function.createDelegate(this,this.be);this.q=Function.createDelegate(this,this.N);this.r=Function.createDelegate(this,this.Y);this.t=Function.createDelegate(this,this.bc);this.u=Function.createDelegate(this,this.bd);this.h=new($$sc.v.$$(Microsoft.Office.AugLoop.f));this.z=new($$sc.q.$$(_Ewa.AN,String))($$sc.g.a());_Ewa.VE.initializeBase(this,[!1]);this.j=n;this.c=t;this.a=i;this.m=r;this.d=u;this.T();this.bb();this.f=!1};_Ewa.VE.prototype={j:null,c:null,a:null,m:null,d:null,f:!1,A:3,e:null,b:null,g:!1,o:0,p:null,n:function(){return!this.f&&this.a.b().a()},dispose:function(){this.f||(this.f=!0,this.Q(),this.F(),this.e=null,this.c=null,this.j=null,_Ewa.bW.prototype.dispose.call(this))},l:function(n,t,i,r,u){if(Diag.a.a(51680793,306,50,"AutoPolicyManager: ApplyAutoPolicyLabel called for LabellingSource {0} with AutoLabelPresent: {1}, RecommendedLabelPresent: {2}, isStandard: {3}.",r,!(!n||!n.length),!(!t||!t.length),u),!this.n()){Diag.a.a(570450564,306,15,"AutoPolicyManager: ApplyAutoPolicyLabel failing because IsDisposed: {0}, IsSessionActive: {1}.",this.f,this.a.b().a());return}if(this.j){_Ewa.a.a("OfficeVSO:5317016_PowerBiRecommendationLabelFix")&&(this.M(t,r)?(this.p=t,this.o=r,this.z.b(r,t)):t=this.p);var f=this.j.br(n,t,i,u);Diag.a.a(572003334,306,50,"AutoPolicyManager::ApplyAutoPolicyLabel - policyActor.ApplyAutoPolicyLabel returned {0}.",f)}},M:function(n,t){var s,r,h,c,i;if(!this.c.b())return Diag.a.a(559941219,306,15,"CanShowRecommendedSensitivityLabel - Labels are not available."),!1;s=this.c.a();r=null;c=this.z.k(this.o,h={val:r},null);r=h.val;c;for(var u=null,f=null,e=null,l=s.SensitivityLabels,a=l.length,o=0;o<a;++o)i=l[o],i.Id===n&&(u=i),i.Id===r&&(f=i),i.Id===this.p&&(e=i);return f&&f.Id===n?(Diag.a.a(543549380,306,50,"AutoPolicyManager: CanShowRecommendedSensitivityLabel - Suppressing the recommendation since it is same as last recommendation from current source."),!1):this.d.c(37)&&this.o!==t&&e&&(!u||e.Order>=u.Order)?(Diag.a.a(543549379,306,50,"AutoPolicyManager: CanShowRecommendedSensitivityLabel - Suppressing the recommendation since current label priority is lower than last label priority."),!1):!0},bb:function(){this.c.f(this.u);this.c.i(this.t);this.a.b().H(this.r);_Ewa.a.c("Microsoft.Office.SharedOnline.AutoCLPV2Transition",!1)&&(this.c.p(this.q),this.c.u(this.v),this.c.v(this.w))},Q:function(){this.d.b(37);this.d.b(36);this.c.G(this.u);this.c.L(this.t);this.a.b().J(this.r);_Ewa.a.c("Microsoft.Office.SharedOnline.AutoCLPV2Transition",!1)&&(this.c.I(this.q),this.c.P(this.v),this.c.Q(this.w))},T:function(){var n,t;this.b=new($$sc.q.$$(_Ewa.AN,_Ewa.VE.a))($$sc.g.a());this.b.d(1,(n=new _Ewa.VE.a,n.c=Microsoft.Office.AugLoop.Automatic.Clp.a.a(),n.d=this.B,n.a=!1,n.b=!1,n));this.b.d(2,(t=new _Ewa.VE.a,t.c=Microsoft.Office.AugLoop.LinkedDataType.a.a(),t.d=this.C,t.a=!1,t.b=!1,t))},N:function(n,t){var i,r,u,f=(u=new Microsoft.Office.AugLoop.e,u.parentPath=["session","doc","security"],u.items=[(r=new Microsoft.Office.AugLoop.c,r.id="clp",r.body=(i=new Microsoft.Office.AugLoop.SecurityShared.a,i.existingLabelPriority=t.c,i.partialDocSITs=t.b,i.fullDocSITs=t.a,i),r)],u);this.h.b(f);this.i()},be:function(n,t){var u,i,r,f=(r=new Microsoft.Office.AugLoop.d,r.parentPath=["session","doc","security"],r.items=[(i=new Microsoft.Office.AugLoop.c,i.id="clp",i.body=(u=new Microsoft.Office.AugLoop.SecurityShared.a,u.existingLabelPriority=t.c,u),i)],r);this.h.b(f);this.i()},bf:function(n,t){var i,r,u,f=(u=new Microsoft.Office.AugLoop.d,u.parentPath=["session","doc","security"],u.items=[(r=new Microsoft.Office.AugLoop.c,r.id="clp",r.body=(i=new Microsoft.Office.AugLoop.SecurityShared.a,i.partialDocSITs=t.b,i.fullDocSITs=t.a,i),r)],u);this.h.b(f);this.i()},H:function(){for(var n=this.h.$$lge(),t;n.$$mn();)t=n.$$cu(),this.e.f(t);this.h=new($$sc.v.$$(Microsoft.Office.AugLoop.f))},ba:function(n){return this.b.c(n)?this.b.a(n).a?(Diag.a.a(571479128,306,15,"AutoPolicyManager::RegisterAnnotation - Annotations already registered for LabellingSource {0}.",n),!0):(this.b.a(n).a=!0,Diag.a.a(571479127,306,50,"AutoPolicyManager::RegisterAnnotation - Annotations registered for LabellingSource {0}.",n),!this.a.j())?(Diag.a.a(571479126,306,50,"AutoPolicyManager::RegisterAnnotation - Skipping AugmentationLoop initialization in view mode."),!0):(_Ewa.a.c("Microsoft.Office.SharedOnline.AutoCLPV2Transition",!1)?this.i():this.G(),!0):(Diag.a.a(571479129,306,15,"AutoPolicyManager::RegisterAnnotation - AnnotationActivationOptions not available for LabellingSource {0}.",n),!1)},G:function(){for(var n=!1,i=this.b.$$ge(),r,t,u;i.$$mn();)if(r=i.$$cu(),n=!!(n|r.a.a),n)break;if(!n){Diag.a.a(571479125,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessaryAndActivateAnnotations - no registered annotations.");return}if(this.e){Diag.a.a(571479124,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessaryAndActivateAnnotations - AugmentationLoop already initialized.");this.k();return}if(this.g){Diag.a.a(571479123,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessaryAndActivateAnnotations - AugmentationLoop initialization in-progress.");return}this.g=!0;t=this.a.e().FlightingSettings.AutoCLPStartUpDelay;Diag.a.a(571479122,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessaryAndActivateAnnotations - Initializing AugmentationLoop in {0} milliseconds.",t);u=this;_Ewa.B.a().a(function(){u.U()},t,_Ewa.o.d,!0,!0)},i:function(){var n=this.h.f.length>0,t,r,i,u;if(!n)for(t=this.b.$$ge();t.$$mn();)if(r=t.$$cu(),n=!!(n|r.a.a),n)break;if(!n){Diag.a.a(540667925,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessary - no registered annotations and operations.");return}if(this.e){Diag.a.a(540667924,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessary - AugmentationLoop already initialized.");this.k();this.H();return}if(this.g){Diag.a.a(540667923,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessary - AugmentationLoop initialization in-progress.");return}this.g=!0;i=this.a.e().FlightingSettings.AutoCLPStartUpDelay;Diag.a.a(540667922,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessary - Initializing AugmentationLoop in {0} milliseconds.",i);u=this;_Ewa.B.a().a(function(){u.V()},i,_Ewa.o.d,!0,!0)},V:function(){var n=this;_Ewa.g.a(_Ewa.l.a(_Ewa.eK,this.a.a(),328,327,1,null),function(t){if(n.e=t.a(),n.g=!1,!n.e){Diag.a.a(540667921,306,10,"AutoPolicyManager::InitAugmentationLoop - Failed to instantiate AugmentationLoopManager.");return}if(Diag.a.a(540667920,306,50,"AutoPolicyManager::InitAugmentationLoop - AugmentationLoopManager instantiated."),n.e.d(n.s),!n.a.j()){Diag.a.a(540667919,306,50,"AutoPolicyManager::InitAugmentationLoop - Skipping annotation activation in view mode.");return}n.k();n.H()},this.ew(),3,null,null)},U:function(){var n=this;_Ewa.g.a(_Ewa.l.a(_Ewa.eK,this.a.a(),328,327,1,null),function(t){if(n.e=t.a(),n.g=!1,!n.e){Diag.a.a(571479121,306,10,"AutoPolicyManager::InitAugmentationLoop - Failed to instantiate AugmentationLoopManager.");return}if(Diag.a.a(571479120,306,50,"AutoPolicyManager::InitAugmentationLoop - AugmentationLoopManager instantiated."),n.e.d(n.s),!n.a.j()){Diag.a.a(570450568,306,50,"AutoPolicyManager::InitAugmentationLoop - Skipping annotation activation in view mode.");return}n.k()},this.ew(),3,null,null)},F:function(){for(var t=this.b.$$ge(),n;t.$$mn();)n=t.$$cu(),n.a.a&&this.P(n.b)},P:function(n){this.b.a(n).b&&this.E(n);this.b.a(n).a=!1;Diag.a.a(571479119,306,50,"AutoPolicyManager::DeregisterAnnotation completed for LabellingSource {0}.",n)},k:function(){for(var t=this.b.$$ge(),n;t.$$mn();)n=t.$$cu(),n.a.a&&!n.a.b&&this.J(n.b)},J:function(n){this.e.a(this.b.a(n).c,null);this.e.b(this.b.a(n).c,this.b.a(n).d);this.b.a(n).b=!0;Diag.a.a(571479118,306,50,"AutoPolicyManager::ActivateAnnotation completed for LabellingSource {0}.",n)},O:function(){for(var t=this.b.$$ge(),n;t.$$mn();)n=t.$$cu(),n.a.b&&this.E(n.b)},E:function(n){this.e.c(this.b.a(n).c,this.b.a(n).d);this.b.a(n).b=!1;Diag.a.a(571479117,306,50,"AutoPolicyManager::DeactivateAnnotation completed for LabellingSource {0}.",n)},Y:function(){Diag.a.a(571479116,306,50,"AutoPolicyManager::OnApplicationModeChanged - isEditMode:{0}.",this.a.j());this.a.j()?_Ewa.a.c("Microsoft.Office.SharedOnline.AutoCLPV2Transition",!1)?this.i():this.G():(this.d.b(37),this.d.b(36),this.O())},Z:function(){Diag.a.a(571479115,306,50,"AutoPolicyManager::OnAugmentationLoopSessionClose called.");this.F();this.e=null},W:function(n,t){var i;if(Diag.a.a(50935426,306,50,"AutoPolicyManager::LabellingAnnotationHandler called."),t.b===3){Diag.a.a(51512411,306,50,"AutoPolicyManager::LabellingAnnotationHandler Ignoring delete operation.");return}if(i=t.a,!i){Diag.a.a(50974996,306,50,"AutoPolicyManager::LabellingAnnotationHandler LabellingAnnotation is null.");return}var r=null,u=null,f=null;i.automatic&&i.automatic.sensitivityLabel&&i.automatic.sensitivityLabel.id&&(r=i.automatic.sensitivityLabel.id);i.recommended&&i.recommended.sensitivityLabel&&i.recommended.sensitivityLabel.id&&(u=i.recommended.sensitivityLabel.id,i.recommended.sensitivityLabel.policyTip&&(f=i.recommended.sensitivityLabel.policyTip));this.x(r,u,f,1)},X:function(n,t){var i,r;if(Diag.a.a(577360095,306,50,"AutoPolicyManager::LinkedDataTypeLabellingAnnnotationHandler - Handler called."),t.b===3){Diag.a.a(577360094,306,50,"AutoPolicyManager::LinkedDataTypeLabellingAnnnotationHandler - Received delete operation.");return}if(i=t.a,!i){Diag.a.a(577360093,306,50,"AutoPolicyManager::LinkedDataTypeLabellingAnnnotationHandler - Received an empty annotation.");return}r=i.classificationId;this.x(r,r,null,2)},x:function(n,t,i,r){if(this.m.a("SupportsOfficeClientCoauthoring"))Diag.a.a(572003347,306,50,"AutoPolicyManager::ApplyPolicyLabel - SupportsOfficeClientCoauthoring is enabled."),this.l(n,t,i,r,!1);else{Diag.a.a(572003346,306,50,"AutoPolicyManager::ApplyPolicyLabel - SupportsOfficeClientCoauthoring is disabled.");var f=this,u=function(u){var e=!u||u===1||u===4;f.l(n,t,i,r,e)},e=this;this.y(u,function(){u(2)},this.A,0)}},K:function(n,t){var i=null,r=null,u,f,e;return(e=this.I(n,u={val:i},f={val:r}),i=u.val,r=f.val,e)?r&&r.Order>=i.Order?(Diag.a.a(559941249,306,50,"AutoApplyOrRecommendPolicyLabel - The applied label has a higher sensitivty."),!1):(this.x(i.Id,i.Id,null,t),!0):(Diag.a.a(559941250,306,15,"AutoApplyOrRecommendPolicyLabel - Failed to set the sensitivity labels."),!1)},L:function(n,t){var i,r,f,e,o,u,s;if(t.val=!1,i=null,r=null,!(o=this.I(n,f={val:i},e={val:r}),i=f.val,r=e.val,o))return Diag.a.a(559941248,306,15,"AutoApplyOrRecommendPowerBILabel - Failed to set the sensitivity labels."),!1;if(r&&!(!r.ParentId||!r.ParentId.length)&&!(!i.ParentId||!i.ParentId.length)&&r.ParentId===i.ParentId)return Diag.a.a(572003342,306,50,"AutoPolicyManager::AutoApplyOrRecommendPowerBILabel - Label has a common parent with AppliedLabel."),!1;if(r&&r.Order>=i.Order)return Diag.a.a(572003341,306,50,"AutoPolicyManager::AutoApplyOrRecommendPowerBILabel - Label does not have a higher priority than AppliedLabel."),!1;if(this.m.a("SupportsOfficeClientCoauthoring"))Diag.a.a(572003340,306,50,"AutoPolicyManager::AutoApplyOrRecommendPowerBILabel - SupportsOfficeClientCoauthoring is enabled."),u=this.c.a(),s=!u.AppliedPolicyId||!u.AppliedPolicyId.length||!u.PolicyLabelAssignmentMethod||u.PolicyLabelAssignmentMethod.toUpperCase()===Common.App.Policy.Contracts.b.toString(0).toUpperCase(),this.D(i.Id,s);else{Diag.a.a(572003339,306,50,"AutoPolicyManager::AutoApplyOrRecommendPowerBILabel - SupportsOfficeClientCoauthoring is disabled.");var c=this,h=function(n){var t=!n||n===1||n===4;c.D(i.Id,t)},l=this;this.y(h,function(){h(2)},this.A,0)}return!0},y:function(n,t,i,r){if(!this.n()){Diag.a.a(570450567,306,15,"AutoPolicyManager: GetPolicyApplicationMethod failing because IsDisposed: {0}, IsSessionActive: {1}.",this.f,this.a.b().a());return}var u=this.a.c().a().b(!1),f=this,e=this;_Ewa.sI.b(this.a.c().a(),this.a.e().DocumentHostInfo.TenantId,function(t){f.S(t,n)},function(){e.R(n,t,i,r)},null,null,u)},S:function(n,t){if(Diag.a.a(572003338,306,50,"AutoPolicyManager: GetPolicyApplicationMethod web service call was successful."),!this.n()){Diag.a.a(570450566,306,50,"AutoPolicyManager: GetPolicyApplicationMethodSuccessCallback failing because IsDisposed: {0}, IsSessionActive: {1}.",this.f,this.a.b().a());return}if(!n||_Ewa.O.a(n)){Diag.a.a(572003337,306,15,n?"AutoPolicyManager: GetPolicyApplicationMethod result has non-status message.":"AutoPolicyManager: GetPolicyApplicationMethod result is null");return}var i=n.Result;t(i)},R:function(n,t,i,r){if(Diag.a.a(572003336,306,15,"AutoPolicyManager: GetPolicyApplicationMethod web service call failed. Trying again"),!this.n()){Diag.a.a(570450565,306,50,"AutoPolicyManager: GetPolicyApplicationMethodFailureCallback failing because IsDisposed: {0}, IsSessionActive: {1}.",this.f,this.a.b().a());return}if(r>=i){Diag.a.a(572003335,306,15,"AutoPolicyManager: GetPolicyApplicationMethod max retries exhausted.");t();return}this.y(n,t,i,r+1)},D:function(n,t){t?this.l(n,null,null,3,!0):this.l(null,n,null,3,!1)},bc:function(n,t){if(!t){Diag.a.a(51241993,306,15,"RemoveAutoPolicyBusinessBar is called but AddAutoPolicyBusinessBarEntryEventArgs is null.");return}t.a&&this.d.c(37)?(this.d.b(37),Diag.a.a(51241994,306,50,"Remove entry to RecommendedSensitivityLabelBusinessBarEntry succeeded.")):!t.a&&this.d.c(36)&&(this.d.b(36),Diag.a.a(51241995,306,50,"Remove entry to AutomaticSensitivityLabelBusinessBarEntry succeeded."))},bd:function(n,t){var i,r;if(!t){Diag.a.a(51241996,306,15,"ShowAutoPolicyBusinessBar is called but AddAutoPolicyBusinessBarEntryEventArgs is null.");return}t.c?(i=this,this.d.o(t.e,t.d,t.a,function(n){t.b(n);i.d.c(37)&&i.d.b(37)}),Diag.a.a(51241997,306,50,"Add entry to RecommendedSensitivityLabelBusinessBarEntry succeeded. Message is shown to user.")):(r=this,this.d.j(t.e,t.d,t.a,function(n){t.b(n);r.d.c(36)&&r.d.b(36)}),Diag.a.a(51241998,306,50,"Add entry to AutomaticSensitivityLabelBusinessBarEntry succeeded. Message is shown to user."))},I:function(n,t,i){var r,o,h,u;if(t.val=null,i.val=null,!this.a.j())return!1;if(!this.c.b())return Diag.a.a(546067473,306,15,"TryGettingSensitivityLabels - Labels are not available."),!1;if(r=this.c.a(),!r)return Diag.a.a(559941218,306,15,"TryGettingSensitivityLabels - GetPolicyLabelsData returned an invalid result."),!1;if(!r.SensitivityLabels||!r.SensitivityLabels.length)return Diag.a.a(559941217,306,15,"TryGettingSensitivityLabels - Attempting to apply labels when there are no sensitivity labels available."),!1;o=r.AppliedPolicyId;for(var s=n,l=s.length,f=0;f<l;++f){h=s[f];for(var c=r.SensitivityLabels,a=c.length,e=0;e<a;++e)u=c[e],u.Id===h&&(!t.val||t.val.Order<u.Order)&&(t.val=u),u.Id===o&&(i.val=u)}return t.val?!0:(Diag.a.a(559941216,306,10,"TryGettingSensitivityLabels - None of the sensitivity labels matched."),!1)}};_Ewa.VE.a=function(){};_Ewa.VE.a.prototype={c:null,d:null,a:!1,b:!1};_Ewa.AM=function(n){_Ewa.AM.initializeBase(this,[n,_Ewa.AM.a(n)])};_Ewa.AM.a=function(n){return n.s()&2?_Ewa.i.b(3,1,0,1862,0,-1237306487,"SensitivityLabelBlockApplyLabelOpenInDesktop"):_Ewa.i.b(1,1,0,1863,0,-313914360,"SensitivityLabelBlockApplyLabel")};_Ewa.AM.prototype={J:function(){var t,n;_Ewa.dt.prototype.J.call(this);this.B.Appearance&1&&this.D.s()&2&&(t=this.n(0),_Ewa.b.U(t.get_element(),_Ewa.ClientStringManager.a().a(1243)),n=this,this.d(function(){0===n.P&&n.D.s()&2&&(Diag.a.a(50373725,306,50,"BlockSenitivityLabelActionDialog : Opening the book in excel desktop."),_Ewa.g.a(_Ewa.l.a(_Ewa.hy,n.D.a(),55,56,0,null),function(n){n.a().a()},n.D.g(),3,null,null))}))}};_Ewa.AO=function(n){_Ewa.AO.initializeBase(this);this.h=n;this.l()};_Ewa.AO.a=function(n){n.a().b(_Ewa.bkq.$$(_Ewa.gR),275,new _Ewa.AO(n))};_Ewa.AO.prototype={h:null,a:function(){var t=_Ewa.l.a(_Ewa.cR,this.h.a(),5,4,this.j,null),i=Common.a.e,r=Common.a.a,n=this;_Ewa.g.a(t,function(){try{var f=new($$sc.z.$$(Common.App.Policy.Contracts.c))(function(){return new Common.App.Policy.f(r,i,Common.a.b().d(),n.h.e().MaxGetPolicyRetries,Common.Utils.a.a().b(Common.App.ApplicationFeatureHelper.a,null),0)}),o=new($$sc.z.$$(Common.App.Policy.c))(function(){return new Common.App.Policy.c(Common.a.c(),Common.a.b(),Common.a.a,f)}),u=n.h.a().a(_Ewa.gR,274,!1,null);u||(u=new _Ewa.PolicyManagerWrapper(f.a(),o.a(),t.a(),n.h,Common.a.a),u.bl());n.k(u)}catch(e){Diag.a.a(36444224,306,10,"PolicyManager was not created successfully [Exception: {0}]",e.toString());throw e;}},this.i(),3,null,null)}};_Ewa.PolicyManagerWrapper=function(n,t,i,r,u){this.U=Function.createDelegate(this,this.bp);this.C=Function.createDelegate(this,this.bc);this.L=Function.createDelegate(this,this.bz);this.G=Function.createDelegate(this,this.bq);this.W=Function.createDelegate(this,this.bA);this.D=Function.createDelegate(this,this.be);this.F=Function.createDelegate(this,this.bo);this.J=Function.createDelegate(this,this.bu);this.B=Function.createDelegate(this,this.ba);this.H=Function.createDelegate(this,this.br);this.E=Function.createDelegate(this,this.bj);this.I=Function.createDelegate(this,this.bs);this.K=Function.createDelegate(this,this.bx);this.T=Function.createDelegate(this,this.bn);this.S=Function.createDelegate(this,this.bm);this.R=Function.createDelegate(this,this.bd);this.V=Function.createDelegate(this,this.bw);this.l=this.a;this.m=this.k;_Ewa.PolicyManagerWrapper.initializeBase(this,[!1]);this.n=r;this.o=n;this.q=i;this.r=u;this.o.h(this.V);this.s=t};_Ewa.PolicyManagerWrapper.prototype={o:null,n:null,r:null,w:null,s:null,y:!1,q:null,t:null,x:!1,A:null,u:null,z:!1,bl:function(){if(this.r.a("SupportsPolicies")){this.p=this.r.b("AppliedPolicyId");this.s.bl();var n=this;this.n.a().c(_Ewa.ch,29,function(t){n.w=t;t.c(n)},null);this.Z();this.bt();this.s.v=this.R;this.s.y=this.S;this.o.F(this.T)}_Ewa.a.b(173)&&this.n.b().e().a(45)&&(Diag.a.a(34402886,306,50,"DataLossPrevention feature is Enabled and launched on Excel."),this.bh())},a:function(n){this.es("LabelInfoChangedKey",n)},k:function(n){this.eu("LabelInfoChangedKey",n)},i:function(){return!0},g:function(n,t){if(n!=="QueryPolicyLabel")return!1;var i=Common.a.c().c(497870830,2,t,null);return i===32},dispose:function(){if(this.w&&(this.w.b(this),this.w=null),this.s.bO(),this.y=!1,this.o.N(this.K),this.o.O(this.I),this.n.b().s(this.E),this.r.a("SupportsOfficeClientCoauthoring")){var n=this.n.a().a(_Ewa.ih,292,!1,null);n&&n.f(this.H)}this.o.H(this.B);this.o.M(this.J);this.o.K(this.F);_Ewa.a.b(301)&&this.o.J(this.D);this.t&&(this.t.dispose(),this.t=null);_Ewa.bW.prototype.dispose.call(this)},P:null,h:function(){return this.P},O:null,f:function(){return this.O},M:null,d:function(){return this.M},N:null,e:function(){return this.N},p:null,b:function(n,t){return this.r.a("SupportsPolicies")?this.z?!n||!n.length?!1:(this.t||this.Q(),this.t.K(n,t)):(Diag.a.a(559941214,306,15,"AutoApplyOrRecommendPolicyLabel - PolicyData hasn't been received yet."),!1):(Diag.a.a(559941215,306,15,"AutoApplyOrRecommendPolicyLabel - Called when SupportPolicies is disabled."),!1)},Z:function(){this.er("LabelInfoChangedKey",null,null)},bh:function(){this.o.l()},bi:function(){return this.n.e().DocumentHostInfo.TenantId},bt:function(){var n=this;Common.App.AppLifecycleManager.get_instance().a(10,function(){if(n.o.d(n.W),n.o.s(n.G),n.o.r(n.G),n.o.e(n.K),n.o.k(n.I),n.n.b().q(n.E),n.o.g(n.B),n.o.j(n.J),n.o.t(n.F),n.r.a("SupportsOfficeClientCoauthoring")){var t=n.n.a().a(_Ewa.ih,292,!1,null);t&&t.d(n.H)}_Ewa.a.b(301)&&(Diag.a.a(589177409,306,50,"PolicyManagerWrapper: ApplyAutomaticPolicyLabel enabled and registered GetAutoPolicyLabelHandler"),n.o.q(n.D));n.bf()},3)},bf:function(){this.r.a("SupportsOfficeClientCoauthoring")||this.p&&this.p.length?this.v():this.bg(this.bi())},be:function(){Diag.a.a(589177379,306,50,"PolicyManagerWrapper::EnableAutoLabellingInDocument - Triggered EnableAutoLabellingInDocument");var n=this.j(1);Diag.a.a(571479113,306,50,"PolicyManagerWrapper::EnableAutoLabellingInDocument - Annotation registration result: {0}.",n)},Q:function(){this.t=new _Ewa.VE(this.s,this.o,this.n,this.r,this.q)},j:function(n){return this.r.a("SupportsPolicies")?(this.t||this.Q(),this.t.ba(n)):(Diag.a.a(571479112,306,10,"PolicyManagerWrapper::RegisterAugmentationLoopAnnotations called when CLP is disabled."),!1)},c:function(n,t){return _Ewa.a.a("OfficeVSO:5697254_ApplyPowerBiLabel")?this.r.a("SupportsPolicies")?this.z?(this.t||this.Q(),this.t.L(n,t)):(Diag.a.a(562628763,306,15,"PolicyManagerWrapper::AutoApplyOrRecommendPowerBILabel called before PolicyData fetch is complete."),t.val=!0,!1):(Diag.a.a(572003333,306,10,"PolicyManagerWrapper::AutoApplyOrRecommendPowerBILabel called when CLP is disabled."),t.val=!1,!1):(Diag.a.a(572003331,306,10,"PolicyManagerWrapper::AutoApplyOrRecommendPowerBILabel called when BRS ApplyPowerBiLabel is disabled."),t.val=!1,!1)},bg:function(n){Diag.a.a(41740191,306,50,"PolicyManagerWrapper: Doing GetPolicyLabelId web service call with tenantId length {0}",n.length);var t=this.n.c().a().b(!1),i=this;_Ewa.sI.c(this.n.c().a(),n,function(n){i.by(n)},null,null,null,t)},by:function(n){Diag.a.a(41740192,306,50,"PolicyManagerWrapper: GetPolicyLabelId web service call was successful");n&&!_Ewa.O.a(n)&&(this.p=n.Result);this.v();this.p?Diag.a.a(41740193,306,50,"PolicyManagerWrapper: Fetched LabelId length from custom.xml is {0}",this.p.length):Diag.a.a(41740194,306,50,"PolicyManagerWrapper: LabelId is invalid")},v:function(){this.o.B(this.p,0,null,!1)},bw:function(n,t){if(!t){Diag.a.a(34402887,306,15,"ShowPolicyBusinessBar is called but PolicyTipventArgs is null.");return}this.P=t.d;this.O=t.c;this.M=t.a;this.N=t.b;this.q.a(27,null,null,null);Diag.a.a(34402888,306,50,"Add entry to BusinessBar succeeded. Message is shown to user.")},bx:function(n,t){var i=$$as(Common.App.Policy.Contracts.d,t),r,u;i?i.f?this.r.d("Microsoft.Office.SharedOnline.CommonBusinessBarEntryForSensitivityLabelError",!1)?(Diag.a.a(541083296,306,15,"ShowSetPolicyLabelFailureInBusinessBar :: SetPolicyLabelFailure because of {0}",i.a),r=this,this.q.p(i.e,i.d,i.c,function(n){i.b&&(r.q.c(49)&&r.q.b(49),i.b(n))})):i.a===1?(Diag.a.a(578414677,306,15,"ShowSetPolicyLabelFailureInBusinessBar :: SetPolicyLabelFailure because of File too large"),this.q.a(44,null,null,null)):i.a===2?this.q.a(45,null,null,null):i.a===3?this.q.a(46,null,null,null):i.a===4?this.q.a(47,null,null,null):this.r.d("Microsoft.Office.SharedOnline.PassSetLabelMinorVersionLimitReachedErrorArgs",!1)&&i.a===5?(u=this,this.q.q(i.e,i.d,i.c,function(n){u.q.c(48)&&u.q.b(48);i.b(n)})):this.q.a(43,null,null,null):Diag.a.a(574226717,306,50,"ShowSetPolicyLabelFailureInBusinessBar :: SetPolicyLabelFailure ShowMessage is false"):(Diag.a.a(574226716,306,10,"ShowSetPolicyLabelFailureInBusinessBar :: SetPolicyLabelFailure args is null"),this.q.a(43,null,null,null))},bA:function(n,t){var i,r;this.s&&(Diag.a.a(41961095,306,50,"PolicyManagerWrapper: UpdateLabelInfo called"),this.s.bn(),this.s.bm(),this.s.bk(),this.n.s()&64&&(_Ewa.a.a("OfficeVSO:5442839_DisableDefaultlabelForView")||this.s.s(),t.a&&this.u?this.bb(!0):this.s.bp(),_Ewa.a.a("OfficeVSO:5442839_DisableDefaultlabelForView")&&(this.n.j()?this.s.s():Common.a.z||this.n.b().H(this.L))));this.r.a("SupportsOfficeClientCoauthoring")&&(i=this.o.a(),this.p=i.AppliedPolicyId,this.p==="null"&&(this.p=""),this.x&&(r=4,r=i.PolicyLabelAssignmentMethod&&i.PolicyLabelAssignmentMethod.toUpperCase()===Common.App.Policy.Contracts.b.toString(0).toUpperCase()?4:2,this.X(this.p,r,!0,this.A)));this.Y();this.Z()},bq:function(){this.z=!0;this.Y()},bs:function(n,t){Diag.a.a(42322116,306,50,"PolicyManagerWrapper.OnSetLabelSucceeded: Applying outcomes for change in policy label. ProtectedFile = {0}, ApplyLabelFlag = {1}",Common.a.v,t.a);this.X(t.b,t.a,!1,null)},Y:function(){if(!this.y){this.n.t();this.y=!0;this.q.i();var n={};n.hasLabel=!!this.p&&this.p.length>0;n.isProtectedFile=this.r.a("ProtectedFile");n.SupportsPolicies=this.r.a("SupportsPolicies");n.AreLabelsAvailableForDisplay=this.o.b();n.SupportsOfficeClientCoauthoring=this.r.a("SupportsOfficeClientCoauthoring");n.IsAnonymousUser=this.r.a("IsAnonymousUser");Diag.a.a(51238051,306,50,"CLPUsage : {0}",JSON.stringify(n))}},bp:function(n,t){var f=t,o,r,u,e,i;if(this.p=f.b,_Ewa.a.a("OfficeVSO:5515567_ApplyPolicyLabelErrorCodes")&&_Ewa.i.e(n.Errors)){o=_Ewa.i.j(n.Errors,[2045508683]);o.length>0&&(n.Errors=_Ewa.i.f(n.Errors,[2045508683],"PolicyManagerWrapper: OnApplyManualPolicyLabelSuccessCallback"),this.n.b().o(n.Errors));o=_Ewa.i.j(n.Errors,[2046680228]);o.length>0&&(f.a===4||f.a===1)&&(n.Errors=_Ewa.i.f(n.Errors,[2046680228],"PolicyManagerWrapper: OnApplyManualPolicyLabelSuccessCallback"),this.n.b().o(n.Errors));r=null;u=null;for(var h=this.o.a().SensitivityLabels,c=h.length,s=0;s<c;++s)e=h[s],_Ewa.f.b(this.p,e.Id,!1)&&(r=e),_Ewa.f.b(f.c,e.Id,!1)&&(u=e);i={};i.ApplyLabelFlag=f.a;r?(i.currentLabel="Set",i.currentLabelEnabled=r.Enabled,i.currentLabelName=!r.Name||!r.Name.length?"NotSet":"Set",i.currentLabelParentId=!r.ParentId||!r.ParentId.length?"NotSet":"Set"):i.currentLabel="NotSet";u?(i.serverLabel="Set",i.serverLabelEnabled=u.Enabled,i.serverLabelName=!u.Name||!u.Name.length?"NotSet":"Set",i.serverLabelParentId=!u.ParentId||!u.ParentId.length?"NotSet":"Set"):i.serverLabel="NotSet";Diag.a.a(541638850,306,15,"PolicyManagerWrapper.OnApplyManualPolicyLabelSuccessCallback Failed. DiagnosticInfo : {0}",JSON.stringify(i))}},bd:function(n,t){var r,i,f;if(_Ewa.a.a("OfficeVSO:4655446_ClpWatermarkLabelsSupport")&&_Ewa.a.a("OfficeVSO:5011839_LoadSaveHFUsingVMLHandler")&&_Ewa.a.a("OfficeVSO:4655446_GenerateApplyHFPictureRevision")&&!this.n.k().HasRoundTrippedHFPart)return!1;if(r=this.o.a(),!r)return Diag.a.a(50341184,306,15,"PolicyManagerWrapper.BlockSetSensitivityCall: policyLabelsData is null."),!1;i=null;for(var e=r.SensitivityLabels,o=e.length,u=0;u<o;++u)f=e[u],_Ewa.f.b(f.Id,n,!1)&&(i=f);return i&&this.bk(i)?(Diag.a.a(50341186,306,50,"PolicyManagerWrapper.BlockSetSensitivityCall: selectedSensitivityLabel has watermark label action."),this.bv(t),!0):!1},bm:function(){var n=!1;return!this.n.e().IsNewWorkbook||this.p&&this.p.length||(n=!0),Diag.a.a(593065680,306,50,"PolicyManagerWrapper.IsANewFile: is this a new file : {0}",n),n},bo:function(n,t){1===t.a?this.n.j()?(Diag.a.a(572002694,306,50,"MandatoryLabellingHandler : Swtiching to view-mode."),this.n.i().a(new _Ewa.L(-723527778,0,this.n.p(),10,null),null,null)):Diag.a.a(570745378,306,50,"MandatoryLabellingHandler : App is already in view-mode."):(this.u=t.b,this.n.b().H(this.C),this.n.ca(),Diag.a.a(572002693,306,50,"MandatoryLabellingHandler : Swtiching to edit-mode."),this.n.i().a(new _Ewa.L(-8805455,0,this.n.p(),10,null),null,null))},ba:function(n,t){var i,r;if(!t){Diag.a.a(572002692,306,15,"AddMandatoryLabellingBusinessBar is called but MandatoryLabellingAppHandlerEventArgs is null.");return}i=!!(this.n.s()&64);Diag.a.a(570745377,306,50,"AddMandatoryLabellingBusinessBar User has edit permission : {0}",i);i&&(this.n.ca(),r=this,this.q.n(t.d,t.c,t.a,function(n){t.b(n)}))},bu:function(){this.q.c(38)&&this.q.b(38)},bc:function(){if(_Ewa.f.a(this.u)||!this.n.j()){Diag.a.a(572002691,306,15,"ApplyMandatoryLabelOnEditMode : mandatoryPolicyId empty {0} , edit mode : {1}.",_Ewa.f.a(this.u),this.n.j());return}this.n.b().J(this.C);this.v()},bz:function(){if(!this.n.j()){Diag.a.a(543474894,306,15,"TriggerDefaultLabelingOnModeChanged is not expected in View-mode. Mode.");return}this.n.b().J(this.L);this.v()},bb:function(n){this.s.bs(this.u,n);this.u=null},bk:function(n){for(var r,i=n.LabelActions,u=i.length,t=0;t<u;++t)if(r=i[t],_Ewa.f.b(r.Name,"ApplyWatermark",!1))return!0;return!1},bv:function(n){if(!n){Diag.a.a(51654868,306,50,"PolicyManagerWrapper.showBlockApplyLabelDialogDialog: Watermark Dialog box called with showDialog set to false from autoapply.");return}var t=new _Ewa.AM(this.n);t.z(!1)},bj:function(){var n=this.n.b().m();n&&!_Ewa.f.b(n.AppliedPolicyLabelId,this.p,!1)&&(Diag.a.a(42844434,306,50,"PolicyManagerWrapper.HandleWorkbookMetadataChanged: Calling GetPolicyLabels to update statusbar and ribbon control."),Diag.a.b(574375109,306,this.n.j(),"PolicyManagerWrapper.HandleWorkbookMetadataChanged policyId cannot change in read-only mode, this can happen if right policy id is not read from server."),this.r.a("SupportsOfficeClientCoauthoring")&&this.n.j()&&(this.x=!0,this.A=n.AppliedPolicyLabelId),this.p=n.AppliedPolicyLabelId,this.v())},bn:function(){var n=!0,r;if(!this.n.b().I())for(var i=this.n.b().r(),u=i.length,t=0;t<u;++t)if(r=i[t],!r.SupportsClientIsMipTrusted){n=!1;break}return Diag.a.a(593007453,306,50,"PolicyManagerWrapper.IsEveryCoauthorInSessionClientMipTrusted : {0}",n),n},br:function(){Diag.a.a(592723985,306,50,"PolicyManagerWrapper.OnLabelUpdate: RTC notification received");this.x=!0;this.v()},X:function(n,t,i,r){var e=this.o.a(),o=JSON.stringify(e),u;isNullOrUndefined(n)&&(n="");u=new _Ewa.VD;u.b=n;u.c=r;u.a=t;var s=this.n.c().a(),f=this,h=function(r,e,h){return _Ewa.sI.a(s,o,n,f.n.e().DocumentHostInfo.TenantId,t,i,_Ewa.n.a.call(null,f.U,r),null,h,u,null)},c=this;_Ewa.H.a(this.n.f(),h,function(n){return new _Ewa.v(222,0,n,0,null)},null);this.x=!1;this.A=null}};_Ewa.sI=function(){};_Ewa.sI.c=function(n,t,i,r,u,f,e){var o=n.a(1,e);return o.tenantId=t,_Ewa.k.a(n,"GetPolicyLabelId",o,i,r,u,f,4,null,null)};_Ewa.sI.a=function(n,t,i,r,u,f,e,o,s,h,c){var l=n.a(41,c);return l.labelsInfoJson=t,l.appliedLabelId=i,l.tenantId=r,l.applyLabelFlag=u,l.skipApplyOutcomes=f,_Ewa.k.a(n,"ApplyPolicyLabel",l,e,o,s,h,0,null,null)};_Ewa.sI.b=function(n,t,i,r,u,f,e){var o=n.a(1,e);return o.tenantId=t,_Ewa.k.a(n,"GetPolicyApplicationMethod",o,i,r,u,f,4,null,null)};_Ewa.VF=function(n){this.a=n};_Ewa.VF.prototype={a:null,z:function(){return!1},x:function(n,t,i){var r;switch(t.a){case 2935633379:return this.a.k().FileCoauthorable||(i[Common.App.Policy.a.f]=this.a.k().ExclusiveLockId),r=Common.a.c().c(2935633379,2,i,null),$$sc.a.a(Boolean,r===32);case 2875864574:return r=Common.a.c().c(2875864574,2,i,null),$$sc.a.a(Boolean,r===32);case 991261903:return r=Common.a.c().c(991261903,2,i,null),$$sc.a.a(Boolean,r===32);default:return _Ewa.Y.a(t.a)}},w:function(n,t){switch(t.a){case 2935633379:case 2875864574:case 991261903:return!0;default:return!1}},y:function(n,t,i){switch(t){case"PopulateSensitivityFlyout":var r=Common.a.c().c(1145315516,2,i,null);return r===32;default:return!1}}};_Ewa.AP=function(n){_Ewa.AP.initializeBase(this,[n])};_Ewa.AP.a=function(n){_Ewa.bh.a(316,new _Ewa.AP(n))};_Ewa.AP.prototype={n:function(){this.m([new _Ewa.VF(this.h)],null)}};_Ewa.VD.registerClass("_Ewa.VD");_Ewa.VE.registerClass("_Ewa.VE",_Ewa.bW,Sys.IDisposable);_Ewa.VE.a.registerClass("_Ewa.VE.a");_Ewa.AM.registerClass("_Ewa.AM",_Ewa.dt);_Ewa.AO.registerClass("_Ewa.AO",_Ewa.sX.$$(_Ewa.gR));_Ewa.PolicyManagerWrapper.registerClass("_Ewa.PolicyManagerWrapper",_Ewa.bW,_Ewa.rM,Common.IRootUser,_Ewa.gR);_Ewa.VF.registerClass("_Ewa.VF",null,_Ewa.lI);_Ewa.AP.registerClass("_Ewa.AP",_Ewa.bh);Type.registerNamespace("_Ewa");_Ewa.bmt=function(){};_Ewa.bmt.a=function(){_Ewa.m.a(function(n){_Ewa.AO.a(n);_Ewa.AP.a(n)})};_Ewa.bmt.a();